namespace = distar

#################################
#
# Anomaly Events
# by Dee Majek
#
#################################

# root = ship scope
# from = planet scope

### Supply Wreckage ###
ship_event = {
	id = distar.1
	title = "distar.1.name"
	desc = {
		trigger = {
			exists = event_target:wreckage_owner
		}
		text = "distar.1.desc.contact"
	}
	desc = {
		trigger = {
			exists = event_target:wreckage_owner
		}
		text = "distar.1.desc.nocontact"
	}
	picture = GFX_evt_space_debris
	show_sound = event_ship_bridge
	location = event_target:supply_wreckage_tar

	is_triggered_only = yes

	immediate = {
		create_ambient_object = {
			type = "abandoned_ship_object"
			location = from
		}
		last_created_ambient_object = {
			save_event_target_as = supply_wreckage_tar
			set_location = {
				target = from
				distance = 5
				angle = 90
			}
		}
		owner = {
			random_neighbor_country = {
				limit = {
					is_ai = yes
					is_country_type = default
					is_homicidal = no
					has_communications = prev
					NOR = {
						is_at_war_with = prev
						is_country = prev
					}
					event_target:supply_wreckage_tar.solar_system = { has_access_fleet = prev }
				}
				save_event_target_as = wreckage_owner
			}
		}
	}
	option = {
		name = "distar.1.a"
		owner = {
			add_resource = { minerals = 300 }
			if = {
				limit = {
					exists = event_target:wreckage_owner
				}
				add_intel = {
					who = event_target:wreckage_owner
					amount = 10
				}
			}
		}
		if = {
			limit = {
				exists = event_target:wreckage_owner
			}
			custom_tooltip = "distar.1.a.tooltip"
			hidden_effect = { owner = { country_event = { id = distar.2 days = 180 } } }
		}
	}
	option = {
		trigger = {
			exists = event_target:wreckage_owner
			owner = { NOT = { is_at_war_with = event_target:wreckage_owner } }
		}
		name = "distar.1.b"
		custom_tooltip = "distar.1.b.tooltip"
		hidden_effect = { owner = { country_event = { id = distar.3 days = 60 } } }
	}
}

country_event = {
	id = distar.2
	title = "distar.2.name"
	desc = {
		trigger = {
			is_machine_empire = no
		}
		text = "distar.2.desc"
	}
	desc = {
		trigger = {
			is_machine_empire = yes
		}
		text = "distar.2.desc.machi"
	}
	location = event_target:wreckage_owner

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:wreckage_owner
		planet_background = event_target:wreckage_owner
		graphical_culture = event_target:wreckage_owner
		city_level = event_target:wreckage_owner
		room = event_target:wreckage_owner.ruler
	}

	option = {
		trigger = { resource_stockpile_compare = { resource = minerals value >= 300 } }
		name = distar.2.a
		event_target:wreckage_owner = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_stole_supplies
			}
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}

	option = {
		trigger = {
			resource_stockpile_compare = { resource = minerals value >= 300 }
			NOT = { is_at_war_with = event_target:wreckage_owner }
		}
		name = distar.2.b
		add_resource = { minerals = -300 }
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}

	option = {
		trigger = { resource_stockpile_compare = { resource = minerals value < 300 } }
		name = TOOPOOR
		event_target:wreckage_owner = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_stole_supplies
			}
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}
}

country_event = {
	id = distar.3
	title = "distar.3.name"
	desc = "distar.3.desc"
	location = event_target:wreckage_owner

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:wreckage_owner
		planet_background = event_target:wreckage_owner
		graphical_culture = event_target:wreckage_owner
		city_level = event_target:wreckage_owner
		room = event_target:wreckage_owner.ruler
	}

	option = {
		name = distar.3.a
		add_resource = { influence = 100 }
		add_favors = {
			target = event_target:wreckage_owner
			value = 1
		}
		event_target:wreckage_owner = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_returned_supplies
			}
		}
		hidden_effect = {
			event_target:supply_wreckage_tar = {
				destroy_ambient_object = this
			}
		}
	}
}

## Superflare Gatekeeper (on_colonized)
planet_event = {
	id = distar.5
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_modifier = superflare_planet
	}

	immediate = {
		planet_event = { id = distar.7 days = 360 random = 50 }
		planet_event = { id = distar.8 days = 360 random = 50 }
		set_planet_flag = colony_event
	}
}

## Superflare Ancient Civ
ship_event = {
	id = distar.6
	title = "distar.6.name"
	desc = "distar.6.desc"
	picture = GFX_evt_dead_city
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = INTERESTING
		from = {
			add_deposit = d_society_4
			hidden_effect = { add_modifier = { modifier = frozen_in_time days = -1 } }
		}
	}
}

planet_event = {
	id = distar.7
	title = "distar.7.name"
	desc = {
		trigger = {
			has_modifier = superflare_planet
			OR = {
				is_colony = yes
				is_under_colonization = yes
			}
		}
		text = "distar.7.desc"
	}
	desc = {
		trigger = {
			has_modifier = superflare_planet
			is_colony = no
			is_under_colonization = no
		}
		text = "distar.7.desc.nocol"
	}
	picture = GFX_evt_star_yellow
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	trigger = {
		OR = { exists = owner exists = controller exists = space_owner }
		has_modifier = superflare_planet
	}

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = { has_planet_flag = frozen_in_time_flag }
				save_event_target_as = frozen_in_time_planet
			}
		}
	}

	option = {
		trigger = {
			OR = {
				is_under_colonization = yes
				is_colony = yes
			}
		}
		name = "distar.7.a"
		enable_special_project = {
			name = "SUPERFLARE_PROJECT"
			location = root
			owner = root.owner
		}
		hidden_effect = {
			planet_event = { id = distar.8 days = 180 }
		}
	}

	option = {
		trigger = {
			is_under_colonization = no
			is_colony = no
		}
		name = "distar.7.b"
		add_modifier = { modifier = superflare_struck years = 20 }
		hidden_effect = { remove_modifier = "superflare_planet" }
	}
}

planet_event = { #If you lose the colony after accepting the Special Project but before completing it
	id = distar.8
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		NOR = {
			exists = owner
			exists = controller
			has_modifier = superflare_avoided
			has_modifier = superflare_struck
		}
		has_modifier = superflare_planet
	}

	immediate = {
		add_modifier = { modifier = superflare_struck years = 20 }
		remove_modifier = "superflare_planet"
	}
}

ship_event = {
	id = distar.9
	title = "distar.9.name"
	desc = "distar.9.desc"
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_scanner
	location = fromfrom

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		fromfrom = {
			add_modifier = { modifier = superflare_avoided }
			hidden_effect = { remove_modifier = "superflare_planet" }
		}
		add_expertise_trait_to_leader_or_research_node_effect = {
			TRAIT = leader_trait_expertise_field_manipulation
		}
		leader = {
			add_experience = 200
		}
	}
}

country_event = {
	id = distar.10
	title = "distar.10.name"
	desc = "distar.10.desc"
	picture = GFX_evt_star_yellow
	show_sound = event_scanner
	location = fromfromfrom

	is_triggered_only = yes

	option = {
		name = TERRIBLE
		fromfromfrom = {
			add_modifier = { modifier = superflare_struck years = 20 }
			hidden_effect = { remove_modifier = "superflare_planet" }
			random_owned_pop = {
				kill_pop = yes
			}
		}
	}
}

 ## Energetic Spectra
ship_event = {
	id = distar.15
	title = "distar.15.name"
	desc = "distar.15.desc"
	picture = GFX_evt_black_hole
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	specimen = black_hole_chromatic_anomaly

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_research_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = FASCINATING
		from = {
			add_deposit = d_energy_10
			hidden_effect = { add_modifier = { modifier = black_hole_energy years = -1 } }
		}
	}
}

 ## Blackhole Hologram
ship_event = {
	id = distar.20
	title = "distar.20.name"
	desc = "distar.20.desc"
	picture = GFX_evt_fleet_neutral
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				clear_deposits = yes
			}
		}
		owner = {
			set_country_flag = seen_event_horizon
			country_event = { id = story.5 days = 30 }
		}
	}

	option = {
		name = CURIOUS
		from = {
			add_deposit = d_society_3
			hidden_effect = { add_modifier = { modifier = black_hole_hologram years = -1 } }
		}
	}
}

 ## Rudimentary Robots
ship_event = {
	id = distar.25
	title = "distar.25.name"
	desc = "distar.25.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
		from = {
			add_modifier = { modifier = primitive_robots years = -1 }
		}
	}

	#option = {
	#	trigger = {
	#		from = { planet_size < 18 }
	#	}
	#	name = INTERESTING
	#	custom_tooltip = distar.25.a.tooltip
	#}
	option = {
		#trigger = {
		#	from = { planet_size > 17 }
		#}
		name = INTERESTING
		custom_tooltip = distar.25.b.tooltip
	}
}

 ## Make Rudimentary Robots exist
 planet_event = {
	id = distar.2599 #I am sorry
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_planet_flag = primitive_robot_planet
	}

	immediate = {
		create_species = {
			name = "NAME_Primitive_Robot"
			plural = "NAME_Primitive_Robots"
			class = ROBOT
			portrait = "default_robot"
			namelist = "PRT1"
			homeworld = this
			traits = {
				trait = "trait_mechanical"
			}
			effect = {
				set_species_flag = primitive_robots_flag
				save_global_event_target_as = primitive_robot_species
			}
		}
		while = {
			count = 4
			create_pop = {
				species = event_target:primitive_robot_species
			}
		}
		if = {
			limit = {
				owner = {
					is_country_type = default
					NOT = { has_country_flag = cured_rage_virus }
				}
			}
			planet_event = { id = distar.26 days = 1 }
		}
	}
}

 ## Rudimentary Robots -> Rage Virus Chain
planet_event = {
	id = distar.26
	title = "distar.26.name"
	desc = "distar.26.desc"
	picture = GFX_evt_organic_oppression
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	trigger = {
		has_planet_flag = primitive_robot_planet
		any_owned_pop = {
			species = {
				has_species_flag = primitive_robots_flag
			}
		}
		owner = {
			is_country_type = default
			NOT = { has_country_flag = cured_rage_virus }
		}
	}

	immediate = {
		planet_event = { id = distar.31 days = 1800 random = 720 }
		set_planet_flag = colony_event
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_policy_flag = ai_outlawed
					has_ethic = ethic_gestalt_consciousness
				}
			}
		}
		name = "distar.26.a"
		custom_tooltip = "distar.26.a.tooltip"
		hidden_effect = { planet_event = { id = distar.27 days = 90 random = 10 } }
	}
	option = {
		trigger = {
			owner = { NOT = { has_policy_flag = ai_outlawed } }
		}
		name = "distar.26.b"
		owner = {
			add_resource = { minerals = 100 }
		}
		root = {
			every_owned_pop = {
				limit = { species = { has_species_flag = primitive_robots_flag } }
				kill_pop = yes
			}
		}
	}
	option = {
		trigger = {
			owner = { has_policy_flag = ai_outlawed }
		}
		name = "distar.26.c"
		owner = {
			add_resource = { minerals = 100 }
		}
		root = {
			every_owned_pop = {
				limit = { species = { has_species_flag = primitive_robots_flag } }
				kill_pop = yes
			}
		}
	}
	option = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		name = "distar.26.mach"
		custom_tooltip = "distar.26.a.tooltip"
		hidden_effect = { planet_event = { id = distar.27 days = 90 random = 10 } }
	}

	after = {
		hidden_effect = { remove_modifier = "primitive_robots" }
	}
}

planet_event = {
	id = distar.27
	title = "distar.27.name"
	desc = "distar.27.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	trigger = {
		exists = owner
	}

	option = {
		name = "distar.27.a"
		enable_special_project = {
			name = "PRIMITIVE_ROBOT_PROJECT"
			location = root
			owner = root.owner
		}
	}
}

ship_event = { #MI version
	id = distar.28
	title = "distar.28.name"
	desc = "distar.28.desc"
	picture = GFX_evt_city_ruins
	show_sound = event_scanner
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		owner = { is_machine_empire = yes }
	}

	option = {
		name = "distar.28.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		leader = {
			add_experience = 200
		}
	}
}

ship_event = { #Biological version
	id = distar.29
	title = "distar.29.name"
	desc = "distar.29.desc"
	picture = GFX_evt_robot_assembly_plant
	show_sound = event_scanner
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		owner = { is_machine_empire = no }
	}

	option = {
		name = "distar.29.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		leader = {
			add_experience = 200
		}
		hidden_effect = { ship_event = { id = distar.30 } }
	}
}

ship_event = {
	id = distar.30
	title = "distar.30.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.30.desc"
	show_sound = event_radio_chatter
	location = fromfromfrom

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	option = {
		name = "distar.30.a"
		response_text = distar.30.desc
		is_dialog_only = yes
	}
	option = {
		name = "distar.30.b"
		response_text = distar.30.b.response
		is_dialog_only = yes
	}
	option = {
		name = "distar.30.c"
		response_text = distar.30.c.response
		is_dialog_only = yes
	}
	option = {
		name = "distar.30.d"
		response_text = distar.30.d.response
		is_dialog_only = yes
	}
	option = {
		name = "distar.30.e"
	}
}

planet_event = {
	id = distar.31
	title = "distar.31.name"
	desc = "distar.31.desc"
	picture = GFX_evt_news_room
	show_sound = event_radio_chatter
	location = from

	is_triggered_only = yes

	trigger = {
		exists = owner
		any_owned_pop = {
			NOR = {	has_trait = trait_mechanical has_trait = trait_machine_unit	}
		}
	}

	immediate = {
		IF = {
			limit = {
				count_owned_pop = {
					limit = { NOT = { has_trait = trait_mechanical } }
					count < 6
				}
			}
			while = {
				count = 2
				random_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_modifier = erratic_behavior
						}
					}
					add_modifier = { modifier = erratic_behavior days = -1 }
				}
			}
		}
		else_if = {
			limit = {
				count_owned_pop = {
					limit = { NOT = { has_trait = trait_mechanical } }
					count > 5
				}
				count_owned_pop = {
					limit = { NOT = { has_trait = trait_mechanical } }
					count < 13
				}
			}
			while = {
				count = 3
				random_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_modifier = erratic_behavior
						}
					}
					add_modifier = { modifier = erratic_behavior days = -1 }
				}
			}
		}
		else = {
			while = {
				count = 5
				random_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_modifier = erratic_behavior
						}
					}
					add_modifier = { modifier = erratic_behavior days = -1 }
				}
			}
		}
	}

	option = {
		name = "distar.31.a"
		enable_special_project = {
			name = "RETROVIRUS_PROJECT"
			location = root
			owner = root.owner
		}
		hidden_effect = {
			planet_event = { id = distar.32 days = 60 }
			planet_event = { id = distar.33 days = 120 }
		}
	}
}

planet_event = { #Recursive, spreads every other month as long as have biopops left to spread to on planet
	id = distar.32
	title = "distar.32.name"
	desc = "distar.32.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = from

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { NOT = { has_country_flag = cured_rage_virus } }
		any_owned_pop = {
			NOR = {
				has_trait = trait_mechanical
				has_trait = trait_machine_unit
				has_modifier = erratic_behavior
			}
		}
	}

	immediate = {
		IF = {
			limit = {
				count_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
					count < 6
				}
			}
			random_owned_pop = {
				limit = {
					NOR = {
						has_trait = trait_mechanical
						has_trait = trait_machine_unit
						has_modifier = erratic_behavior
					}
				}
				add_modifier = { modifier = erratic_behavior days = -1 }
			}
		}
		else = {
			while = {
				count = 2
				random_owned_pop = {
					limit = {
						NOR = {
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							has_modifier = erratic_behavior
						}
					}
					add_modifier = { modifier = erratic_behavior days = -1 }
				}
			}
		}
		planet_event = { id = distar.32 days = 60 }
	}

	option = {
		name = WORRYING
	}
}

planet_event = { #Onetime
	id = distar.33
	title = "distar.33.name"
	desc = "distar.33.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = from

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = { NOT = { has_country_flag = cured_rage_virus } }
	}

	immediate = {
		set_planet_flag = retrovirus_armies
		random_owned_pop = {
			limit = { has_modifier = erratic_behavior }
			species = { save_event_target_as = infected_species }
		}
		create_country = {
			name = "NAME_Enraged_Colonists"
			type = faction
			auto_delete = yes
			flag = {
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"red"
					"red"
					"null"
					"null"
				}
			}
			effect = {
				establish_communications_no_message = root.owner
				establish_contact = { who = root.owner location = root.solar_system }
			}
		}
		last_created_country = {
			save_global_event_target_as = enraged_colonists_country
		}
		create_army = {
			name = "NAME_Enraged_Colonists"
			owner = event_target:enraged_colonists_country
			species = event_target:infected_species
			type = "enraged_army"
		}
		create_army = {
			name = "NAME_Enraged_Colonists"
			owner = event_target:enraged_colonists_country
			species = event_target:infected_species
			type = "enraged_army"
		}
		create_army = {
			name = "NAME_Enraged_Colonists"
			owner = event_target:enraged_colonists_country
			species = event_target:infected_species
			type = "enraged_army"
		}
	}

	option = {
		name = distar.33.a
		custom_tooltip = distar.33.a.tooltip
	}
}

country_event = {
	id = distar.34
	title = "distar.34.name"
	desc = {
		trigger = {
			has_country_flag = started_retrovirus_project
		}
		text = "distar.34.desc.a"
	}
	desc = {
		trigger = {
			NOT = { has_country_flag = started_retrovirus_project }
		}
		text = "distar.34.desc.b"
	}
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		fromfrom = {
			has_planet_flag = retrovirus_armies
		}
		from = {
			is_same_value = event_target:enraged_colonists_country
		}
	}

	option = {
		name = distar.34.a
		hidden_effect = { fromfrom = { remove_planet_flag = retrovirus_armies } }
	}
}

planet_event = {
	id = distar.35
	title = "distar.35.name"
	desc = "distar.35.desc"
	picture = GFX_evt_interior_battle
	show_sound = event_red_alert
	location = from

	is_triggered_only = yes

	option = {
		name = "distar.35.a"
		add_modifier = { modifier = researcher_rage days = 360 }
	}
}

planet_event = { #Rage Virus cured
	id = distar.36
	title = "distar.36.name"
	desc = "distar.36.desc"
	picture = GFX_evt_disease_outbreak
	show_sound = event_laboratory_sound
	location = from

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = cured_rage_virus
			remove_country_flag = started_retrovirus_project
		}
	}

	option = {
		name = EXCELLENT
		owner = {
			hidden_effect = {
				every_owned_pop = {
					limit = {
						has_modifier = erratic_behavior
					}
					remove_modifier = "erratic_behavior"
				}
			}
			IF = {
				limit = { any_owned_leader = { is_head_of_research = yes } }
				random_owned_leader = {
					limit = { is_head_of_research = yes }
					add_skill = 1
				}
			}
			if = {
				limit = {
					NOT = { has_technology = tech_genome_mapping }
					OR = {
						is_machine_empire = no
						has_civic = civic_machine_assimilator
						has_civic = civic_machine_servitor
					}
				}
				give_technology = { tech = tech_genome_mapping }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_frontier_health }
					is_gestalt = no
				}
				give_technology = { tech = tech_frontier_health }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_frontier_hospital }
					is_gestalt = no
				}
				give_technology = { tech = tech_frontier_hospital }
			}
			else_if = {
				limit = {
					NOT = { has_technology = tech_vitality_boosters }
					OR = {
						is_machine_empire = no
						has_civic = civic_machine_assimilator
					}
				}
				give_technology = { tech = tech_vitality_boosters }
			}
			else_if = {
				limit = { has_technology = tech_vitality_boosters }
				give_technology = { tech = tech_repeatable_improved_leader_life_span }
			}
			else = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier3researchreward
					min = @tier3researchmin
					max = @tier3researchmax
				}
			}
		}
	}
}

country_event = {
	id = distar.37
	title = "distar.34.name"
	desc = {
		trigger = {
			has_country_flag = started_retrovirus_project
		}
		text = "distar.34.desc.a"
	}
	desc = {
		trigger = {
			NOT = { has_country_flag = started_retrovirus_project }
		}
		text = "distar.34.desc.b"
	}
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		fromfrom = {
			has_planet_flag = retrovirus_armies
		}
		fromfrom = {
			controller = {
				is_same_value = event_target:enraged_colonists_country
			}
		}
	}

	option = {
		name = distar.34.a
		hidden_effect = { fromfrom = { remove_planet_flag = retrovirus_armies } }
	}
}

 ## Gray Goo
ship_event = {
	id = distar.40
	title = "distar.40.name"
	desc = "distar.40.desc"
	picture = GFX_evt_gray_goo
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes
	specimen = nanite_sludge

	option = {
		name = EXCELLENT
		owner = {
			if = {
				limit = { NOT = { has_technology = tech_assembly_pattern } }
				give_technology = { tech = tech_assembly_pattern }
			}
			else_if = {
				limit = { NOT = { has_technology = tech_construction_templates } }
				give_technology = { tech = tech_construction_templates }
			}
			else_if = {
				limit = { has_technology = tech_construction_templates }
				give_technology = { tech = tech_repeatable_reduced_building_time }
			}
			generate_lcluster_clue = yes
		}
	}
}

## Dark Flow
ship_event = {
	id = distar.45
	title = "distar.45.name"
	desc = "distar.45.desc"
	picture = GFX_evt_drifting_gateway
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { set_country_flag = got_dark_flow }
		solar_system = {
			random_system_megastructure = {
				limit = {
					OR = {
						is_megastructure_type = gateway_ruined
						is_megastructure_type = gateway_restored
					}
				}
				save_event_target_as = dark_flow_gateway
			}
		}
	}

	option = {
		name = INTERESTING
		event_target:dark_flow_gateway = {
			enable_special_project = {
				name = "DARK_FLOW_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
}

ship_event = {
	id = distar.46
	title = "distar.46.name"
	desc = "distar.46.desc"
	picture = GFX_evt_surreal_visions
	show_sound = event_scanner
	location = event_target:dark_flow_gateway

	is_triggered_only = yes

	immediate = {
		random_system_megastructure = {
			limit = {
				OR = {
					is_megastructure_type = gateway_ruined
					is_megastructure_type = gateway_restored
				}
			}
			save_event_target_as = dark_flow_gateway
		}
	}

	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
		leader = {
			add_trait = leader_trait_paranoid
			add_skill = 2
		}
	}
}

## Lost Amoeba
ship_event = {
	id = distar.50
	title = "distar.50.name"
	desc = {
		trigger = {
			owner = { has_country_flag = amoeba_encountered }
		}
		text = "distar.50.desc"
	}
	desc = {
		trigger = {
			owner = { NOT = { has_country_flag = amoeba_encountered } }
		}
		text = "distar.50.desc.first_enc"
	}
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = from

	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Lost_Amoeba"
			type = nice_faction
			auto_delete = yes
			flag = {
				icon = {
					category = "pirate"
					file = "flag_pirate_3.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"blue"
					"blue"
					"null"
					"null"
				}
			}
			effect = {
				establish_communications_no_message = root.owner
				set_faction_hostility = {
					target = root.owner
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
				create_fleet = {
					name = "NAME_Lost_Amoeba"
					effect = {
						set_owner = prev
						create_ship = {
							name = "NAME_Lost_Amoeba"
							design = "NAME_Small_Space_Organism_Teal"
							prefix = no
							upgradable = no
						}
						set_location = {
							target = from
							distance = 5
							angle = random
						}
						set_fleet_stance = passive
						set_fleet_flag = lost_amoeba_fleet@root.owner
						save_event_target_as = lost_amoeba_fleet
					}
					settings = {
						can_upgrade = no
						can_disband = no
						can_change_composition = no
						can_change_leader = no
						uses_naval_capacity = no
						spawn_debris = yes
					}
				}
				save_event_target_as = lost_amoeba_country
			}
		}
		root = {
			fleet = {
				save_event_target_as = science_ship_fleet
			}
		}
		event_target:lost_amoeba_fleet = {
			auto_follow_fleet = {
				target = event_target:science_ship_fleet
				attack_fleet = no
			}
		}
	}

	after = {
		hidden_effect = {
			owner = {
				set_country_flag = amoeba_encountered
				every_country = {
					limit = {
						NOT = { is_same_value = event_target:lost_amoeba_country }
						NOT = { has_communications = root.owner }
						is_amoeba_country_type = yes
					}
					root.owner = {
						establish_communications_no_message = prev
						establish_communication_with_subjects_and_federation = { FLAG = amoeba_encountered }
					}
				}
			}
		}
	}

	option = { #Pacify/adopt it
		name = distar.50.a
		trigger = {
			owner = { is_homicidal = no }
		}
		event_target:lost_amoeba_fleet = {
			set_owner = root.owner
		}
		hidden_effect = {
			leader = {
				save_global_event_target_as = amoeba_finding_scientist
			}
			owner = {
				set_country_flag = amoeba_befriended # Achievement flag
				country_event = { id = distar.51 days = 360 random = 60 }
				country_event = { id = distar.304 days = 36000 }
			}
		}
		# Patch Note: These fixes are here to not penalize different orders of events.
		root.owner = {
			if = {
				limit = {
					NOR = {
						has_modifier = pacified_amoebas
						has_special_project = AMOEBAS_PACIFICATION_PROJECT
					}
				}
				enable_special_project = {
					name = "AMOEBAS_PACIFICATION_PROJECT"
					location = capital_scope
					owner = root.owner
				}
			}
		}
	}

	option = { #
		name = distar.50.b
		custom_tooltip = distar.50.b.tooltip
		hidden_effect = {
			owner = {
				country_event = { id = distar.52 days = 90 }
				IF = {
					limit = {
						NOR = {
							has_special_project = AMOEBAS_PROJECT
							has_modifier = flagellating_movement
						}
					}
					enable_special_project = {
						name = "AMOEBAS_PROJECT"
						location = capital_scope
						owner = root.owner
					}
				}
			}
		}
	}

	option = {
		name = "distar.50.c"
		event_target:lost_amoeba_fleet = {
			enable_special_project = {
				name = "DISSECTION_PROJECT"
				location = this
				owner = root.owner
			}
		}
		owner = {
			if = {
				limit = { NOT = { has_country_flag = amoeba_encountered } }
				add_modifier = {
					modifier = amoeba_hunting_buff
					days = -1
				}
				custom_tooltip = story.101.aa.amoebahunt
			}
		}
	}

	abort_trigger = {
		NOT = { exists = event_target:lost_amoeba_fleet }
	}
}

country_event = { #Adopted Amoeba Evolves
	id = distar.51
	title = "distar.51.name"
	desc = "distar.51.desc"
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = event_target:lost_amoeba_adult_fleet

	is_triggered_only = yes

	trigger = {
		exists = event_target:lost_amoeba_fleet
	}

	immediate = {
		create_fleet = {
			name = "NAME_Adopted_Amoeba"
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Adopted_Amoeba"
					design = "NAME_Large_Space_Organism_Teal"
					prefix = no
					upgradable = no
					effect = {
						save_event_target_as = lost_amoeba_ship
						set_disable_at_health = 0.001
						set_ship_flag = lost_amoeba_ship
					}
				}
				set_location = {
					target = event_target:lost_amoeba_fleet
				}
				set_fleet_stance = passive
				set_fleet_flag = lost_amoeba_adult_fleet@root
				save_event_target_as = lost_amoeba_adult_fleet
			}
			settings = {
				can_upgrade = no
				can_disband = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
			}
		}
		event_target:lost_amoeba_fleet = {
			delete_fleet = {
				target = this
				destroy_template = yes
			}
		}
		if = {
			limit = { exists = event_target:lost_amoeba_country }
			event_target:lost_amoeba_country = {
				destroy_country = yes
			}
		}
	}

	option = {
		name = "distar.51.a"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Bubbles"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Bubbles"
				set_fleet_flag = NAME_Bubbles
			}
		}
	}
	option = {
		name = "distar.51.b"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Nyx"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Nyx"
				set_fleet_flag = NAME_Nyx
			}
		}
	}
	option = {
		name = "distar.51.c"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Renegade"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Renegade"
				set_fleet_flag = NAME_Renegade
			}
		}
	}
	option = {
		name = "distar.51.d"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Euka"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Euka"
				set_fleet_flag = NAME_Euka
			}
		}
	}
	option = {
		name = "distar.51.e"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Cyto"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Cyto"
				set_fleet_flag = NAME_Cyto
			}
		}
	}
	option = {
		name = "distar.51.f"
		trigger = {
			owner_main_species = {
				NOR = {
					is_species_class = PLANT
					is_species_class = FUN
				}
			}
		}
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Boomer"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Boomer"
				set_fleet_flag = NAME_Boomer
			}
		}
	}
	option = {
		name = "distar.51.fb"
		trigger = {
			owner_main_species = {
				OR = {
					is_species_class = PLANT
					is_species_class = FUN
				}
			}
		}
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Bloomer"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Bloomer"
				set_fleet_flag = NAME_Bloomer
			}
		}
	}
	option = {
		name = "distar.51.g"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Blaze"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Blaze"
				set_fleet_flag = NAME_Blaze
			}
		}
	}
	option = {
		name = "distar.51.h"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Nova"
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Nova"
				set_fleet_flag = NAME_Nova
			}
		}
	}
	option = {
		name = "distar.51.more"
		hidden_effect = {
			country_event = { id = distar.55 }
		}
		event_target:lost_amoeba_adult_fleet = {
			hidden_effect = {
				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }
			}
		}
	}
}

country_event = {
	id = distar.55
	title = "distar.55.name"
	desc = "distar.55.desc"
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = event_target:lost_amoeba_adult_fleet

	is_triggered_only = yes

	trigger = {
		exists = event_target:lost_amoeba_adult_fleet
	}

	option = {
		name = "distar.55.a"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Blitz"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Blitz"
				set_fleet_flag = NAME_Blitz
			}
		}
	}
	option = {
		name = "distar.55.b"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Zero"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Zero"
				set_fleet_flag = NAME_Zero
			}
		}
	}
	option = {
		name = "distar.55.c"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Deva"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Deva"
				set_fleet_flag = NAME_Deva
			}
		}
	}
	option = {
		name = "distar.55.d"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Kos"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Kos"
				set_fleet_flag = NAME_Kos
			}
		}
	}
	option = {
		name = "distar.55.e"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Amemba"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Amemba"
				set_fleet_flag = NAME_Amemba
			}
		}
	}
	option = {
		name = "distar.55.f"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Beauregarde"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Beauregarde"
				set_fleet_flag = NAME_Beauregarde
			}
		}
	}
	option = {
		name = "distar.55.g"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Bluey"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Bluey"
				set_fleet_flag = NAME_Bluey
			}
		}
	}
	option = {
		name = "distar.55.h"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Zeke"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Zeke"
				set_fleet_flag = NAME_Zeke
			}
		}
	}
	option = {
		name = "distar.51.more"
		hidden_effect = {
			country_event = { id = distar.56 }
		}
	}
}

country_event = {
	id = distar.56
	title = "distar.55.name"
	desc = "distar.56.desc"
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = event_target:lost_amoeba_adult_fleet

	is_triggered_only = yes

	trigger = {
		exists = event_target:lost_amoeba_adult_fleet
	}

	option = {
		name = "distar.56.a"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Storm"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Storm"
			}
		}
	}
	option = {
		name = "distar.56.b"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Ghost"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Ghost"
			}
		}
	}
	option = {
		name = "distar.56.c"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Cygni"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Cygni"
			}
		}
	}
	option = {
		name = "distar.56.d"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Vesper"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Vesper"
			}
		}
	}
	option = {
		name = "distar.56.e"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Arda"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Arda"
			}
		}
	}
	option = {
		name = "distar.56.f"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Phaeton"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Phaeton"
			}
		}
	}
	option = {
		name = "distar.56.g"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Wraith"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Wraith"
			}
		}
	}
	option = {
		name = "distar.56.h"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Rokka"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Rokka"
			}
		}
	}
	option = {
		name = "distar.56.i"
		event_target:lost_amoeba_adult_fleet = {
			set_name = "NAME_Fluffy"
		}
		hidden_effect = {
			event_target:lost_amoeba_ship = {
				set_name = "NAME_Fluffy"
			}
		}
	}
}

country_event = { #Lost Amoeba leaves
	id = distar.52
	title = "distar.52.name"
	desc = "distar.52.desc"
	picture = GFX_evt_star_chart
	show_sound = event_space_amoeba
	location = event_target:solar_system_tar

	is_triggered_only = yes

	trigger = {
		exists = event_target:lost_amoeba_fleet
		NOT = { has_special_project = DISSECTION_PROJECT }
	}

	immediate = {
		event_target:lost_amoeba_fleet = {
			solar_system = {
				save_event_target_as = solar_system_tar
			}
		}
		event_target:lost_amoeba_fleet = {
			delete_fleet = this
		}
		if = {
			limit = { exists = event_target:lost_amoeba_country }
			event_target:lost_amoeba_country = {
				destroy_country = yes
			}
		}
	}

	option = {
		name = INTERESTING
		IF = {
			limit = {
				NOR = {
					has_tech_option = tech_amoeba_strike_craft_1
					has_technology = tech_amoeba_strike_craft_1
				}
			}
			add_research_option = tech_amoeba_strike_craft_1
		}
		ELSE_IF = {
			limit = {
				has_tech_option = tech_amoeba_strike_craft_1
			}
			add_tech_progress = {
				tech = tech_amoeba_strike_craft_1
				progress = 0.80
			}
		}
		ELSE = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

ship_event = { #Lost Amoeba Dissection completed
	id = distar.53
	title = "distar.53.name"
	desc = {
		trigger = {
			owner = { NOT = { has_technology = tech_regenerative_hull_tissue } }
		}
		text = "distar.53.desc.lacks_tech"
	}
	desc = {
		trigger = {
			owner = { has_technology = tech_regenerative_hull_tissue }
		}
		text = "distar.53.desc.has_tech"
	}
	picture = GFX_evt_society_research
	show_sound = event_space_amoeba
	location = fromfrom

	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_fleet_in_system = {
				limit = { has_fleet_flag = lost_amoeba_fleet@root.owner }
				destroy_fleet = this
			}
		}
		if = {
			limit = { exists = event_target:lost_amoeba_country }
			event_target:lost_amoeba_country = {
				destroy_country = yes
			}
		}
	}

	option = {
		name = INTERESTING
		owner = {
			IF = {
				limit = {
					NOR = {
						has_tech_option = tech_regenerative_hull_tissue
						has_technology = tech_regenerative_hull_tissue
					}
				}
				add_research_option = tech_regenerative_hull_tissue
			}
			ELSE_IF = {
				limit = {
					has_tech_option = tech_regenerative_hull_tissue
					NOT = { has_technology = tech_regenerative_hull_tissue }
				}
				add_tech_progress = {
					tech = tech_regenerative_hull_tissue
					progress = 0.50
				}
			}
			ELSE = {
				add_monthly_resource_mult = {
					resource = society_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
	}
}

country_event = { #Lost Amoeba escapes on_fail
	id = distar.54
	title = "distar.54.name"
	desc = "distar.54.desc"
	picture = GFX_evt_star_chart
	show_sound = event_space_amoeba
	location = event_target:solar_system_tar

	is_triggered_only = yes

	trigger = {
		exists = fromfrom
	}

	immediate = {
		fromfrom = {
			solar_system = {
				save_event_target_as = solar_system_tar
			}
		}
		fromfrom = { delete_fleet = this }
		if = {
			limit = { exists = event_target:lost_amoeba_country }
			event_target:lost_amoeba_country = {
				destroy_country = yes
			}
		}
	}

	option = {
		name = CURSES
	}
}

country_event = { #Discovering Scientist becomes depressed if Amoeba dies
	id = distar.57
	title = "distar.57.name"
	desc = "distar.57.desc"
	picture = GFX_evt_space_funeral
	show_sound = event_life_support_fail
	location = FromFrom

	is_triggered_only = yes

	specimen = memorial_for_bubbles

	trigger = {
		exists = event_target:amoeba_finding_scientist
	}

	option = {
		name = "distar.57.a"
		event_target:amoeba_finding_scientist = {
			add_trait = leader_trait_substance_abuser
		}
	}
}

ship_event = { #Disabled event for Reanimators
	id = distar.58
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_ship_flag = lost_amoeba_ship
	}

	immediate = {
		if = {
			limit = {
				owner = {
					is_reanimator = yes
				}
				#exists = event_target:amoeba_finding_scientist
				NOT = { has_ship_flag = resurrected_once }
			}
			ship_event = { id = distar.340 }
		}
		else = {
			if = {
				limit = {
					exists = event_target:amoeba_finding_scientist
				}
				fleet.owner = { country_event = { id = distar.57 } }
			}
			set_disabled = no
			destroy_ship = this
		}
	}
}

ship_event = {
	id = distar.340
	title = "distar.57.name"
	desc = {
		trigger = { exists = event_target:amoeba_finding_scientist }
		text = "distar.340.desc.science"
	}
	desc = {
		trigger = { NOT = { exists = event_target:amoeba_finding_scientist } }
		text = "distar.340.desc"
	}
	location = from

	is_triggered_only = yes

	picture = GFX_evt_friendly_amoeba
	show_sound = event_mystic_reveal

	trigger = {

	}
	option = {
		name = "distar.340.a"

		trigger = {
			owner = { is_reanimator = yes }
		}
		if = {
			limit = { exists = event_target:amoeba_finding_scientist }
			event_target:amoeba_finding_scientist = {
				add_or_level_up_veteran_trait_effect = {
					TRAIT = leader_trait_maniacal
				}
			}
		}

		enable_special_project = {
			name = "REANIMATE_LOST_AMOEBA"
			location = this
			owner = root.owner
		}
	}

	option = {
		name = "distar.340.b"
		if = {
			limit = { exists = event_target:amoeba_finding_scientist }
			event_target:amoeba_finding_scientist = {
				add_trait = leader_trait_substance_abuser
			}
		}
		hidden_effect = {
			from = {
				set_disabled = no
				destroy_ship = this
			}
		}
	}
}

# Undead Armies Reanimation
country_event = {
	id = distar.59
	title = "distar.218.name"
	desc = {
		trigger = { exists = event_target:amoeba_finding_scientist }
		text = "distar.59.desc" #This is the loc that mentions the scientist
	}
	desc = {
		trigger = { NOT = { exists = event_target:amoeba_finding_scientist } }
		text = "distar.59.desc.science" #This is the desc that doesn't mention the scientist
	}
	location = from

	is_triggered_only = yes

	picture = GFX_evt_necromancy
	show_sound = event_mystic_reveal

	immediate = {
		random_controlled_ship = {
			limit = {
				has_ship_flag = lost_amoeba_ship
			}
			set_ship_flag = resurrected_once
			save_event_target_as = reanimated_amoeba
		}
	}
	option = {
		name = "it_hungers"
		event_target:reanimated_amoeba = {
			set_disabled = no
		}

	}
}

country_event = {
	id = distar.345
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_controlled_ship = {
			limit = {
				has_ship_flag = lost_amoeba_ship
			}
			set_disabled = no
			destroy_ship = this
		}
	}
}

country_event = { #Upgrade if Amoeba survives 100 years (time delay, from distar.50)
	id = distar.304
	title = "distar.304.name"
	desc = "distar.304.desc"
	picture = GFX_evt_friendly_amoeba
	show_sound = event_space_amoeba
	location = event_target:lost_amoeba_centenarian_fleet

	is_triggered_only = yes

	trigger = {
		any_controlled_fleet = {
			has_fleet_flag = lost_amoeba_adult_fleet@root
		}
		NOT = {
			any_controlled_ship = {
				has_ship_flag = lost_amoeba_ship
				OR = {
					has_ship_flag = resurrected_once
					is_disabled = yes
				}
			}
		}
	}

	immediate = {
		random_controlled_fleet = {
			limit = {
				has_fleet_flag = lost_amoeba_adult_fleet@root
			}
			save_event_target_as = lost_amoeba_adult_fleet
		}
		create_fleet = {
			name = event_target:lost_amoeba_adult_fleet
			effect = {
				set_owner = root
				create_ship = {
					name = event_target:lost_amoeba_adult_fleet
					design = "NAME_Adopted_Amoeba_Centenarian"
					prefix = no
					upgradable = no
					effect = {
						set_disable_at_health = 0.001
						set_ship_flag = lost_amoeba_ship
					}
				}
				set_location = {
					target = event_target:lost_amoeba_adult_fleet
				}
				set_fleet_stance = passive

				add_modifier = { modifier = "amoeba_speed_boost" days = -1 }
				add_modifier = { modifier = "evolved_weapon_boost_2" days = -1 }
				add_modifier = { modifier = "evolved_firing_rate" days = -1 }
				add_modifier = { modifier = "evolved_evasion" days = -1 }

				set_fleet_flag = lost_amoeba_centenarian_fleet@root
				save_event_target_as = lost_amoeba_centenarian_fleet
			}
			settings = {
				can_upgrade = no
				can_disband = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
			}
		}
		event_target:lost_amoeba_adult_fleet = {
			delete_fleet = this
		}
	}

	option = {
		name = ASTOUNDING
		custom_tooltip = "distar.304.a.tooltip"
	}
}

ship_event = { #Ouroboros
	id = distar.60
	title = "distar.60.name"
	desc = "distar.60.desc"
	picture = GFX_evt_space_debris
	show_sound = event_sensor_ping
	location = event_target:kohtalo_first_fleet

	is_triggered_only = yes

	immediate = {
		create_ambient_object = {
			type = "kohtalo_object"
			location = from
		}
		last_created_ambient_object = {
			set_location = {
				target = from
				distance = 20
				angle = random
			}
			save_event_target_as = kohtalo_first_fleet
		}
		owner = {
			set_country_flag = got_ouroboros
			country_event = { id = story.5 days = 30 }
		}
		solar_system = { save_global_event_target_as = ouroboros_system }
		from = { set_planet_flag = ouroboros_pulsar_flag }
	}

	option = {
		name = UNFORTUNATE
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
		hidden_effect = { owner = { country_event = { id = distar.61 days = 360 } } }
	}
}

country_event = {
	id = distar.61
	title = "distar.61.name"
	desc = "distar.61.desc"
	picture = GFX_evt_ship_in_orbit_2
	show_sound = event_sensor_ping
	location = event_target:kohtalo_second_fleet

	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Kohtalo"
			type = nice_faction
			flag = {
				icon = {
					category = "spherical"
					file = "flag_spherical_22.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"indigo"
					"black"
					"null"
					"null"
				}
			}
			effect = {
				set_faction_hostility = {
					target = root
					set_hostile = no
					set_neutral = no
					set_friendly = yes
				}
				save_event_target_as = kohtalo_country
			}
		}
		random_planet_within_border = {
			limit = {
				is_star = yes
				solar_system = { NOT = { is_same_value = event_target:ouroboros_system } }
			}
			save_event_target_as = spawnpoint_tar
		}
		event_target:kohtalo_country = {
			create_species = {
				name = random
				class = MOL
				portrait = mol4
				namelist = "MOL1"
				traits = random
				effect = {
					save_event_target_as = kohtalo_species
				}
			}
			create_leader = {
				class = commander
				species = event_target:kohtalo_species
				name = "NAME_The_Captain"
				skill = 2
				event_leader = yes
			}
			last_created_leader = {
				save_event_target_as = kohtalo_captain
			}
			create_fleet = {
				name = "NAME_Kohtalo"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_Kohtalo"
						design = "NAME_Starfang"
					}
					set_location = {
						target = event_target:spawnpoint_tar
						distance = 50
						angle = random
					}
					set_fleet_stance = passive
					assign_leader = event_target:kohtalo_captain
					save_event_target_as = kohtalo_second_fleet
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = { country_event = { id = distar.62 } }
	}
}

country_event = {
	id = distar.62
	title = "distar.62.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.62.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.62.a"
		hidden_effect = { country_event = { id = distar.63 } }
	}
}

country_event = {
	id = distar.63
	title = "distar.63.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.63.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.63.a"
		hidden_effect = { country_event = { id = distar.64 } }
	}
}

country_event = {
	id = distar.64
	title = "distar.64.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.64.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.64.a"
		hidden_effect = { country_event = { id = distar.65 } }
	}
}

country_event = {
	id = distar.65
	title = "distar.65.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.65.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	immediate = {
		event_target:ouroboros_system = {
			random_system_planet = {
				limit = { has_planet_flag = ouroboros_pulsar_flag }
				save_event_target_as = ouroboros_pulsar
			}
		}
	}

	option = {
		name = "distar.65.a"
		custom_tooltip = "distar.65.a.tooltip"
		hidden_effect = { country_event = { id = distar.66 } }
	}

	option = {
		name = "distar.65.b"
		custom_tooltip = "distar.65.b.tooltip"
		hidden_effect = {
			event_target:kohtalo_second_fleet = {
				delete_fleet = this
			}
			country_event = { id = distar.68 days = 360 }
		}
	}
}

country_event = {
	id = distar.66
	title = "distar.66.name"
	diplomatic_title = BLANK_STRING
	desc = "distar.66.desc"
	location = event_target:kohtalo_second_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:kohtalo_captain
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.66.a"
		hidden_effect = {
			event_target:kohtalo_second_fleet = {
				delete_fleet = this
			}
			country_event = { id = distar.67 days = 360 }
		}
	}
}

country_event = {
	id = distar.67
	title = "distar.67.name"
	desc = "distar.67.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_ship_explosion
	location = event_target:kohtalo_second_ambient

	is_triggered_only = yes

	immediate = {
		event_target:ouroboros_pulsar = {
			create_ambient_object = {
				type = "kohtalo_object"
				location = this
			}
			last_created_ambient_object = {
				set_location = {
					target = event_target:ouroboros_pulsar
					distance = 20
					angle = random
				}
				save_event_target_as = kohtalo_second_ambient
			}
		}
	}

	option = {
		name = OOPS
		event_target:ouroboros_pulsar = {
			add_deposit = d_physics_7
		}
	}

	after = {
		if = {
			limit = {
				exists = event_target:kohtalo_country
			}
			event_target:kohtalo_country = {
				destroy_country = yes
			}
		}
	}
}

country_event = {
	id = distar.68
	title = "distar.68.name"
	desc = "distar.68.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_ship_explosion
	location = event_target:kohtalo_second_ambient

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				exists = event_target:kohtalo_country
			}
			event_target:kohtalo_country = {
				destroy_country = yes
			}
		}
		create_ambient_object = {
			type = "kohtalo_object"
			location = event_target:ouroboros_pulsar
		}
		last_created_ambient_object = {
			set_location = {
				target = event_target:ouroboros_pulsar
				distance = 20
				angle = random
			}
			save_event_target_as = kohtalo_second_ambient
		}
	}

	option = {
		name = "distar.68.a"
		event_target:ouroboros_pulsar = {
			add_deposit = d_physics_7
		}
	}
}

# Ruined Ringworld Clones
ship_event = {
	id = distar.70
	title = "distar.70.name"
	desc = "distar.70.desc"
	picture = GFX_evt_clones
	show_sound = event_laboratory_sound
	location = from

	is_triggered_only = yes

	immediate = {
		from = { set_deposit = d_physics_3 }
	}

	option = {
		name = "distar.70.a"
		trigger = {
			owner = {
				#any_owned_planet = { free_housing > 1	}
				NOR = { #Disallow for non-DS Hiveminds and non-Civic'd MIs
					AND = {
						is_machine_empire = yes
						NOR = {
							has_civic = civic_machine_terminator
							has_civic = civic_machine_assimilator
							has_civic = civic_machine_servitor
						}
					}
					AND = {
						is_hive_empire = yes
						NOT = {
							has_civic = civic_hive_devouring_swarm
						}
					}
				}
			}
		}
		from = {
			enable_special_project = {
				name = "CRYO_CLONES_PROJECT"
				location = this
				owner = root.owner
			}
		}
		hidden_effect = {
			owner = { pop_lcluster_event = yes }
		}
	}

	option = {
		name = "distar.70.b"
		from = {
			add_modifier = { modifier = clones_in_cryo days = -1 }
			add_deposit = d_society_4
		}
		hidden_effect = {
			owner = { pop_lcluster_event = yes }
		}
	}

	option = {
		name = "distar.70.exter"
		custom_tooltip = "distar.70.exter.tooltip"
		exclusive_trigger = {
			owner = { has_civic = civic_machine_terminator }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
	option = {
		name = "distar.70.fp"
		custom_tooltip = "distar.70.fp.tooltip"
		exclusive_trigger = {
			owner = { has_civic = civic_fanatic_purifiers }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier3influencereward
				min = @tier3influencemin
				max = @tier3influencemax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
	option = { #In the event of no free tiles (ignoring Terminators and Swarm)
		name = "distar.70.no_room"
		trigger = {
			owner = {
				NOR = {
					#any_owned_planet = { free_housing > 1	}
					has_civic = civic_hive_devouring_swarm
					has_civic = civic_machine_terminator
				}
			}
		}
		from = {
			add_modifier = { modifier = clones_in_cryo days = -1 }
			add_deposit = d_society_4
		}
		hidden_effect = {
			owner = { pop_lcluster_event = yes }
		}
	}
}

ship_event = {
	id = distar.71
	title = "distar.71.name"
	desc = "distar.71.desc"
	picture = GFX_evt_clones
	show_sound = event_laboratory_sound
	location = fromfrom

	is_triggered_only = yes

	immediate = {
		IF = {
			LIMIT = {
				NOR = {
					exists = event_target:cryonic_clones
					owner = { species_portrait = mam8 }
				}
			}
			create_species = {
				name = "NAME_Cryonic_Clone"
				plural = "NAME_Cryonic_Clones"
				class = "MAM"
				portrait = mam8
				namelist = "MAM2"
				traits = {
					trait = "trait_presapient_proles"
					trait = "trait_strong"
					trait = "trait_nerve_stapled"
					trait = "trait_pc_nuked_preference"
				}
				effect = {
					save_global_event_target_as = cryonic_clones
				}
			}
		}
		ELSE_IF = {
			LIMIT = {
				NOT = {
					exists = event_target:cryonic_clones
				}
				owner = { species_portrait = mam8 }
			}
			create_species = {
				name = "NAME_Cryonic_Clone"
				plural = "NAME_Cryonic_Clones"
				class = "REP"
				portrait = rep15
				namelist = "REP2"
				traits = {
					trait = "trait_presapient_proles"
					trait = "trait_strong"
					trait = "trait_nerve_stapled"
					trait = "trait_pc_nuked_preference"
				}
				effect = {
					save_global_event_target_as = cryonic_clones
				}
			}
		}
		owner = {
			random_owned_planet = {
				weights = {
					base = 1
					modifier = {
						add = 5
						free_housing > 0
					}
					modifier = {
						add = 10
						free_housing > 1
					}
				}
				save_event_target_as = pop_planet
			}
		}
	}

	option = { #Default, if you have free tiles
		name = "distar.71.pop.default"
		custom_tooltip = "distar.71.pop.tooltip"
		trigger = {
			owner = {
				NOR = {
					has_ethic = "ethic_xenophile"
					has_ethic = "ethic_fanatic_xenophile"
					has_ethic = "ethic_gestalt_consciousness"
					has_policy_flag = slavery_allowed
				}
				#any_owned_planet = {
				#	free_housing > 1
				#}
			}
		}
		hidden_effect = {
			owner = {
				random_owned_planet = {
					weights = {
						base = 1
						modifier = {
							add = 5
							free_housing > 0
						}
						modifier = {
							add = 10
							free_housing > 1
						}
					}
					while = {
						count = 2
						create_pop = {
							species = event_target:cryonic_clones
						}
					}
				}
			}
		}
	}

	option = {
		name = "distar.71.no_room"
		trigger = {
			owner = {
				NOT = {
					any_owned_planet = { free_housing > 1	} #You can say no room, but we all know you could have made space!
				}
			}
		}
		create_fleet = {
			name = "NAME_Cryonic_Clones_Colonizer"
			effect = {
				set_owner = root.owner
				create_ship = {
					name = "NAME_Cryonic_Clones_Colonizer"
					random_existing_design = colonizer
					colonizer_species = event_target:cryonic_clones
					prefix = no
					upgradable = no
				}
				set_location = {
					target = root
					distance = 5
					angle = random
				}
			}
			settings = {
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
				spawn_debris = no
			}
		}
		hidden_effect = {
			owner = { set_country_flag = got_cryonic_clone_colonizer }
		}
	}

	option = { #Phile and free tiles
		name = "distar.71.pop.phile"
		custom_tooltip = "distar.71.pop.tooltip"
		trigger = {
			owner = {
				OR = {
					has_ethic = "ethic_xenophile"
					has_ethic = "ethic_fanatic_xenophile"
				}
				#any_owned_planet = {
				#	free_housing > 1
				#}
			}
		}
		hidden_effect = {
			owner = {
				random_owned_planet = {
					weights = {
						base = 1
						modifier = {
							add = 5
							free_housing > 0
						}
						modifier = {
							add = 10
							free_housing > 1
						}
					}
					while = {
						count = 2
						create_pop = {
							species = event_target:cryonic_clones
						}
					}
				}
			}
		}
	}

	option = { #Slaver and free tiles
		name = "distar.71.pop.slave"
		custom_tooltip = "distar.71.pop.tooltip"
		trigger = {
			owner = {
				has_policy_flag = slavery_allowed
				#any_owned_planet = {
				#	free_housing > 1
				#}
			}
		}
		hidden_effect = {
			owner = {
				random_owned_planet = {
					weights = {
						base = 1
						modifier = {
							add = 5
							free_housing > 0
						}
						modifier = {
							add = 10
							free_housing > 1
						}
					}
					while = {
						count = 2
						create_pop = {
							species = event_target:cryonic_clones
						}
					}
				}
			}
		}
	}

	option = { #Devouring Swarm with or without free tiles
		name = "distar.71.pop.swarm"
		exclusive_trigger = {
			owner = { has_civic = civic_hive_devouring_swarm }
		}
		owner = {
			#IF = {
			#	LIMIT = {
			#		any_owned_planet = {
			#			free_housing > 1
			#		}
			#	}
			#	custom_tooltip = "distar.71.pop.tooltip"
			#	hidden_effect = {
			#		random_owned_planet = {
			#			limit = { free_housing > 1 }
			#			while = {
			#				count = 2
			#				create_pop = {
			#					species = event_target:cryonic_clones
			#				}
			#		}
			#	}
			#	}
			#}
			#ELSE = {
				custom_tooltip = "distar.71.swarm.alt.tooltip"
				add_monthly_resource_mult = {
					resource = food
					value = @tier4materialreward
					min = @tier4materialmin
					max = @tier4materialmax
				}
				add_monthly_resource_mult = {
					resource = unity
					value = @tier1unityreward
					min = @tier1unitymin
					max = @tier1unitymax
				}
			#}
		}
	}

	option = { #Servitor and free tiles
		name = "distar.71.pop.servi"
		custom_tooltip = "distar.71.pop.tooltip"
		trigger = {
			owner = {
				has_civic = civic_machine_servitor
				#any_owned_planet = {
				#	free_housing > 1
				#}
			}
		}
		hidden_effect = {
			owner = {
				random_owned_planet = {
					weights = {
						base = 1
						modifier = {
							add = 5
							free_housing > 0
						}
						modifier = {
							add = 10
							free_housing > 1
						}
					}
					while = {
						count = 2
						create_pop = {
							species = event_target:cryonic_clones
						}
					}
				}
			}
		}
	}

	option = { #Assimilator and free tiles
		name = "distar.71.pop.assim"
		custom_tooltip = "distar.71.pop.tooltip"
		trigger = {
			owner = {
				has_civic = civic_machine_assimilator
				#any_owned_planet = { free_housing > 1	}
			}
		}
		hidden_effect = {
			owner = {
				random_owned_planet = {
					weights = {
						base = 1
						modifier = {
							add = 5
							free_housing > 0
						}
						modifier = {
							add = 10
							free_housing > 1
						}
					}
					while = {
						count = 2
						create_pop = {
							species = event_target:cryonic_clones
						}
					}
				}
			}
		}
	}
}

planet_event = { #On colonizing the repaired Megastructure section
	id = distar.72
	title = "distar.72.name"
	desc = "distar.72.desc"
	picture = GFX_evt_clones
	show_sound = event_laboratory_sound
	location = root

	is_triggered_only = yes

	trigger = {
		solar_system = { #If we did not thaw out the clones earlier
			star = { has_modifier = clones_in_cryo }
		}
		is_planet_class = pc_ringworld_habitable
	}

	immediate = {
		solar_system = {
			star = {
				clear_deposits = yes
				remove_modifier = clones_in_cryo
			}
		}
		IF = {
			LIMIT = {
				NOR = {
					exists = event_target:cryonic_clones
					owner = { species_portrait = mam8 }
				}
			}
			create_species = {
				name = "NAME_Cryonic_Clone"
				plural = "NAME_Cryonic_Clones"
				class = "MAM"
				portrait = mam8
				namelist = "MAM2"
				traits = {
					trait = "trait_presapient_proles"
					trait = "trait_strong"
					trait = "trait_nerve_stapled"
					trait = "trait_pc_nuked_preference"
				}
				effect = {
					save_global_event_target_as = cryonic_clones
				}
			}
		}
		ELSE_IF = {
			LIMIT = {
				NOT = {
					exists = event_target:cryonic_clones
				}
				owner = { species_portrait = mam8 }
			}
			create_species = {
				name = "NAME_Cryonic_Clone"
				plural = "NAME_Cryonic_Clones"
				class = "REP"
				portrait = rep15
				namelist = "REP2"
				traits = {
					trait = "trait_presapient_proles"
					trait = "trait_strong"
					trait = "trait_nerve_stapled"
					trait = "trait_pc_nuked_preference"
				}
				effect = {
					save_global_event_target_as = cryonic_clones
				}
			}
		}
	}

	option = {
		name = "distar.72.a"
		trigger = {
			owner = {
				NOR = {
					has_civic = civic_machine_terminator
					has_civic = civic_fanatic_purifiers
				}
			}
		}
		add_deposit = d_cryonic_clones
	}

	option = {
		name = "distar.72.b"
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_gestalt_consciousness
					has_civic = civic_fanatic_purifiers
				}
			}
		}
		hidden_effect = {
			while = {
				count = 2
				create_pop = {
					species = event_target:cryonic_clones
				}
			}
		}
	}

	option = {
		name = "distar.71.pop.assim"
		trigger = {
			owner = { has_civic = civic_machine_assimilator }
		}
		hidden_effect = {
			while = {
				count = 2
				create_pop = {
					species = event_target:cryonic_clones
				}
			}
		}
	}

	option = {
		name = "distar.72.b.servi"
		trigger = {
			owner = { has_civic = civic_machine_servitor }
		}
		hidden_effect = {
			while = {
				count = 2
				create_pop = {
					species = event_target:cryonic_clones
				}
			}
		}
	}

	option = {
		name = "distar.71.pop.swarm"
		trigger = {
			owner = { has_civic = civic_hive_devouring_swarm }
		}
		hidden_effect = {
			while = {
				count = 2
				create_pop = {
					species = event_target:cryonic_clones
				}
			}
		}
	}

	option = {
		name = "distar.72.c"
		trigger = {
			owner = {
				NOR = {
					has_civic = civic_machine_servitor
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_fanatic_egalitarian
				}
			}
		}
	}
}

planet_event = { #On colonizing planet with Cryonic Clones Colonizer
	id = distar.73
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			controller = { has_country_flag = got_cryonic_clone_colonizer }
			owner = { has_country_flag = got_cryonic_clone_colonizer }
		}
		this = {
			any_owned_pop = {
				is_same_species = event_target:cryonic_clones
			}
		}
	}

	immediate = {
		every_owned_pop = {
			limit = { is_same_species = event_target:cryonic_clones }
			kill_pop = yes
		}
		create_pop = {
			species = owner_main_species
		}
		create_pop = {
			species = event_target:cryonic_clones
		}
		owner = { remove_country_flag = got_cryonic_clone_colonizer }
	}
}

#Asteroid Geode
ship_event = {
	id = distar.75
	title = "distar.75.name"
	desc = "distar.75.desc"
	picture = GFX_evt_asteroid_field
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		from = {
			add_rare_crystals = yes
		}
		hidden_effect = { ship_event = { id = distar.305 days = 1 } }
	}
}

#Dead God
ship_event = {
	id = distar.80
	title = "distar.80.name"
	desc = "distar.80.desc"
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal
	location = from

	is_triggered_only = yes

	immediate = {
		solar_system = {
			random_system_planet = {
				limit = {
					exists = owner
					owner = { is_primitive = yes }
					has_moon = yes
					any_moon = { is_same_value = from }
				}
				save_event_target_as = primitive_planet
			}
		}
		from = {
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		from = {
			add_deposit = d_society_5
			hidden_effect = {
				event_target:primitive_planet = {
					remove_modifier = dead_god_planet_hidden
					add_modifier = { modifier = dead_god_planet days = -1 }
				}
				add_modifier = { modifier = dead_god days = -1 }
			}
		}
	}
}

# on_planet_attackers_win
# This = country, leader attacker
# From = country, planet owner
# FromFrom = planet
country_event = {
	id = distar.81
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_modifier = dead_god_planet
				has_modifier = dead_god_planet_hidden
			}
		}
		from = { is_primitive = yes }
	}

	immediate = {
		fromfrom = { save_event_target_as = dead_god_planet }
		from.species = {
			save_event_target_as = worshipper_species
		}
		country_event = { id = distar.82 days = 2 }
	}
}

country_event = {
	id = distar.82
	title = "distar.82.name"
	desc = "distar.82.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_mystic_reveal
	location = event_target:dead_god_planet

	is_triggered_only = yes

	option = {
		name = "distar.82.a"
		event_target:dead_god_planet = {
			custom_tooltip = distar.82.a.tt
			hidden_effect = {
				every_owned_pop = {
					limit = { is_same_species = event_target:worshipper_species }
					add_modifier = { modifier = conviction days = 7200 }
				}
			}
		}
		give_specimen = { key = dead_god_mantle }
	}

	option = {
		name = "distar.82.b"
	}

	option = {
		name = "distar.82.c"
		trigger = {
			OR = {
				has_civic = civic_hive_devouring_swarm
				has_policy_flag = purge_allowed
			}
		}
	}

	option = {
		name = "distar.82.d"
		trigger = {
			has_policy_flag = purge_displacement_only
		}
	}
}

#Electric Impulses
ship_event = {
	id = distar.85
	title = "distar.85.name"
	desc = "distar.85.desc"
	picture = GFX_evt_hive
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	specimen = electric_life

	immediate = {
		owner = { country_event = { id = story.1 days = 30 } }
		from = {
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = FASCINATING
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		from = {
			add_deposit = d_society_3
			hidden_effect = {
				add_modifier = { modifier = life_electric days = -1 }
			}
		}
		leader = { add_skill_without_trait_selection = 1 }
	}

	option = {
		name = "distar.234.phobe"
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		from = {
			add_deposit = d_society_3
			hidden_effect = {
				add_modifier = { modifier = life_electric days = -1 }
			}
		}
		leader = { add_skill_without_trait_selection = 1 }
	}
}

#Sagittarius B2
ship_event = {
	id = distar.90
	title = "distar.90.name"
	desc = "distar.90.desc"
	picture = GFX_evt_gas_giant
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	trigger = {
		owner = { is_machine_empire = no }
	}

	option = {
		name = "distar.90.a"
	}

	option = {
		name = "distar.90.b"
		owner = {
			add_modifier = { modifier = rummy_nebula days = 3600 }
		}
	}
}

#Sagittarius B2 Machine Intelligence version
ship_event = {
	id = distar.91
	title = "distar.91.name"
	desc = "distar.91.desc"
	picture = GFX_evt_gas_giant
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	trigger = {
		owner = { is_machine_empire = yes }
	}

	immediate = {
		owner = {
			random_neighbor_country = {
				limit = {
					is_country_type = default
					has_communications = prev
					NOR = {
						has_ethic = ethic_gestalt_consciousness
						is_at_war_with = prev
						is_country = prev
					}
				}
				save_event_target_as = rum_nation
			}
		}
	}

	option = {
		name = "distar.91.a"
		custom_tooltip = "distar.91.a.tooltip"
		hidden_effect = {
			owner = { country_event = { id = distar.92 days = 30 } }
			owner = { country_event = { id = distar.93 days = 30 } }
		}
	}

	option = {
		name = "distar.91.b"
	}
}

country_event = {
	id = distar.92
	title = "distar.92.name"
	desc = "distar.92.desc"
	location = event_target:rum_nation

	diplomatic = yes

	is_triggered_only = yes

	trigger = {
		event_target:rum_nation = { NOT = { is_hostile_to = root } }
	}

	picture_event_data = {
		portrait = event_target:rum_nation
		planet_background = event_target:rum_nation
		graphical_culture = event_target:rum_nation
		city_level = event_target:rum_nation
		room = event_target:rum_nation.ruler
	}

	option = {
		name = distar.92.a
		add_resource = { influence = 100 }
		event_target:rum_nation = {
			add_modifier = { modifier = rummy_nebula days = 3600 }
			add_opinion_modifier = {
				who = root
				modifier = opinion_gave_space_rum
			}
		}
	}
}

country_event = {
	id = distar.93
	title = "distar.93.name"
	desc = "distar.93.desc"
	location = event_target:rum_nation

	diplomatic = yes

	is_triggered_only = yes

	trigger = {
		event_target:rum_nation = { is_hostile_to = root }
	}

	picture_event_data = {
		portrait = event_target:rum_nation
		planet_background = event_target:rum_nation
		graphical_culture = event_target:rum_nation
		city_level = event_target:rum_nation
		room = event_target:rum_nation.ruler
	}

	option = {
		name = distar.93.a
		event_target:rum_nation = {
			add_opinion_modifier = {
				who = root
				modifier = opinion_space_rum_failed
			}
		}
	}
}

#Resonant Crystals
ship_event = {
	id = distar.95
	title = "distar.95.name"
	desc = "distar.95.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_scanner
	location = from

	is_triggered_only = yes
	specimen = vibrating_crystal

	option = {
		name = INTERESTING
		from = {
			add_modifier = { modifier = soothing_crystals days = -1 }
		}
	}
}

ship_event = { #GC version
	id = distar.100
	title = "distar.100.name"
	desc = "distar.100.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = {
		name = "distar.100.a"
		from = {
			add_modifier = { modifier = good_vibrations days = -1 }
		}
	}
}

ship_event = { #Exofungus
	id = distar.105
	title = "distar.105.name"
	desc = "distar.105.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	specimen = invasive_exofungus

	option = {
		name = WORRYING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

ship_event = { #White Hell
	id = distar.110
	title = "distar.110.name"
	desc = "distar.110.desc"
	picture = GFX_evt_frozen
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	specimen = hot_ice

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_mining_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = CURIOUS
		from = {
			add_deposit = d_physics_3
		}
	}
}

ship_event = { #Heavy Metal Frost
	id = distar.115
	title = "distar.115.name"
	desc = "distar.115.desc"
	picture = GFX_evt_toxic
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	specimen = metallic_snow

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_research_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = INTERESTING
		from = {
			add_deposit = d_minerals_3
		}
	}
}

ship_event = { #Watery Grave
	id = distar.120
	title = "distar.120.name"
	desc = "distar.120.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	specimen = flooded_settlement_mound

	option = {
		name = INTERESTING
		from = {
			add_modifier = { modifier = watery_grave days = -1 }
			add_deposit = d_flooded_mounds
		}
	}
}

ship_event = { #Vacuum Collapse
	id = distar.125
	title = "distar.125.name"
	desc = "distar.125.desc"
	picture = GFX_evt_ruined_system
	show_sound = event_scanner
	location = event_target:derelict_particle_accelerator

	is_triggered_only = yes

	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		add_expertise_trait_to_leader_or_research_node_effect = {
			TRAIT = leader_trait_expertise_particles
		}
	}
}

ship_event = { #Old Foes Gatekeeper
	id = distar.130
	hide_window = yes

	is_triggered_only = yes

	#fire_only_once = yes

	trigger = {
		NOT = { has_global_flag = pyorun_czyrni_surveyed }
		from = {
			OR = {
				has_planet_flag = pyorun_planet
				has_planet_flag = czyrni_planet
			}
		}
	}

	immediate = { #For narrative reasons, anomaly spawns for the second planet
		set_global_flag = pyorun_czyrni_surveyed
		from = {
			IF = {
				LIMIT = { has_planet_flag = pyorun_planet }
				solar_system = {
					random_system_planet = {
						limit = { has_planet_flag = czyrni_planet }
						add_anomaly = {
							category = DISTAR_FOES_CAT
						}
					}
				}
			}
			ELSE_IF = {
				LIMIT = { has_planet_flag = czyrni_planet }
				solar_system = {
					random_system_planet = {
						limit = { has_planet_flag = pyorun_planet }
						add_anomaly = {
							category = DISTAR_FOES_CAT
						}
					}
				}
			}
			ELSE = {
				#Nothing
			}
		}
	}
}

ship_event = { #Old Foes
	id = distar.131
	title = "distar.131.name"
	desc = "distar.131.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	immediate = {
		IF = {
			LIMIT = { from = { has_planet_flag = czyrni_planet } }
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = pyorun_planet }
					save_event_target_as = other_planet
				}
			}
		}
		ELSE = {
			solar_system = {
				random_system_planet = {
					limit = { has_planet_flag = czyrni_planet }
					save_event_target_as = other_planet
				}
			}
		}
	}

	option = {
		name = UNFORTUNATE
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

fleet_event = { #Scrap bot!
	id = distar.135
	title = "distar.135.name"
	desc = "distar.135.desc"
	picture = GFX_evt_scavenger_bot
	show_sound = event_construction
	location = event_target:scavenger_bot_system

	is_triggered_only = yes

	trigger = {
		from = { has_star_flag = scavenger_bot_system }
		owner = {
			is_country_type = default
			NOT = { has_country_flag = encountered_scavenger_bot }
		}
		exists = event_target:scavenger_bot_fleet
		exists = event_target:scavenger_bot_country
	}

	immediate = {
		random_system = {
			limit = { has_star_flag = scavenger_bot_system }
			save_event_target_as = scavenger_bot_system
		}
		owner = {
			set_country_flag = encountered_scavenger_bot
			establish_communications_no_message = event_target:scavenger_bot_country
			country_event = { id = story.8 days = 15 }
		}
	}

	option = {
		name = DISCONCERTING
	}
}

country_event = {
	id = distar.136
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:scavenger_bot_country
		is_same_value = event_target:scavenger_bot_country
		exists = event_target:scavenger_bot_fleet
		from = {
			is_same_value = event_target:scavenger_bot_fleet
		}
	}

	immediate = {
		from.solar_system = {
			random_system_planet = {
				limit = {
					NOT = { is_same_value = root.from.orbit }
				}
				save_event_target_as = new_location
			}
		}
		from = {
			auto_move_to_planet = {
				target = event_target:new_location
				clear_auto_move_on_arrival = no
			}
		}
	}
}

country_event = { #Death of Scavenger Bot
	id = distar.137
	title = "distar.137.name"
	desc = "distar.137.desc"
	picture = GFX_evt_large_explosion
	show_sound = event_space_battle
	location = FromFromFrom

	is_triggered_only = yes

	trigger = {
		exists = event_target:scavenger_bot_fleet
		FromFromFrom.fleet = {
			is_same_value = event_target:scavenger_bot_fleet
		}
	}

	immediate = {
		set_country_flag = scrapper_killed # Achievement flag
		every_playable_country = {
			limit = {
				has_event_chain = curator_poi_chain
				fromfrom.solar_system = {
					is_point_of_interest = {
						id = curator_poi_scavenger_bot
						event_chain = curator_poi_chain
						owner = prev
					}
				}
			}
			remove_point_of_interest = curator_poi_scavenger_bot
			end_curator_chain = yes
		}
	}

	option = {
		name = OK
		exclusive_trigger = {
			NOT = { is_country_type = default }
		}
	}

	option = {
		name = "distar.137.a"
		hidden_effect = {
			set_variable = { which = picked_tech value = 0 }
			if = {
				limit = {
					has_technology = tech_ship_armor_5
					has_technology = tech_shields_5
					has_technology = tech_mass_drivers_5
					has_technology = tech_missiles_5
					has_technology = tech_lasers_5
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier5researchreward
					min = @tier5researchreward
					max = @tier5researchreward
				}
			}
			else = {
				while = {
					limit = {
						check_variable = {
							which = picked_tech
							value < 2
						}
					}
					count = 5
					random_list = {
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_ship_armor_5
							}
							give_technology = { tech = tech_ship_armor_5 }
							change_variable = { which = "picked_tech" value = 1 }
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_shields_5
							}
							give_technology = { tech = tech_shields_5 }
							change_variable = { which = "picked_tech" value = 1 }
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_mass_drivers_5
							}
							give_technology = { tech = tech_mass_drivers_5 }
							change_variable = { which = "picked_tech" value = 1 }
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_missiles_5
							}
							give_technology = { tech = tech_missiles_5 }
							change_variable = { which = "picked_tech" value = 1 }
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_lasers_5
							}
							give_technology = { tech = tech_lasers_5 }
							change_variable = { which = "picked_tech" value = 1 }
						}
					}
				}
			}
		}
		give_nanite_techs = yes
		custom_tooltip = distar.137.tooltip
	}

	option = {
		name = "distar.137.paci"
		trigger = {
			has_ethic = ethic_fanatic_pacifist
			has_ethic = ethic_pacifist
			has_ethic = ethic_fanatic_xenophile
			has_ethic = ethic_xenophile
		}
		hidden_effect = {
			set_variable = { which = picked_tech value = 0 }
			if = {
				limit = {
					has_technology = tech_ship_armor_5
					has_technology = tech_shields_5
					has_technology = tech_mass_drivers_5
					has_technology = tech_missiles_5
					has_technology = tech_lasers_5
				}
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier5researchreward
					min = @tier5researchreward
					max = @tier5researchreward
				}
			}
			else = {
				while = {
					limit = {
						check_variable = {
							which = picked_tech
							value < 2
						}
					}
					random_list = {
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_ship_armor_5
							}
							give_technology = { tech = tech_ship_armor_5 }
							change_variable = { which = "picked_tech" value = 1 }
							tooltip = {
								give_technology = { tech = tech_ship_armor_5 }
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_shields_5
							}
							give_technology = { tech = tech_shields_5 }
							change_variable = { which = "picked_tech" value = 1 }
							tooltip = {
								give_technology = { tech = tech_shields_5 }
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_mass_drivers_5
							}
							give_technology = { tech = tech_mass_drivers_5 }
							change_variable = { which = "picked_tech" value = 1 }
							tooltip = {
								give_technology = { tech = tech_mass_drivers_5 }
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_missiles_5
							}
							give_technology = { tech = tech_missiles_5 }
							change_variable = { which = "picked_tech" value = 1 }
							tooltip = {
								give_technology = { tech = tech_missiles_5 }
							}
						}
						1 = {
							modifier = {
								factor = 0
								has_technology = tech_lasers_5
							}
							give_technology = { tech = tech_lasers_5 }
							change_variable = { which = "picked_tech" value = 1 }
							tooltip = {
								give_technology = { tech = tech_lasers_5 }
							}
						}
					}
				}
			}
		}
		give_nanite_techs = yes
	}
	option = {
		name = distar.137.harv
		trigger = {
			can_harvest_parts = yes
		}
		set_country_flag = harvested_scavenger_parts
		add_research_option = tech_leviathan_techgenesis
	}
	after = {
		generate_parade_city = yes
		start_situation = {
			type = leviathan_celebration_opportunity
			target = event_target:parade_city
			effect = {
				set_situation_flag = celebration_scavenger_bot
				set_situation_flag = standard_unity_reward
			}
		}
	}
}

ship_event = {
	id = distar.140
	title = "distar.140.name"
	desc = "distar.140.desc"
	picture = GFX_evt_star_white
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	specimen = cosmic_diamond_fragment

	immediate = {
		from = {
			IF = {
				limit = { has_deposit_for = shipclass_mining_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = FASCINATING
		from = {
			add_deposit = d_physics_4
		}
	}
}

ship_event = {
	id = distar.145
	title = "distar.145.name"
	desc = "distar.145.desc"
	picture = GFX_evt_molten
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			clear_deposits = yes
		}
		owner = { country_event = { id = story.1 days = 30 } }
	}

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
		}
		from = {
			add_exotic_gases = yes
		}
		hidden_effect = { ship_event = { id = distar.305 days = 1 } }
	}
}

ship_event = {
	id = distar.150
	title = "distar.150.name"
	desc = "distar.150.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_ship_bridge
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			clear_deposits = yes
		}
		owner = { country_event = { id = story.1 days = 30 } }
	}

	option = {
		name = CURIOUS
		owner = {
			if = {
				limit = {
					has_tech_option = tech_mine_living_metal
				}
				add_tech_progress = {
					tech = tech_mine_living_metal
					progress = 0.25
				}
			}
			else = {
				add_research_option = tech_mine_living_metal
			}
		}
		from = {
			add_deposit = d_living_metal_deposit
		}
	}
}

ship_event = { #The Big Friendly Warform
	id = distar.155
	title = "distar.155.name"
	desc = "distar.155.desc"
	picture = GFX_evt_toxic
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = {
		# Ariphaos Todo: Move this to dialog?
		trigger = {
			owner = { NOR = { has_policy_flag = ai_outlawed is_machine_empire = yes } }
		}
		name = "distar.155.a"
		from = {
			enable_special_project = {
				name = "RECOVER_WARFORM_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		trigger = {
			owner = { NOR = { has_policy_flag = ai_outlawed is_machine_empire = yes } }
		}
		name = "distar.155.b"
		custom_tooltip = distar.155.machine.tt
	}
	option = {
		trigger = {
			owner = { has_policy_flag = ai_outlawed }
		}
		name = "distar.155.c"
		custom_tooltip = "distar.155.c.tooltip"
	}
	option = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		name = "distar.155.machi"
		from = {
			enable_special_project = {
				name = "RECOVER_WARFORM_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}
	option = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		name = "distar.155.machi_2"
		custom_tooltip = distar.155.machine.tt
	}
}

ship_event = {
	id = distar.156
	title = "distar.156.name"
	desc = {
		trigger = {
			owner = { is_machine_empire = no }
		}
		text = "distar.156.desc"
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		text = "distar.156.desc.machi"
	}
	picture = GFX_evt_space_debris
	show_sound = event_construction
	location = event_target:repaired_warform

	is_triggered_only = yes

	immediate = {
		from = { # For end chain specimen localization
			save_event_target_as = warform_origin_planet
		}

		save_event_target_as = research_ship

		create_species = {
			name = "NAME_S8751"
			class = MACHINE
			portrait = cpl_03
			namelist = "AI"
			traits = {
				ideal_planet_class = pc_habitat
				trait = trait_machine_unit
				trait = random_traits
			}
			effect = {
				save_event_target_as = warform_species
			}
		}

		create_country = {
			name = "NAME_S8751"
			type = nice_faction
			auto_delete = yes
			species = event_target:warform_species
			flag = {
				icon = {
					category = "special"
					file = "unknown.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"green"
					"green"
					"null"
					"null"
				}
			}
			effect = {
				save_event_target_as = warform_country
			}
		}
		event_target:warform_country = {
			set_faction_hostility = {
				target = root.owner
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			create_species = {
				name = "NAME_S8751"
				class = ROBOT
				portrait = cpl_03
				namelist = "AI"
				traits = {
					trait = trait_machine_unit
					trait = random_traits
				}
				effect = {
					save_event_target_as = warform_species
				}
			}
			create_leader = {
				class = commander
				species = event_target:warform_species
				name = NAME_S8751
				skill = 5
				gender = indeterminable
				event_leader = no # Leader is allowed to lead factions and win elections
				background_ethic = ethic_gestalt_consciousness
				skip_background_generation = yes
				custom_description = warform_leader_desc
				custom_catch_phrase = warform_leader_catch_phrase
				immortal = yes
				hide_age = no

				randomize_traits = no
				effect = {
					set_skill = 5
					set_leader_flag = renowned_leader
					set_leader_flag = is_in_recruit_window
					save_event_target_as = warform_leader
					add_trait = leader_trait_admiral_warform
					add_trait = subclass_commander_admiral
					add_trait = leader_trait_skirmisher_2
					add_trait = leader_trait_scout
					save_global_event_target_as = warform_leader
					set_age = 1578
				}
			}
			create_fleet = {
				name = "NAME_S8751"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_S8751"
						design = "NAME_S8751"
						prefix = no
						upgradable = yes
					}
					set_location = {
						target = root
						distance = 10
						angle = random
					}
					set_fleet_stance = passive
					add_modifier = { modifier = "big_friendly_warform_power" days = -1 }
					assign_leader = event_target:warform_leader
					set_fleet_flag = repaired_warform
					save_event_target_as = repaired_warform
				}
				settings = {
					can_upgrade = yes
					can_change_leader = no
					uses_naval_capacity = yes
					spawn_debris = yes
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			owner = {
				country_event = { id = distar.158 }
			}
		}
	}
}

country_event = { #on_fail
	id = distar.157
	title = "distar.157.name"
	desc = "distar.157.desc"
	picture = GFX_evt_toxic
	show_sound = event_scanner
	location = fromfrom

	is_triggered_only = yes

	option = {
		name = CURSES
	}

}

country_event = {
	id = distar.158
	title = "distar.158.name"
	desc = "distar.158.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.158.a"
		response_text = distar.158.a.response
		is_dialog_only = yes
	}

	option = {
		name = "distar.158.b"
		response_text = distar.158.b.response
		is_dialog_only = yes
	}

	option = {
		name = "distar.158.c"
		response_text = distar.158.c.response
		is_dialog_only = yes
	}

	option = {
		name = "distar.158.d"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.159 } }
	}

	option = {
		name = "distar.158.d.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.159 } }
	}

}

country_event = {
	id = distar.159
	title = "distar.158.name"
	desc = "distar.159.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.159.a"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.160 } }
	}
	option = {
		name = "distar.159.a.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.160 } }
	}
}

country_event = {
	id = distar.160
	title = "distar.158.name"
	desc = "distar.159.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.160.a"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.161 } }
	}
	option = {
		name = "distar.160.a.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.161 } }
	}
}

country_event = {
	id = distar.161
	title = "distar.158.name"
	desc = "distar.161.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.161.a"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.162 } }
	}
	option = {
		name = "distar.161.a.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.162 } }
	}
	option = {
		name = "distar.161.b"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.164 } }
	}
}

country_event = {
	id = distar.162
	title = "distar.158.name"
	desc = "distar.162.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.162.a"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.163 } }
	}
	option = {
		name = "distar.162.a.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.163 } }
	}
}

country_event = {
	id = distar.163
	title = "distar.158.name"
	desc = "distar.163.desc"
	location = event_target:repaired_warform

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.163.a"
		trigger = {
			is_machine_empire = no
		}
		hidden_effect = { country_event = { id = distar.164 } }
	}

	option = {
		name = "distar.163.a.machi"
		trigger = {
			is_machine_empire = yes
		}
		hidden_effect = { country_event = { id = distar.164 } }
	}
}

country_event = {
	id = distar.164
	title = "NAME_S8751"
	desc = "distar.164.desc"
	show_sound = event_ai_started
	is_triggered_only = yes

	picture = GFX_leader_recruitment_bg_renowned
	event_window_type = leader_recruit
	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}
	option = {
		name = distar.165.dismiss
		tag = dismiss_leader
		hidden_effect = { country_event = { id = distar.165 } }
	}
	option = {
		tag = hire_leader
		allow = {
			NOR = {
				has_civic = civic_fanatic_purifiers
				has_civic = civic_hive_devouring_swarm
			}
		}
		name = {
			trigger = {
				OR = {
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_materialist
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_pacifist
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
					has_ethic = ethic_gestalt_consciousness
				}
			}
			text =  "distar.164.a"
		}
		name = {
			trigger = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_materialist
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_gestalt_consciousness
				}
			}
			text = "distar.164.b"
		}
		name = {
			trigger = {
				is_machine_empire = yes
			}
			text = "distar.164.machi"
		}
		if = {
			limit = {
				is_gestalt = yes
			}
			random_owned_leader = {
				limit = {
					is_councilor_type = councilor_gestalt_legion
				}
				add_trait = leader_trait_admiral_warform_node
			}
		}
		hidden_effect = {
			hire_event_leader_effect = {
				LEADER = warform_leader
			}
		}
		event_target:repaired_warform = {
			hidden_effect = {
				leader = {
					unassign_leader = this
				}
			}
			set_owner = root
			hidden_effect = {
				set_leader = event_target:warform_leader
			}
		}
		if = {
			limit = {
				is_gestalt = yes
			}
			random_owned_leader = {
				limit = {
					is_councilor_type = councilor_gestalt_legion
				}
				add_trait = leader_trait_admiral_warform_node
			}
		}
	}
	option = {
		name = "distar.164.d"
		response_text = distar.164.d.response
		is_dialog_only = yes
	}
}

country_event = {
	id = distar.165
	title = "NAME_S8751"
	desc = "distar.165.desc"
	show_sound = event_ai_started
	event_window_type = leader_recruit
	picture = GFX_leader_recruitment_bg_renowned
	is_triggered_only = yes
	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}
	option = {
		name = distar.165.dismiss
		custom_tooltip = "distar.165.b"
		tag = dismiss_leader
		hidden_effect = {
			hidden_effect = { country_event = { id = distar.166 } }
		}
	}
	option = {
		name = "distar.165.a"
		tag = hire_leader
		allow = {
			NOR = {
				has_civic = civic_fanatic_purifiers
				has_civic = civic_hive_devouring_swarm
			}
		}
		hidden_effect = {
			hire_event_leader_effect = {
				LEADER = warform_leader
			}
		}
		event_target:repaired_warform = {
			hidden_effect = {
				leader = {
					unassign_leader = this
				}
			}
			set_owner = root
			hidden_effect = {
				set_leader = event_target:warform_leader
			}
		}
		if = {
			limit = {
				is_gestalt = yes
			}
			random_owned_leader = {
				limit = {
					is_councilor_type = councilor_gestalt_legion
				}
				add_trait = leader_trait_admiral_warform_node
			}
		}
	}
	option = {
		name = "distar.165.c"
		response_text = distar.165.c.response
		is_dialog_only = yes
	}
}

country_event = {
	id = distar.166
	title = "distar.158.name"
	desc = "distar.166.desc"
	show_sound = event_life_support_fail
	picture = GFX_evt_sapient_AI
	event_window_type = leader_story
	picture_event_data = {
		portrait = event_target:warform_leader
		room = ethic_spaceship_room
	}

	is_triggered_only = yes

	option = {
		name = OOPS
		hidden_effect = {
			event_target:research_ship = {
				ship_event = { id = distar.167 }
			}
		}
	}
}

ship_event = {
	id = distar.167
	title = "distar.167.name"
	desc = "distar.167.desc"
	picture = GFX_evt_sabotaged_ship
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	specimen = drone_ship_core

	immediate = {
		solar_system = {
			random_fleet_in_system = {
				LIMIT = { has_fleet_flag = repaired_warform }
				destroy_fleet = this
			}
		}
		if = {
			limit = { exists = event_target:warform_country }
			event_target:warform_country = {
				destroy_country = yes
			}
		}
	}

	option = {
		name = "distar.167.a"
		owner = {
			add_resource = { alloys = 75 }
		}
	}

	option = {
		name = "distar.167.b"
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
}

# Executed as a leader has been fired
# This = Country
# From = Leader
country_event = {
	id = distar.168
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		from = {
			OR = {
				has_trait = leader_trait_admiral_warform
				has_trait = leader_trait_govenor_caretaker
			}
		}
		is_gestalt = yes
	}

	immediate = {
		from = {
			switch = {
				trigger = has_trait
				leader_trait_admiral_warform = {
					random_owned_leader = {
						limit = {
							has_trait = leader_trait_admiral_warform_node
						}
						remove_trait = leader_trait_admiral_warform_node
					}
				}
				leader_trait_govenor_caretaker = {
					random_owned_leader = {
						limit = {
							has_trait = leader_trait_govenor_caretaker_node
						}
						remove_trait = leader_trait_govenor_caretaker_node
					}
				}
			}
		}
	}
}

#Happy Little Brainslugs
ship_event = {
	id = distar.170
	title = "distar.170.name"
	desc = {
		trigger = {
			owner = {
				is_machine_empire = no
			}
		}
		text = "distar.170.desc"
	}
	desc = {
		trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
		text = "distar.170.desc.machi"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = brainslug_divination_flag
		}
		from = {
			save_event_target_as = pre_sapient_planet
			create_generic_presapient_species = { UPLIFT_TO = REP }
		}
	}

	option = {
		trigger = {
			owner = {
				is_machine_empire = no
				is_homicidal = no
				any_owned_pop = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
						}
					}
				}
			}
		}
		name = "distar.170.a"
		from = {
			enable_special_project = {
				name = "BRAINSLUG_PROJECT"
				location = this
				owner = root.owner
			}
		}
	}

	option = {
		trigger = {
			owner = {
				is_machine_empire = no
			}
		}
		name = NOTIME
	}

	option = {
		trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
		name = "distar.170.machi"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
}

ship_event = {
	id = distar.171
	title = "distar.171.name"
	desc = "distar.171.desc"
	picture = GFX_evt_society_research
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	specimen = desiccated_brain_slug

	immediate = {
		leader = {
			save_event_target_as = brainslug_scientist
		}
	}

	option = {
		name = "distar.171.a"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}

	option = {
		name = "distar.171.b"
		hidden_effect = {
			ship_event = { id = distar.172 days = 30 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
	}
}

ship_event = {
	id = distar.172
	title = "distar.172.name"
	desc = "distar.172.desc"
	picture = GFX_evt_hive_mind
	show_sound = event_alien_nature
	location = root

	is_triggered_only = yes

	trigger = {
		exists = event_target:brainslug_scientist
	}

	immediate = {
		leader = {
			add_trait = leader_trait_brainslug
		}
		owner = {
			set_country_flag = finished_brainslug_chain
		}
	}

	option = {
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
		name = "distar.172.a"
		owner = {
			while = {
				count = 3
				random_owned_pop = {
					limit = {
						is_sapient = yes
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
								is_species_class = AI
							}
						}
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				while = {
					count = 2
					random_owned_leader = {
						LIMIT = {
							leader_class = scientist
							species = {
								NOR = {
									has_trait = trait_cybernetic
									has_trait = trait_mechanical
									has_trait = trait_machine_unit
									is_species_class = ROBOT
									is_species_class = AI
								}
							}
						}
						add_trait = leader_trait_brainslug
					}
				}
				random_owned_leader = {
					LIMIT = {
						leader_class = official
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
								is_species_class = AI
							}
						}
						NOR = {
							has_leader_flag = beholder
							has_leader_flag = gray_leader
							has_trait = leader_trait_governor_oracle
						}
					}
					add_trait = leader_trait_brainslug
				}
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		trigger = { # at least one sluggable pop in xenophobe empire
			hidden_trigger = {
				owner = {
					OR = {
						has_ethic = ethic_xenophobe
						has_ethic = ethic_fanatic_xenophobe
					}
					any_owned_pop = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
					}
				}
			}
		}
		name = "distar.172.a"
		owner = {
			while = { # slug *up to* three non-phobe pops
				count = 3
				random_owned_pop = {
					LIMIT = {
						NOR = {
							has_ethic = ethic_xenophobe
							has_ethic = ethic_fanatic_xenophobe
						}
						species = {
							NOR = {
								has_trait = trait_cybernetic
								has_trait = trait_mechanical
								has_trait = trait_machine_unit
								is_species_class = ROBOT
							}
						}
						is_sapient = yes
					}
					modify_species = {
						species = this
						add_trait = trait_brainslug
						add_traits_at_start_of_list = yes
						effect = {
							set_citizenship_type = {
								country = root.owner
								type = citizenship_full
								cooldown = no
							}
						}
					}
				}
			}
			hidden_effect = {
				country_event = { id = distar.174 } #Pool leaders get trait
				country_event = { id = distar.175 } #Unrest is generated
			}
		}
	}

	option = {
		name = "distar.172.b"
		custom_tooltip = "distar.172.b.tooltip"
	}
}

country_event = { #New leaders get Brainslug Trait
	id = distar.173
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_country_flag = finished_brainslug_chain
		from = {
			NOR = {
				has_leader_flag = beholder
				has_leader_flag = gray_leader
				has_trait = leader_trait_governor_oracle
			}
			species = {
				NOR = {
					has_trait = trait_cybernetic
					has_trait = trait_mechanical
					has_trait = trait_machine_unit
					is_species_class = ROBOT
					is_species_class = AI
				}
			}
		}
	}

	immediate = {
		from = {
			if = {
				limit = {
					species = {
						NOR = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				random_list = {
					80 = {
						#Nothing
					}
					20 = {
						modifier = {
							factor = 0.5
							has_ethic = ethic_xenophobe
						}
						modifier = {
							factor = 2
							has_ethic = ethic_xenophile
						}
						add_trait = leader_trait_brainslug
					}
				}
				break = yes
			}
		}
	}
}

country_event = { #Pool leaders get Brainslug Trait
	id = distar.174
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_pool_leader = {
			if = {
				limit = {
					NOR = {
						has_trait = leader_trait_brainslug
						species = {
							has_trait = trait_cybernetic
							has_trait = trait_mechanical
							has_trait = trait_machine_unit
							is_species_class = ROBOT
						}
					}
				}
				random_list = {
					80 = {
						#Nothing
					}
					20 = {
						modifier = {
							factor = 0.5
							has_ethic = ethic_xenophobe
						}
						modifier = {
							factor = 2
							has_ethic = ethic_xenophile
						}
						add_trait = leader_trait_brainslug
					}
				}
			}
		}
	}
}


country_event = { #Cohabitants of Brainslugged pops generate initial Unrest
	id = distar.175
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				is_xenophobe = no
			}
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						AND = {
							exists = leader
							leader = { has_trait = leader_trait_brainslug }
						}
					}
				}
				if = {
					limit = { root = { is_hive_empire = no } }
					add_modifier = { modifier = brainslug_woes days = 7200 }
				}
				else = {
					add_modifier = { modifier = brainslug_hive days = 7200 }
				}
			}
		}
		# Ariphaos TODO: Balance patch should do something about fanatic xenophobes and rulers here.
		else = { #Xenophobes result in higher unrest
			every_owned_planet = {
				limit = {
					OR = {
						any_owned_pop = { has_trait = trait_brainslug }
						AND = {
							exists = leader
							leader = { has_trait = leader_trait_brainslug }
						}
					}
				}
				add_modifier = { modifier = brainslug_woes_phobe days = 7200 }
			}
		}
	}
}

ship_event = { #Thirsty Rocks
	id = distar.180
	title = "distar.180.name"
	desc = "distar.180.desc"
	picture = GFX_evt_warm_barren
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { has_deposit_for = shipclass_research_station }
				clear_deposits = yes
			}
		}
	}

	option = {
		name = INTERESTING
		from = {
			add_deposit = d_minerals_4
		}
	}
}

ship_event = { #Venus Flytrap Megaflora
	id = distar.185
	title = "distar.185.name"
	desc = "distar.185.desc"
	picture = GFX_evt_aggressive_flora
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	specimen = carnivorous_megaflora

	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

ship_event = {
	id = distar.190
	title = "distar.190.name"
	desc = {
		trigger = {
			owner = { is_regular_empire = yes }
		}
		text = "distar.190.desc"
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		text = "distar.190.desc.machi"
	}
	desc = {
		trigger = {
			owner = { is_hive_empire = yes }
		}
		text = "distar.190.desc.hive"
	}
	picture = GFX_evt_ocean
	show_sound = event_scanner
	location = from
	event_chain = living_planet_chain

	is_triggered_only = yes

	immediate = {
		leader = {
			save_global_event_target_as = living_planet_scientist
		}
		from = {
			save_global_event_target_as = living_planet_tar
		}
		if = {
			limit = {
				owner = { is_regular_empire = yes }
			}
			owner = {
				begin_event_chain = {
					event_chain = "living_planet_chain"
					target = root.owner
				}
			}
		}
	}

	option = {
		name = distar.190.a
		trigger = {
			owner = { is_regular_empire = yes }
		}
		if = {
			limit = {
				from = {
					exists = space_owner
					space_owner = { is_same_value = root.owner }
				}
			}
			event_target:living_planet_tar = {
				enable_special_project = {
					name = "STUDY_LIVING_SEA"
					location = from
					owner = root
				}
			}
		}
		else = {
			owner = {
				create_point_of_interest = {
					id = living_sea.1
					name = "living_sea_poi"
					desc = living_sea_poi_desc
					event_chain = living_planet_chain
					location = from
				}
			}
		}
		owner = {
			tooltip = {
				begin_event_chain = {
					event_chain = "living_planet_chain"
					target = root.owner
				}
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			hidden_effect = {
				set_country_flag = living_planet_started
			}
		}
	}

	option = {
		trigger = {
			owner = { is_regular_empire = yes }
		}
		name = NOTIME
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			hidden_effect = {
				end_event_chain = living_planet_chain
			}
		}
	}

	option = {
		trigger = {
			owner = { is_gestalt = yes }
		}
		name = CURIOUS
	}
}

country_event = { #On enacting Study The Sea Special Project
	id = distar.191
	title = "distar.191.name"
	desc = {
		trigger = {
			exists = event_target:living_planet_scientist
		}
		text = "distar.191.desc.alive"
	}
	desc = {
		trigger = {
			NOT = { exists = event_target:living_planet_scientist }
		}
		text = "distar.191.desc.crew"
	}
	picture = GFX_evt_ocean
	show_sound = event_scanner
	location = event_target:living_planet_tar
	is_triggered_only = yes
	event_chain = living_planet_chain

	trigger = {
		has_country_flag = living_planet_started
		has_event_chain = "living_planet_chain"
	}

	immediate = {
		if = {
			limit = {
				NOT = { exists = event_target:living_planet_tar }
			}
			random_planet_within_border = {
				limit = { has_modifier = living_sea }
				save_global_event_target_as = living_planet_tar
			}
		}
	}

	option = {
		name = "distar.191.a"
		event_target:living_planet_tar = {
			add_modifier = {
				modifier = pm_study_the_sea
				days = -1
			}
		}
		hidden_effect = {
			country_event = { id = distar.192 days = 180 random = 30 } #Scientist is alive
			country_event = { id = distar.193 days = 3600 } #Scientist is dead
		}
	}
}

country_event = { #Scientist is alive
	id = distar.192
	title = "distar.192.name"
	desc = {
		trigger = {
			event_target:living_planet_scientist = {
				OR = {
					gender = male
					gender = female
				}
			}
		}
		text = "distar.192.desc"
	}
	desc = {
		trigger = {
			event_target:living_planet_scientist = {
				NOR = {
					gender = male
					gender = female
				}
			}
		}
		text = "distar.192.desc.neuter"
	}
	picture = GFX_evt_ship_in_orbit
	show_sound = event_radio_chatter
	location = event_target:living_planet_tar
	is_triggered_only = yes
	event_chain = living_planet_chain

	trigger = {
		exists = event_target:living_planet_scientist
		exists = event_target:living_planet_tar
		event_target:living_planet_tar = {
			has_modifier = pm_study_the_sea
			has_modifier = living_sea
		}
	}

	immediate = {
		set_country_flag = strange_calling_fired
	}

	option = {
		name = "distar.192.a"
		custom_tooltip = "distar.192.a.tooltip"
		hidden_effect = {
			event_target:living_planet_scientist = {
				exile_leader_as = exiled_living_planet_scientist
			}
			country_event = { id = distar.194 days = 360 random = 60 }
		}
	}

	option = {
		name = "distar.192.b"
		custom_tooltip = "distar.192.b.tooltip"
		hidden_effect = {
			country_event = { id = distar.195 days = 90 random = 10 }
		}
	}

	option = {
		name = "distar.192.c"
		custom_tooltip = "distar.192.c.tooltip"
		hidden_effect = {
			event_target:living_planet_scientist = {
				kill_leader = { class = scientist show_notification = no }
			}
			remove_country_flag = strange_calling_fired
		}
		end_event_chain = "living_planet_chain"
		clear_global_event_target = living_planet_tar
		clear_global_event_target = living_planet_scientist
	}
}

country_event = { #Scientist dies
	id = distar.193
	title = "distar.193.name"
	desc = "distar.193.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_radio_chatter
	location = event_target:living_planet_tar
	is_triggered_only = yes
	event_chain = living_planet_chain

	trigger = {
		exists = event_target:living_planet_tar
		NOT = { has_country_flag = strange_calling_fired }
		NOT = { exists = event_target:living_planet_scientist }
		event_target:living_planet_tar = {
			has_modifier = pm_study_the_sea
			has_modifier = living_sea
		}
	}

	immediate = {
		set_country_flag = completed_living_sea
	}

	option = {
		name = INCREDIBLE
		if = {
			limit = { NOT = { has_technology = tech_psionic_theory } }
			give_technology = { tech = tech_psionic_theory }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_telepathy } }
			give_technology = { tech = tech_telepathy }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_precognition_interface } }
			give_technology = { tech = tech_precognition_interface }
		}
		else = {
			add_monthly_resource_mult = {
			resource = society_research
			value = @tier4researchreward
			min = @tier4researchmin
			max = @tier4researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		hidden_effect = {
			event_target:living_planet_tar = {
				remove_modifier = pm_study_the_sea
			}
		}
		end_event_chain = "living_planet_chain"
		clear_global_event_target = living_planet_tar
		clear_global_event_target = living_planet_scientist
	}
}

country_event = {
	id = distar.194
	title = "distar.194.name"
	desc = "distar.194.desc"
	picture = GFX_evt_ocean
	show_sound = event_mystic_reveal
	location = event_target:living_planet_tar
	is_triggered_only = yes
	event_chain = living_planet_chain

	trigger = {
		exists = event_target:living_planet_tar
		event_target:living_planet_tar = {
			has_modifier = pm_study_the_sea
			has_modifier = living_sea
		}
	}

	immediate = {
		set_country_flag = completed_living_sea
	}

	option = {
		name = FASCINATING
		if = {
			limit = { NOT = { has_technology = tech_psionic_theory } }
			give_technology = { tech = tech_psionic_theory }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_telepathy } }
			give_technology = { tech = tech_telepathy }
		}
		else_if = {
			limit = { NOT = { has_technology = tech_precognition_interface } }
			give_technology = { tech = tech_precognition_interface }
		}
		add_monthly_resource_mult = {
			resource = society_research
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
		add_monthly_resource_mult = {
			resource = physics_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		end_event_chain = "living_planet_chain"
		hidden_effect = {
			event_target:living_planet_tar = {
				remove_modifier = pm_study_the_sea
			}
		}
		clear_global_event_target = living_planet_tar
		clear_global_event_target = living_planet_scientist
	}
}

country_event = {
	id = distar.195
	title = "distar.195.name"
	desc = "distar.195.desc"
	location = event_target:living_planet_tar
	diplomatic = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:living_planet_tar
		exists = event_target:living_planet_scientist
		event_target:living_planet_tar = { has_modifier = living_sea }
	}

	picture_event_data = {
		portrait = event_target:living_planet_scientist
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.195.a"
		hidden_effect = {
			event_target:living_planet_scientist = {
				exile_leader_as = exiled_living_planet_scientist
			}
			country_event = { id = distar.196 days = 10 }
		}
	}
}

country_event = {
	id = distar.196
	title = "distar.196.name"
	desc = "distar.196.desc"
	picture = GFX_evt_atmospheric_entry
	show_sound = event_ship_explosion
	location = event_target:living_planet_tar
	is_triggered_only = yes
	event_chain = living_planet_chain

	trigger = {
		exists = event_target:living_planet_tar
		event_target:living_planet_tar = { has_modifier = living_sea }
	}

	option = {
		name = CURSES
		event_target:living_planet_scientist = {
			kill_leader = { class = scientist show_notification = yes }
		}
		hidden_effect = {
			remove_country_flag = strange_calling_fired
		}
	}
}

starbase_event = {
	id = distar.1999 #198 exists. It is below 199 in the file. :(
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		exists = solar_system
		solar_system = {
			has_star_flag = living_planet_system
		}
		#that narrows it down enough, the rest is covered in the trigger of distar.199
	}

	immediate = {
		fleet = {
			random_owned_ship = {
				limit = {
					is_ship_class = shipclass_starbase
				}
				ship_event = { id = distar.199 }
			}
		}
	}
}

ship_event = { #Special Project Gatekeeper (on_starbase_transfer, on_building_starbase_outpost)
	id = distar.199
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = event_target:living_planet_tar
		exists = solar_system
		solar_system = {
			has_star_flag = living_planet_system
		}
		owner = {
			NOT = { has_special_project = STUDY_LIVING_SEA }
			has_country_flag = living_planet_started
			has_event_chain = "living_planet_chain"
		}
	}

	immediate = {
		owner = {
			enable_special_project = {
				name = "STUDY_LIVING_SEA"
				location = event_target:living_planet_tar
				owner = root
			}
			remove_point_of_interest = living_sea.1
		}
		every_country = {
			limit = {
				has_special_project = STUDY_LIVING_SEA
				NOT = {
					is_same_value = root.owner
				}
			}
			abort_special_project = { type = STUDY_LIVING_SEA }
			create_point_of_interest = {
				id = living_sea.1
				name = "living_sea_poi"
				desc = living_sea_poi_desc
				event_chain = living_planet_chain
				location = event_target:living_planet_tar
			}
		}
	}
}


# living planet port from ecumenopolis
country_event = {
	id = distar.201
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		OR = {
			has_event_chain = "living_planet_chain"
			has_country_flag = completed_living_sea
		}
		any_planet_within_border = {
			has_planet_flag = living_planet
			OR = {
				has_modifier = "living_sea"
				has_modifier = "pm_study_the_sea"
			}
		}
	}

	immediate = {
		random_planet_within_border = {
			limit = { has_planet_flag = living_planet }
			planet_event = { id = distar.197 }
		}
	}
}

planet_event = { #If you terraform the planet to a non-seabearing class before completing chain
	id = distar.197
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_planet_flag = living_planet
		#from = {
		#	has_event_chain = "living_planet_chain"
		#	NOT = { has_country_flag = completed_living_sea }
		#}
		OR = {
			has_modifier = "living_sea"
			has_modifier = "pm_study_the_sea"
		}
		# should now remove modifiers even if terraformed after chain completion
		NOR = {
			is_planet_class = pc_gaia
			is_planet_class = pc_ocean
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
		}
	}

	immediate = {
		if = {
			limit = { has_modifier = "living_sea" }
			remove_modifier = "living_sea"
		}
		if = {
			limit = { has_modifier = "pm_study_the_sea" }
			remove_modifier = "pm_study_the_sea"
		}
		from = {
			if = {
				limit = { has_event_chain = "living_planet_chain" }
				end_event_chain = "living_planet_chain"
			}
			if = {
				limit = { has_country_flag = strange_calling_fired }
				remove_country_flag = strange_calling_fired
			}
			country_event = { id = distar.198 }
		}
	}
}

country_event = { #Separated from .197 in case you haven't colonized the planet (controller vs owner)
	id = distar.198
	title = "distar.198.name"
	desc = "distar.198.desc"
	picture = GFX_evt_ship_in_orbit
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	option = {
		name = CURSES
		tooltip = {
			end_event_chain = "living_planet_chain"
		}
	}
}

country_event = { #Tiyanki Matriarch patrols
	id = distar.210
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:elderly_tiyanki_country
		is_same_value = event_target:elderly_tiyanki_country
		from = {
			is_same_value = event_target:elderly_tiyanki_fleet
		}
	}

	immediate = {
		from.solar_system = {
			random_system_planet = {
				limit = {
					NOT = { is_same_value = root.from.orbit }
				}
				save_event_target_as = new_location
			}
		}
		from = {
			auto_move_to_planet = {
				target = event_target:new_location
				clear_auto_move_on_arrival = no
			}
		}
	}
}


fleet_event = { #Tiyanki Matriarch
	id = distar.211
	title = "distar.211.name"
	desc = {
		trigger = {
			owner = { has_country_flag = tiyanki_encountered }
		}
		text = "distar.211.desc"
	}
	desc = {
		trigger = {
			owner = { NOT = { has_country_flag = tiyanki_encountered } }
		}
		text = "distar.211.desc.first_enc"
	}
	picture = GFX_evt_ancient_tiyanki
	show_sound = event_space_whale
	location = event_target:elderly_tiyanki_system

	is_triggered_only = yes

	trigger = {
		from = { has_star_flag = elderly_tiyanki_system }
		owner = {
			is_country_type = default
			NOT = { has_country_flag = encountered_elderly_tiyanki }
		}
		exists = event_target:elderly_tiyanki_fleet
		exists = event_target:elderly_tiyanki_country
	}

	immediate = {
		random_system = {
			limit = { has_star_flag = elderly_tiyanki_system }
			save_event_target_as = elderly_tiyanki_system
		}
		owner = {
			set_country_flag = encountered_elderly_tiyanki
			capital_scope = { save_event_target_as = pc_home }
			establish_communications_no_message = event_target:elderly_tiyanki_country
			country_event = { id = story.8 days = 15 }
		}
	}

	option = {
		name = INCREDIBLE
		hidden_effect = {
			owner = {
				IF = {
					limit = {
						NOT = { has_country_flag = tiyanki_encountered }
						exists = event_target:tiyanki_country
					}
					establish_contact = {
						who = event_target:tiyanki_country
						location = root.solar_system
					}
					set_country_flag = tiyanki_encountered
				}
			}
		}
	}
}

country_event = { #Death of the Matriarch
	id = distar.212
	title = "distar.212.name"
	desc = "distar.212.desc"
	picture = GFX_evt_ancient_tiyanki
	show_sound = event_space_whale
	location = event_target:dead_matriarch

	is_triggered_only = yes

	trigger = {
		exists = event_target:elderly_tiyanki_fleet
		FromFromFrom.fleet = {
			is_same_value = event_target:elderly_tiyanki_fleet
		}
	}

	immediate = {
		set_country_flag = tiyanki_killed # Achievement flag
		create_ambient_object = {
			type = "elderly_tiyanki_dead_object"
			location = fromfromfrom
			effect = {
				save_event_target_as = dead_matriarch
			}
		}
		every_playable_country = {
			limit = {
				has_event_chain = curator_poi_chain
				fromfrom.solar_system = {
					is_point_of_interest = {
						id = curator_poi_tiyanki
						event_chain = curator_poi_chain
						owner = prev
					}
				}
			}
			remove_point_of_interest = curator_poi_tiyanki
			end_curator_chain = yes
		}
	}

	option = {
		name = "distar.212.a"
		trigger = { NOT = { has_valid_civic = civic_memorialist } }
		hidden_effect = {
			if = {
				limit = { is_country_type = default }
				country_event = { id = distar.213 }
				country_event = { id = galcom.110 days = 60 }
			}
		}
	}

	option = {
		name = UNDERSTOOD
		trigger = { has_valid_civic = civic_memorialist }
		hidden_effect = {
			if = {
				limit = { is_country_type = default }
				country_event = { id = distar.213 }
				country_event = { id = galcom.110 days = 60 }
			}
		}
	}

	option = {
		name = galactic_features.385.reanimated

		trigger = {
			is_reanimator = yes
		}

		event_target:dead_matriarch = {
			enable_special_project = {
				name = "REANIMATE_TIYANKI_MATRIARCH"
				location = this
				owner = root.owner
			}
		}

		hidden_effect = {
			country_event = { id = distar.213 }
			country_event = { id = galcom.110 days = 60 }
		}
	}

	option = {
		name = distar.212.b
		trigger = {
			can_harvest_dna = yes
		}
		set_country_flag = harvested_tiyanki_dna
		custom_tooltip = distar.212.b.tooltip
		hidden_effect = {
			if = {
				limit = { is_country_type = default }
				country_event = { id = distar.213 }
				country_event = { id = galcom.110 days = 60 }
			}
		}
	}
	after = {
		if = {
			limit = {
				is_robot_empire = no
				num_owned_planets > 0
			}
			generate_parade_city = yes
			start_situation = {
				type = leviathan_celebration_opportunity
				target = event_target:parade_city
				effect = {
					set_situation_flag = celebration_tiyanki_matriarch
					set_situation_flag = standard_unity_reward
				}
			}
		}
	}
}

country_event = {
	id = distar.213
	title = "distar.213.name"
	desc = "distar.213.desc"
	picture = GFX_evt_ancient_tiyanki
	show_sound = event_space_whale
	location = event_target:dead_matriarch

	is_triggered_only = yes

	option = {
		name = BATTLESTATIONS
		hidden_effect = {
			country_event = { id = distar.214 }
		}
	}
}

country_event = {
	id = distar.214
	title = "distar.214.name"
	desc = "distar.214.desc"
	picture = GFX_evt_fleet_good
	show_sound = event_mystic_reveal
	location = event_target:ahab_fleet

	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Reth_Unddol"
			type = nice_faction
			auto_delete = yes
			flag = {
				icon = {
					category = "special"
					file = "unknown.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"red"
					"red"
					"null"
					"null"
				}
			}
			effect = {
				save_event_target_as = reth_country
			}
		}
		event_target:reth_country = {
			set_faction_hostility = {
				target = root.owner
				set_hostile = no
				set_neutral = no
				set_friendly = yes
			}
			if = {
				limit = {
					root = { species_portrait = cpl_02_02}
				}
				create_species = {
					name = "NAME_Unknown"
					class = HUM
					portrait = cpl_02_01
					namelist = "PRT1"
					traits = random
					effect = {
						save_event_target_as = captain_species
					}
				}
			}
			else_if = {
				limit = {
					root = { species_portrait = cpl_02_01 }
				}
				create_species = {
					name = "NAME_Unknown"
					class = MAM
					portrait = cpl_02_02
					namelist = "PRT1"
					traits = random
					effect = {
						save_event_target_as = captain_species
					}
				}
			}
			else = {
				random_list = {
					1 = {
						create_species = {
							name = "NAME_Unknown"
							class = HUM
							portrait = cpl_02_01
							namelist = "PRT1"
							traits = random
							effect = {
								save_event_target_as = captain_species
							}
						}
					}
					1 = {
						create_species = {
							name = "NAME_Unknown"
							class = MAM
							portrait = cpl_02_02
							namelist = "PRT1"
							traits = random
							effect = {
								save_event_target_as = captain_species
							}
						}
					}
				}
			}
			create_leader = {
				class = commander
				species = event_target:captain_species
				name = NAME_Reth_Unddol
				skill = 5
				gender = male
				background_ethic = ethic_materialist
				skip_background_generation = yes
				custom_description = reth_leader_desc
				custom_catch_phrase = reth_leader_catch_phrase
				hide_age = no

				randomize_traits = no
				effect = {
					set_skill = 5
					set_leader_flag = renowned_leader
					set_leader_flag = is_in_recruit_window
					save_event_target_as = captain_reth
					add_trait = leader_trait_admiral_hells_heart
					add_trait = subclass_commander_admiral
					add_trait = leader_trait_corsair_2
					add_trait = leader_trait_shipbreaker_2
					set_age = 58 #Ahab's age!
				}
			}
			create_fleet = {
				name = "NAME_AH4B"
				effect = {
					set_owner = prev
					create_ship = {
						name = "NAME_AH4B"
						design = "NAME_AH4B"
						prefix = no
						upgradable = yes
					}
					set_location = {
						target = event_target:dead_matriarch
						distance = 2
						angle = random
					}
					set_fleet_stance = passive
					add_modifier = { modifier = "ahab_power" days = -1 }
					assign_leader = event_target:captain_reth
					save_event_target_as = ahab_fleet
				}
				settings = {
					can_change_leader = yes
					spawn_debris = no
				}
			}
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			country_event = { id = distar.215 }
		}
	}
}

country_event = {
	id = distar.215
	title = NAME_Reth_Unddol
	desc = "distar.215.desc"
	location = event_target:ahab_fleet
	show_sound = event_custodian_greeting
	picture = GFX_leader_recruitment_bg_renowned
	event_window_type = leader_recruit
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:captain_reth
		room = ethic_spaceship_room
	}

	option = {
		allow = {
			is_homicidal = no
		}
		tag = hire_leader
		name = {
			trigger = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
			text = distar.215.a
		}
		name = {
			trigger = {
				has_ethic = ethic_gestalt_consciousness
			}
			text = distar.215.a.gesta
		}
		event_target:ahab_fleet = {
			set_owner = root
			hidden_effect = { set_leader = event_target:captain_reth }
		}
		hidden_effect = {
			hire_event_leader_message = {
				LEADER = captain_reth
			}
		}
	}

	option = {
		allow = {
			values_others = no
		}
		name = distar.215.dismiss
		if = {
			limit = {
				is_homicidal = no
			}
			custom_tooltip = distar.215.c
		}
		else_if = {
			limit = {
				has_civic = civic_machine_terminator
			}
			custom_tooltip = distar.215.a.exter
		}
		else_if = {
			limit = {
				has_civic = civic_hive_devouring_swarm
			}
			custom_tooltip = distar.215.a.swarm
		}
		else = {
			custom_tooltip = distar.215.a.fp
		}
		tag = dismiss_leader
		if = {
			limit = {
				is_homicidal = no
			}
			event_target:ahab_fleet = {
				set_owner = root
			}
		}
		hidden_effect = {
			if = {
				limit = {
					is_homicidal = no
				}
				country_event = { id = distar.217 }
			}
			else = {
				country_event = { id = distar.216 }
			}
		}
	}
	option = {
		name = distar.215.d
		response_text = distar.215.d.response
		is_dialog_only = yes
	}
}

country_event = {
	id = distar.216
	title = "distar.215.name"
	desc = "distar.216.desc"
	location = event_target:ahab_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:captain_reth
		room = ethic_spaceship_room
	}

	option = {
		name = TASTY
		exclusive_trigger = {
			has_civic = civic_hive_devouring_swarm
		}
		event_target:ahab_fleet = {
			set_owner = root
			kill_leader = {
				class = commander show_notification = no
			}
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}

	option = {
		name = "distar.216.a.exter"
		exclusive_trigger = {
			has_civic = civic_machine_terminator
		}
		event_target:ahab_fleet = {
			set_owner = root
			kill_leader = {
				class = commander show_notification = no
			}
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}

	option = {
		name = SCUM
		exclusive_trigger = {
			has_civic = civic_fanatic_purifiers
		}
		event_target:ahab_fleet = {
			set_owner = root
			kill_leader = {
				class = commander show_notification = no
			}
		}
		add_monthly_resource_mult = {
			resource = unity
			value = @tier3researchreward
			min = @tier3researchmin
			max = @tier3researchmax
		}
	}
}

country_event = {
	id = distar.217
	title = "distar.215.name"
	desc = "distar.217.desc"
	location = event_target:ahab_fleet

	diplomatic = yes

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:captain_reth
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.217.a"
		event_target:ahab_fleet = {
			set_owner = root
			hidden_effect = {
				kill_leader = { class = commander show_notification = no }
			}
		}
	}
}

# Reanimated Matriarch
country_event = {
	id = distar.218
	title = "distar.218.name"
	desc = {
		trigger = {
			is_hive_empire = no
			is_machine_empire = no
		}
		text = "distar.218.desc.regular"
	}
	desc = {
		trigger = {
			is_hive_empire = yes
			is_machine_empire = no
		}
		text = "distar.218.desc.hive"
	}
	desc = {
		trigger = {
			is_machine_empire = yes
		}
		text = "distar.218.desc.machine"
	}
	location = event_target:dead_matriarch

	is_triggered_only = yes

	picture = {
		trigger = {
			is_machine_empire = no
		}
		picture = GFX_evt_necromancy
	}

	picture = {
		trigger = {
			is_machine_empire = yes
		}
		picture = GFX_evt_mechromancy
	}

	show_sound = event_space_whale

	option = {
		name = "it_hungers"

		create_fleet = {
			name = "NAME_Elderly_Tiyanki"
			effect = {
				set_owner = root
				create_ship = {
					name = "NAME_Reanimated_Elderly_Tiyanki"
					design = "NAME_Reanimated_Progenitor"
					prefix = no
					upgradable = no
				}
				set_location = {
					target = event_target:dead_matriarch
					distance = 0
					angle = random
				}
				set_fleet_stance = passive
			}
			settings = {
				can_upgrade = no
				can_change_composition = no
				can_change_leader = no
				uses_naval_capacity = no
				spawn_debris = no
			}
		}
	}

	after = {
		if = {
			limit = { exists = event_target:dead_matriarch }
			event_target:dead_matriarch = {
				destroy_ambient_object = this
			}
		}
	}
}

#The Zone
ship_event = {
	id = distar.220
	title = "distar.220.name"
	desc = {
		trigger = {
			owner = {
				is_machine_empire = no
			}
		}
		text = "distar.220.desc"
	}
	desc = {
		trigger = {
			owner = {
				is_machine_empire = yes
			}
		}
		text = "distar.220.desc.machi"
	}
	picture = GFX_evt_alien_ruins
	show_sound = event_ghost_town
	location = from

	is_triggered_only = yes

	specimen = zone_a_sedative

	immediate = {
		from = { add_deposit = d_the_zone }
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = FASCINATING
		custom_tooltip = "distar.220.a.tooltip"
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = unity
				value = @tier1unityreward
				min = @tier1unitymin
				max = @tier1unitymax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
}

#Junk Ball Asteroid
ship_event = {
	id = distar.225
	title = "distar.225.name"
	desc = "distar.225.desc"
	picture = GFX_evt_asteroid_field
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = "distar.225.a"
		from = {
			add_alloys = yes
		}
		if = {
			limit = { has_ancrel = yes }
			custom_tooltip = minor_artifacts_found
			owner = { add_resource = { minor_artifacts = 10 } }
		}
		hidden_effect = {
			owner = { pop_lcluster_event = yes }
			ship_event = { id = distar.305 days = 1 }
		}
	}
}

fleet_event = { #Junkheap Ratlings
	id = distar.230
	title = "distar.230.name"
	desc = "distar.230.desc"
	picture = GFX_evt_junkheap
	show_sound = event_scanner
	location = root

	is_triggered_only = yes

	trigger = {
		from = { has_star_flag = ratling_system }
		owner = {
			is_country_type = default
			NOT = { has_country_flag = discovered_ratlings }
		}
		NOR = {
			exists = event_target:ratling_pre_space_country
			exists = event_target:ratling_country
		}
	}

	immediate = {
		owner = {
			set_country_flag = discovered_ratlings #Every player that enters the system gets this flag
			country_event = { id = story.5 days = 30 }
			random_country = {
				limit = { is_country_type = global_event }
				country_event = { id = distar.232 days = 9000 random = 3600 }
			}
		}
		from = {
			random_system_planet = {
				limit = { has_planet_flag = ratling_planet }
				save_event_target_as = ratling_planet_tar #Used for loc for this event only
			}
		}
	}

	option = {
		name = CURIOUS
	}

	option = {
		name = SCUM
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
				}
			}
		}
	}

	option = {
		name = "distar.230.exter"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_terminator
			}
		}
	}

	after = {
		if = {
			limit = {
				root.solar_system = {
					NOT = {
						has_star_flag = ratling_home_system
					}
				}
			}
			event_target:ratling_capital.solar_system = {
				root.owner = { set_visited = prev }
			}
		}
		event_target:ratling_capital = {
			add_anomaly = {
				category = DISTAR_RAT_CAT
				target = root.owner
			}
		}
	}
}

ship_event = { #Found the Capital
	id = distar.231
	title = "distar.231.name"
	desc = "distar.231.desc"
	picture = GFX_evt_junkheap
	show_sound = event_ghost_town
	location = from

	is_triggered_only = yes
	# Risa fix
	trigger = {
		exists = event_target:ratling_capital
		from = { is_same_value = event_target:ratling_capital }
		owner = { NOT = { has_country_flag = ratling_capital_surveyed } }
	}

	immediate = {
		owner = { set_country_flag = ratling_capital_surveyed }
	}
	option = {
		name = UNFORTUNATE
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}

	option = {
		name = "distar.231.phobe"
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					has_civic = civic_machine_terminator
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
			hidden_effect = { pop_lcluster_event = yes }
		}
	}
}

country_event = { #Spawn Ratlings #Root = Global Event Country
	id = distar.232
	hide_window = yes

	is_triggered_only = yes

	fire_only_once = yes

	trigger = {
		NOT = {
			has_country_flag = spawned_pre_space_ratlings
		}
		any_system = {
			has_star_flag = ratling_system
			any_system_planet = {
				has_planet_flag = ratling_planet
				NOR = {
					is_planet_class = "pc_broken"
					is_planet_class = "pc_shattered"
				}
			}
		}
	}

	immediate = {
		create_country = {
			name = "NAME_Ketlings"
			adjective = "NAME_Ketling"
			ethos = {
				ethic = ethic_materialist
				ethic = ethic_egalitarian
				ethic = ethic_pacifist
			}
			authority = auth_oligarchic
			civics = {
				civic = civic_functional_architecture
				civic = civic_mining_guilds
			}
			origin = origin_default
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_12.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"light_green"
					"yellow"
					"null"
					"null"
				}
			}
			species = event_target:ratling_species
			type = ratlings
			ignore_initial_colony_error = yes
		}
		last_created_country = {
			save_global_event_target_as = ratling_pre_space_country
		}
		every_system = {
			limit = {
				has_star_flag = ratling_system
				NOT = { exists = space_owner }
			}
			every_system_planet = {
				limit = {
					has_planet_flag = ratling_planet
					is_colony = no
					is_under_colonization = no
					NOR = {
						is_planet_class = "pc_broken"
						is_planet_class = "pc_shattered"
					}
				}
				set_owner = event_target:ratling_pre_space_country
				add_building = building_junkheap
				while = {
					count = 10
					create_pop = {
						species = event_target:ratling_species
					}
				}
				while = {
					count = 4
					create_army = {
						owner = event_target:ratling_pre_space_country
						species = event_target:ratling_species
						type = "ketling_army"
					}
				}
				set_planet_entity = {
					picture = pc_nuked
				}
				set_planet_flag = changed_planetview_image
				switch = { #Planets get renamed in the create_colony effect, we want to maintain names
					trigger = is_same_value
					event_target:ratling_capital = {
						set_name = "NAME_Ruinous_Core"
					}
					event_target:ratling_planet_2_tar = {
						set_name = "NAME_Lost_Encampment"
					}
					event_target:ratling_planet_3_tar = {
						set_name = "NAME_Silent_Colony"
					}
					event_target:ratling_planet_4_tar = {
						set_name = "NAME_Decayed_Hub"
					}
					event_target:ratling_planet_5_tar = {
						set_name = "NAME_Crumbling_Borough"
					}
					event_target:ratling_planet_6_tar = {
						set_name = "NAME_Fallen_Outpost"
					}
				}
			}
		}
		set_country_flag = spawned_pre_space_ratlings

		every_country = { #Fire notif event
			limit = { has_country_flag = discovered_ratlings }
			country_event = { id = distar.233 days = 1 }
		}
		every_playable_country = {
			establish_communications_no_message = event_target:ratling_pre_space_country
			establish_contact = { who = event_target:ratling_pre_space_country location = this.capital_scope }
		}
	}
}


country_event = { #Alert that the pre-space Ketlings have emerged
	id = distar.233
	title = "distar.233.name"
	desc = "distar.233.desc"
	picture = GFX_evt_junkheap
	show_sound = event_radio_chatter
	location = event_target:notif_planet

	is_triggered_only = yes

	trigger = {
		any_system = {
			has_star_flag = ratling_system
			root = {
				intel_level = {
					level > none
					system = prev
				}
			}
			any_system_planet = {
				exists = owner
				owner = {
					is_same_value = event_target:ratling_pre_space_country
				}
			}
		}
	}

	immediate = {
		random_country = {
			limit = { is_country_type = global_event }
			country_event = { id = distar.325 days = 9000 random = 3600 }
		}
		IF = {
			LIMIT = {
				root = {
					intel_level = {
						level > none
						system = event_target:ratling_capital.solar_system
					}
				}
			}
			event_target:ratling_capital = {
				save_event_target_as = notif_planet
			}
		}
		ELSE = {
			random_system = {
				limit = {
					has_star_flag = ratling_system
					root = {
						intel_level = {
							level > none
							system = prev
						}
					}
					any_system_planet = {
						has_planet_flag = ratling_planet
						any_owned_pop = {
							is_same_species = event_target:ratling_species
						}
					}
				}
				random_system_planet = {
					limit = {
						has_planet_flag = ratling_planet
						any_owned_pop = {
							is_same_species = event_target:ratling_species
						}
					}
					save_event_target_as = notif_planet
				}
			}
		}
		IF = {
			LIMIT = {
				exists = event_target:ratling_planet_2_tar
				event_target:ratling_planet_2_tar = {
					NOT = { is_same_value = event_target:ratling_capital }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
			event_target:ratling_planet_2_tar = {
				save_global_event_target_as = ratling_planet_2
			}
		}
		IF = {
			LIMIT = {
				exists = event_target:ratling_planet_3_tar
				event_target:ratling_planet_3_tar = {
					NOT = { is_same_value = event_target:ratling_capital }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
			event_target:ratling_planet_3_tar = {
				save_global_event_target_as = ratling_planet_3
			}
		}
		IF = {
			LIMIT = {
				exists = event_target:ratling_planet_4_tar
				event_target:ratling_planet_4_tar = {
					NOT = { is_same_value = event_target:ratling_capital }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
			event_target:ratling_planet_4_tar = {
				save_global_event_target_as = ratling_planet_4
			}
		}
		IF = {
			LIMIT = {
				exists = event_target:ratling_planet_5_tar
				event_target:ratling_planet_5_tar = {
					NOT = { is_same_value = event_target:ratling_capital }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
			event_target:ratling_planet_5_tar = {
				save_global_event_target_as = ratling_planet_5
			}
		}
		IF = {
			LIMIT = {
				exists = event_target:ratling_planet_6_tar
				event_target:ratling_planet_6_tar = {
					NOT = { is_same_value = event_target:ratling_capital }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
			event_target:ratling_planet_6_tar = {
				save_global_event_target_as = ratling_planet_6
			}
		}
	}

	option = {
		name = REMARKABLE
		begin_event_chain = {
			event_chain = ketling_study_chain
			target = root
		}
		hidden_effect = {
			event_target:ratling_capital = {
				enable_special_project = {
					name = "KETLING_PROJECT_1"
					location = this
					owner = root
				}
			}
			IF = {
				limit = { exists = event_target:ratling_planet_2 }
				event_target:ratling_planet_2 = {
					enable_special_project = {
						name = "KETLING_PROJECT_2"
						location = this
						owner = root
					}
				}
			}
			IF = {
				limit = { exists = event_target:ratling_planet_3 }
				event_target:ratling_planet_3 = {
					enable_special_project = {
						name = "KETLING_PROJECT_3"
						location = this
						owner = root
					}
				}
			}
			IF = {
				limit = { exists = event_target:ratling_planet_4 }
				event_target:ratling_planet_4 = {
					enable_special_project = {
						name = "KETLING_PROJECT_4"
						location = this
						owner = root
					}
				}
			}
			IF = {
				limit = { exists = event_target:ratling_planet_5 }
				event_target:ratling_planet_5 = {
					enable_special_project = {
						name = "KETLING_PROJECT_5"
						location = this
						owner = root
					}
				}
			}
			IF = {
				limit = { exists = event_target:ratling_planet_6 }
				event_target:ratling_planet_6 = {
					enable_special_project = {
						name = "KETLING_PROJECT_6"
						location = this
						owner = root
					}
				}
			}
		}
	}

	option = {
		name = "distar.233.phobe"
		exclusive_trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_civic = civic_machine_terminator
			}
		}
		event_target:ratling_capital = {
			begin_event_chain = {
				event_chain = "ketling_study_chain"
				target = root
			}
			hidden_effect = {
				enable_special_project = {
					name = "KETLING_PROJECT_1"
					location = this
					owner = root
				}

				IF = {
					limit = { exists = event_target:ratling_planet_2 }
					event_target:ratling_planet_2 = {
						enable_special_project = {
							name = "KETLING_PROJECT_2"
							location = this
							owner = root
						}
					}
				}
				IF = {
					limit = { exists = event_target:ratling_planet_3 }
					event_target:ratling_planet_3 = {
						enable_special_project = {
							name = "KETLING_PROJECT_3"
							location = this
							owner = root
						}
					}
				}
				IF = {
					limit = { exists = event_target:ratling_planet_4 }
					event_target:ratling_planet_4 = {
						enable_special_project = {
							name = "KETLING_PROJECT_4"
							location = this
							owner = root
						}
					}
				}
				IF = {
					limit = { exists = event_target:ratling_planet_5 }
					event_target:ratling_planet_5 = {
						enable_special_project = {
							name = "KETLING_PROJECT_5"
							location = this
							owner = root
						}
					}
				}
				IF = {
					limit = { exists = event_target:ratling_planet_6 }
					event_target:ratling_planet_6 = {
						enable_special_project = {
							name = "KETLING_PROJECT_6"
							location = this
							owner = root
						}
					}
				}
			}
		}
	}
}

ship_event = { #Origin of the Ketlings Special Project success
	id = distar.234
	title = "distar.234.name"
	desc = {
		text = "distar.234.desc"
	}
	desc = {
		exclusive_trigger = {
			exists = event_target:ratling_country
		}
		text = "distar.234.desc.spacefaring"
	}
	picture = GFX_evt_junkheap
	show_sound = event_ghost_town
	location = fromfrom

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = researched_ketlings
		}
	}

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			end_event_chain = "ketling_study_chain"
		}
	}

	option = {
		name = "distar.234.phobe"
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					has_civic = civic_machine_terminator
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
			end_event_chain = "ketling_study_chain"
		}
	}

	after = {
		hidden_effect = {
			IF = {
				limit = {
					exists = event_target:ratling_country
					owner = {
						NOT = { has_communications = event_target:ratling_country }
					}
				}
				root.owner = {
					establish_communications = event_target:ratling_country
					establish_contact = {
						who = event_target:ratling_country
						location = from.solar_system
					}
				}
			}
		}
	}
}

country_event = { #Switch owner on ground invasion successful to prevent endless occupation
	id = distar.235
	title = "distar.235.name"
	desc = {
		trigger = {
			any_system = {
				has_star_flag = ratling_system
				any_system_planet = {
					has_planet_flag = ratling_planet
					NOT = { is_same_value = fromfrom }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
		}
		text = "distar.235.desc"
	}
	desc = {
		trigger = {
			NOT = {
				any_system = {
					has_star_flag = ratling_system
					any_system_planet = {
						has_planet_flag = ratling_planet
						NOT = { is_same_value = fromfrom }
						any_owned_pop = { is_same_species = event_target:ratling_species }
					}
				}
			}
		}
		text = "distar.235.desc.none_left"
	}
	desc = {
		trigger = {
			has_civic = civic_machine_assimilator
			any_system = {
				has_star_flag = ratling_system
				any_system_planet = {
					has_planet_flag = ratling_planet
					NOT = { is_same_value = fromfrom }
					any_owned_pop = { is_same_species = event_target:ratling_species }
				}
			}
		}
		text = "distar.235.desc.assim"
	}
	desc = {
		trigger = {
			has_civic = civic_machine_assimilator
			NOT = {
				any_system = {
					has_star_flag = ratling_system
					any_system_planet = {
						has_planet_flag = ratling_planet
						NOT = { is_same_value = fromfrom }
						any_owned_pop = { is_same_species = event_target:ratling_species }
					}
				}
			}
		}
		text = "distar.235.desc.none_left.assim"
	}
	picture = GFX_evt_city_ruins
	show_sound = event_ground_battle
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		from = { is_country_type = ratlings }
		fromfrom = { has_planet_flag = ratling_planet }
	}

	immediate = {
		set_country_flag = subdued_ratling_planet
		fromfrom = {
			switch = {
				trigger = is_same_value
				event_target:ratling_planet_2 = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_2 }
							abort_special_project =  { type = KETLING_PROJECT_2 }
						}
					}
				}
				event_target:ratling_planet_3 = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_3 }
							abort_special_project =  { type = KETLING_PROJECT_3 }
						}
					}
				}
				event_target:ratling_planet_4 = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_4 }
							abort_special_project =  { type = KETLING_PROJECT_4 }
						}
					}
				}
				event_target:ratling_planet_5 = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_5 }
							abort_special_project =  { type = KETLING_PROJECT_5 }
						}
					}
				}
				event_target:ratling_planet_6 = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_6 }
							abort_special_project =  { type = KETLING_PROJECT_6 }
						}
					}
				}
				default = {
					root = {
						if = {
							limit = { has_special_project = KETLING_PROJECT_1 }
							abort_special_project =  { type = KETLING_PROJECT_1 }
						}
					}
				}
			}
			set_owner = root
			add_modifier = {
				modifier = planet_culture_shock
				years = 10
			}
		}
	}

	option = {
		name = EXCELLENT
		exclusive_trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_civic = civic_machine_terminator
				has_civic = civic_machine_assimilator
			}
		}
	}

	option = {
		name = UNFORTUNATE
		exclusive_trigger = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
	}

	option = {
		name = OK
	}
}

country_event = { #Bounce to make sure we do not spawn Ratlings during ongoing planetary invasion etc, otherwise things break #Root = Global Event Country
	id = distar.325
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				exists = event_target:ratling_pre_space_country
				any_system = {
					has_star_flag = ratling_system
					NOT = { #At least one Ratling system does not have ongoing starbase construction
						any_fleet_in_system = {
							is_ship_size = constructor
							is_constructing = starbase
						}
					}
					any_system_planet = {
						has_planet_flag = ratling_planet
						exists = owner
						owner = {
							is_same_value = event_target:ratling_pre_space_country
						}
						NOR = { #At least one planet in such a system is not under assault
							has_orbital_bombardment = yes
							has_ground_combat = yes
						}
					}
				}
			}
			country_event = { id = distar.236 }
		}
		else_if = {
			limit = {
				exists = event_target:ratling_pre_space_country
				any_system = {
					has_star_flag = ratling_system
					any_system_planet = {
						has_planet_flag = ratling_planet
						exists = owner
						owner = {
							is_same_value = event_target:ratling_pre_space_country
						}
					}
				}
			}
			country_event = { id = distar.325 days = 60 } #Try to check again later as long as we have a valid Ratling planet
		}
	}
}

country_event = { #Create Full Ratling Empire #Root = Global Event Country
	id = distar.236
	hide_window = yes

	is_triggered_only = yes

	fire_only_once = yes

	trigger = {
		NOT = {
			has_country_flag = spawned_ratling_country
		}
		exists = event_target:ratling_pre_space_country
		any_system = {
			has_star_flag = ratling_system
			NOT = { #At least one Ratling system does not have ongoing starbase construction
				any_fleet_in_system = {
					is_ship_size = constructor
					is_constructing = starbase
				}
			}
			any_system_planet = {
				has_planet_flag = ratling_planet
				exists = owner
				owner = {
					is_same_value = event_target:ratling_pre_space_country
				}
				NOR = {
					has_orbital_bombardment = yes
					has_ground_combat = yes
					is_planet_class = "pc_broken"
				}
			}
		}
	}

	immediate = {
		every_country = {
			limit = { has_country_flag = discovered_ratlings }
			country_event = { id = distar.237 days = 1 }
		}
		#Create the proper country
		create_country = {
			name = "NAME_Ketling_Multitude"
			ethos = {
				ethic = ethic_materialist
				ethic = ethic_egalitarian
				ethic = ethic_pacifist
			}
			authority = auth_oligarchic
			civics = {
				civic = civic_functional_architecture
				civic = civic_mining_guilds
			}
			origin = origin_star_pack
			flag = {
				icon = {
					category = "zoological"
					file = "flag_zoological_12.dds"
				}
				background = {
					category = "backgrounds"
					file = "00_solid.dds"
				}
				colors = {
					"light_green"
					"yellow"
					"null"
					"null"
				}
			}
			species = event_target:ratling_species
			ignore_initial_colony_error = yes
			type = default

			effect = {
				set_graphical_culture = mammalian_01
				save_global_event_target_as = ratling_country
				set_country_flag = ratling_country
				country_event = {
					id = ariphaos_patch.9998
					days = 1
				}
				country_event = {
					id = distar.23600
					days = 1
				}
				country_event = {
					id = distar.20330
					days = 1
				}
			}
		}

		##Prepare the planets
		every_system = {
			limit = {
				has_star_flag = ratling_system
				NOT = { exists = owner }
			}
			every_system_planet = {
				limit = {
					has_planet_flag = ratling_planet
					exists = owner
					owner = {
						is_same_value = event_target:ratling_pre_space_country
					}
					NOR = {
						has_orbital_bombardment = yes
						has_ground_combat = yes
						is_planet_class = "pc_broken"
					}
				}
				set_owner = event_target:ratling_country
				remove_building = building_junkheap
				clear_blockers = yes
				remove_all_armies = yes
				while = {
					count = 25
					create_pop = {
						species = event_target:ratling_species
					}
				}
				while = {
					count = 4
					add_district_and_planet_size_if_needed_effect = {
						district = district_city
					}
				}
				while = {
					count = 2
					add_district_and_planet_size_if_needed_effect = {
						district = district_industrial
					}
				}
				while = {
					count = 3
					add_district_and_planet_size_if_needed_effect = {
						district = district_farming
					}
				}
				while = {
					count = 3
					add_district_and_planet_size_if_needed_effect = {
						district = district_mining
					}
				}
				while = {
					count = 3
					add_district_and_planet_size_if_needed_effect = {
						district = district_generator
					}
				}
				add_building = building_capital
				add_building = building_research_lab_1
				add_building = building_foundry_1
				add_building = building_commercial_zone
				add_building = building_food_processing_facility
				add_building = building_energy_grid
				add_building = building_mineral_purification_plant
				add_building = building_bureaucratic_1
			}

			##Build Starbases
			create_starbase = {
				size = starbase_starhold
				owner = event_target:ratling_country
				module = shipyard
				building = crew_quarters
				effect = {
					set_starbase_module = {
						slot = 1
						module = anchorage
					}
					set_starbase_module = {
						slot = 2
						module = anchorage
					}
					set_starbase_module = {
						slot = 3
						module = trading_hub
					}
				}
			}
		}

		##Destroy old country
		event_target:ratling_pre_space_country = {
			every_owned_pop = { #In case any pops are left behind
				kill_pop = yes
			}
			destroy_country = yes
		}

		#So we don't get "orphaned" pops with no job categories in case of non-Ketling system owners
		every_system = {
			limit = {
				has_star_flag = ratling_system
				OR = {
					NOT = { exists = owner }
					AND = {
						exists = owner
						NOT = { is_owned_by = event_target:ratling_country }
					}
				}
			}
			every_system_planet = {
				limit = {
					has_planet_flag = ratling_planet
					any_owned_pop = {
						is_same_species = event_target:ratling_species
						NOT = { exists = owner }
					}
				}
				every_owned_pop = {
					limit = {
						is_same_species = event_target:ratling_species
						NOT = { exists = owner }
					}
					kill_pop = yes
				}
			}
		}

		#Create a Capital
		IF = { #If the old capital belongs to Ratlings, use it
			limit = {
				exists = event_target:ratling_capital
				event_target:ratling_capital = {
					exists = owner
					owner = {
						is_same_value = event_target:ratling_country
					}
				}
			}
			event_target:ratling_capital = {
				set_capital = yes
			}
		}
		ELSE = { #Otherwise, make a new Capital
			random_system = {
				limit = { has_star_flag = ratling_system }
				random_system_planet = {
					limit = {
						has_planet_flag = ratling_planet
						exists = owner
						owner = {
							is_same_value = event_target:ratling_country
						}
						planet_size > 12
						NOT = { is_planet_class = "pc_broken" }
					}
					save_global_event_target_as = ratling_capital
					set_capital = yes
				}
			}
		}

		event_target:ratling_country = {

			##Add resources
			add_resource = {
				minerals = 7000
				energy = 7000
				food = 3000
				consumer_goods = 3000
				alloys = 2000
				influence = 1000
				unity = 27000
			}

			event_target:ratling_country = {
				##Create Mining Stations
				# Handle with .23600
				#every_planet_within_border = {
				#	limit = {
				#		has_deposit_for = shipclass_mining_station
				#	}
				#	create_mining_station = { owner = event_target:ratling_country }
				#}
				##Create fleets
				create_fleet = {
					effect = {
						set_owner = event_target:ratling_country
						while = {
							count = 5
							create_ship = {
								name = random
								random_existing_design = corvette
								graphical_culture = "reptilian_01"
							}
						}
						while = {
							limit = { owner = { has_technology = tech_destroyers } }
							count = 4
							create_ship = {
								name = random
								random_existing_design = destroyer
								graphical_culture = "reptilian_01"
							}
						}
						while = {
							count = 2
							limit = { owner = { has_technology = tech_cruisers } }
							create_ship = {
								name = random
								random_existing_design = cruiser
								graphical_culture = "reptilian_01"
							}
						}
						set_location = {
							target = event_target:ratling_capital
							distance = 10
							angle = random
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = event_target:ratling_country
						create_ship = {
							name = random
							random_existing_design = constructor
							graphical_culture = "reptilian_01"
						}
						set_location = {
							target = event_target:ratling_capital
							distance = 10
							angle = random
						}
					}
				}
				create_fleet = {
					effect = {
						set_owner = event_target:ratling_country
						create_ship = {
							name = random
							random_existing_design = science
							graphical_culture = "reptilian_01"
						}
						set_location = {
							target = event_target:ratling_capital
							distance = 10
							angle = random
						}
					}
				}
			}

			##Add leaders
			while = {
				count = 4
				create_leader = {
					class = scientist
					species = event_target:ratling_species
					name = random
					skill = 3
				}
			}
			while = {
				count = 1
				create_leader = {
					class = commander
					species = event_target:ratling_species
					name = random
					skill = 3
				}
			}
			create_leader = {
				class = official
				species = event_target:ratling_species
				name = random
				skill = 3
			}
		}

		set_country_flag = spawned_ratling_country
	}
}

country_event = { #Alert that the Ketling default empire has been created
	id = distar.237
	title = "distar.237.name"
	desc = "distar.237.desc"
	picture = GFX_evt_news_room
	show_sound = event_cityscape
	location = event_target:sensor_ratling_system

	is_triggered_only = yes

	trigger = {
		any_system = {
			exists = owner
			owner = {
				is_same_value =	event_target:ratling_country
			}
			root = {
				intel_level = {
					level > none
					system = prev
				}
			}
		}
	}

	immediate = {
		#Get a target system we have sensors into
		IF = {
			limit = { #Done this way bc intel_level isn't accepting a chained dotscope target...
				event_target:ratling_country.capital_scope.solar_system = {
					root = {
						intel_level = {
							level > none
							system = prev
						}
					}
				}
			}
			event_target:ratling_country.capital_scope.solar_system = {
				save_event_target_as = sensor_ratling_system
			}
		}
		ELSE_IF = {
			limit = {
				any_system = {
					exists = owner
					owner = {
						is_same_value =	event_target:ratling_country
					}
					root = {
						intel_level = {
							level > none
							system = prev
						}
					}
				}
			}
			random_system = {
				limit = {
					exists = owner
					owner = {
						is_same_value =	event_target:ratling_country
					}
					root = {
						intel_level = {
							level > none
							system = prev
						}
					}
				}
				save_event_target_as = sensor_ratling_system
			}
		}
		ELSE = { #Nothing
		}
	}

	option = {
		name = INTERESTING
	}

	option = {
		name = "distar.234.phobe"
		exclusive_trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_civic = civic_machine_terminator
			}
		}
		hidden_effect = {
			#Auto-establish comms if we researched Ketlings
			IF = {
				LIMIT = {
					has_country_flag = researched_ketlings
				}
				establish_communications = event_target:ratling_country
				establish_contact = { who = root location = event_target:sensor_ratling_system }
			}
		}
	}

	option = {
		name = MARVELOUS
		exclusive_trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
				has_civic = civic_machine_servitor
			}
		}
		hidden_effect = {
			#Auto-establish comms if we researched Ketlings
			IF = {
				LIMIT = {
					has_country_flag = researched_ketlings
				}
				establish_communications = event_target:ratling_country
				establish_contact = { who = root location = event_target:sensor_ratling_system }
			}
		}
	}

	option = {
		name = TASTY
		exclusive_trigger = {
			has_civic = civic_hive_devouring_swarm
		}
		hidden_effect = {
			#Auto-establish comms if we researched Ketlings
			IF = {
				LIMIT = {
					has_country_flag = researched_ketlings
				}
				establish_communications = event_target:ratling_country
				establish_contact = { who = root location = event_target:sensor_ratling_system }
			}
		}
	}
}

country_event = { #Adds CBs and opinion mods on Communications Established (action.11)
	id = distar.238
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = {
			any_system_within_border = {
				has_star_flag = ratling_system
			}
		}
		exists = event_target:ratling_country
		event_target:contact_empire = {
			is_same_value = event_target:ratling_country
		}
	}

	immediate = {
		every_system = {
			limit = {
				has_star_flag = ratling_system
				is_owned_by = from
			}
			add_claims = {
				who = event_target:ratling_country
				num_of_claims = 1
				show_notification = yes
			}
			event_target:ratling_country = {
				add_opinion_modifier = {
					who = from
					modifier = opinion_ratling_system_stolen
				}
			}
		}
	}
}

country_event = { #Adds CBs and opinion mods on Communications Established (action.13)
	id = distar.239
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		from = {
			any_system_within_border = {
				has_star_flag = ratling_system
			}
		}
		exists = event_target:ratling_country
		event_target:contact_empire = {
			is_same_value = event_target:ratling_country
		}
	}

	immediate = {
		if = {
			limit = {
				NOT = {
					event_target:ratling_country = {
						has_opinion_modifier = {
							who = from
							modifier = opinion_ratling_system_stolen
						}
					}
				}
			}
			every_system = {
				limit = {
					has_star_flag = ratling_system
					is_owned_by = from
				}
				add_claims = {
					who = event_target:ratling_country
					num_of_claims = 1
					show_notification = yes
				}
				event_target:ratling_country = {
					add_opinion_modifier = {
						who = from
						modifier = opinion_ratling_system_stolen
					}
				}
			}
		}
	}
}

#Sealed Entry System
fleet_event = {
	id = distar.240
	title = "distar.240.name"
	desc = "distar.240.desc"
	picture = GFX_evt_wormhole
	show_sound = event_radio_chatter
	location = from

	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			NOR = {
				has_country_flag = encountered_sealed_system
				has_country_flag = entered_sealed_system
			}
		}
		FROM = { has_star_flag = sealed_entry_system }
	}

	immediate = {
		owner = {
			set_country_flag = encountered_sealed_system
			add_seen_bypass_type = wormhole
		}
		if = {
			limit = { exists = event_target:shroud_country }
			event_target:shroud_country = {
				establish_communications_no_message = root.owner
			}
		}
	}

	option = {
		name = "distar.240.a"
	}
}

fleet_event = { #Entering Sealed System
	id = distar.242
	title = "distar.242.name"
	desc = {
		trigger = {
			owner = { has_country_flag = encountered_sealed_system }
			owner.species = {
				NOR = { has_trait = trait_latent_psionic has_trait = trait_psionic }
			}
		}
		text = "distar.242.desc"
	}
	desc = {
		trigger = {
			owner = { has_country_flag = encountered_sealed_system }
			owner.species = {
				OR = { has_trait = trait_latent_psionic has_trait = trait_psionic }
			}
		}
		text = "distar.242.desc.psi"
	}
	desc = {
		trigger = {
			owner = {
				NOT = {
					has_country_flag = encountered_sealed_system
				}
			}
		}
		text = "distar.242.desc.jump"
	}
	picture = GFX_evt_surreal_visions
	show_sound = event_space_cloud
	location = root

	is_triggered_only = yes

	trigger = {
		FROM = { has_star_flag = sealed_system }
		owner = {
			NOT = { has_country_flag = entered_sealed_system }
		}
		exists = event_target:sealed_psionic_entity
	}

	immediate = {
		owner = {
			set_country_flag = entered_sealed_system
		}
		solar_system = {
			random_system_planet = {
				limit = {
					has_anomaly = yes
					is_planet_class = pc_gaia
				}
				save_event_target_as = tanker_planet
			}
		}
	}

	option = {
		name = BATTLESTATIONS
	}
}

country_event = { #Death of the Sealed System Psionic Entity
	id = distar.243
	title = "distar.243.name"
	desc = "distar.243.desc"
	picture = GFX_evt_surreal_visions
	show_sound = event_space_cloud
	location = fromfrom

	is_triggered_only = yes

	specimen = psionic_entity_residue

	trigger = {
		exists = event_target:sealed_psionic_entity
		FromFromFrom.fleet = {
			is_same_value = event_target:sealed_psionic_entity
		}
		is_country_type = default
	}

	option = {
		name = EXCELLENT
	}
}

ship_event = { #Sealed System Anomaly Reward
	id = distar.244
	title = "distar.244.name"
	desc = {
		trigger = {
			owner = { is_machine_empire = no }
		}
		text = "distar.244.desc"
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		text = "distar.244.desc.machi"
	}
	picture = GFX_evt_derelict_interior
	show_sound = event_laboratory_sound
	location = FROM

	is_triggered_only = yes

	option = {
		name = FASCINATING
		owner = {
			add_research_option = tech_neuroregeneration
			add_tech_progress = {
				tech = tech_neuroregeneration
				progress = 0.30
			}
		}
	}

	option = {
		exclusive_trigger = {
			owner = { is_machine_empire = yes }
		}
		name = CURIOUS
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier5researchreward
				min = @tier5researchmin
				max = @tier5researchmax
			}
		}
	}
}

ship_event = {
	id = distar.245
	title = "distar.245.name"
	desc = "distar.245.desc"
	picture = GFX_evt_space_debris
	show_sound = event_scanner
	location = event_target:droppod_tar

	is_triggered_only = yes

	immediate = {
		ethic_leader_creator = {
			SPECIES_CLASS = AI
			LEADER_PORTRAIT = cpl_04
			CLASS = official
			NAME = NAME_Caretaker
			LEVEL = 4
			GENDER = indeterminable
			IMMORTAL = no
			ETHIC = gestalt_consciousness
			DESC = caretaker_leader_desc
			CATCH_PHRASE = caretaker_leader_catch_phrase
		}
		last_created_leader = {
			add_trait = subclass_official_governor
			add_trait = leader_trait_govenor_caretaker
			add_trait = leader_trait_intellectual
			add_trait = leader_trait_settler
			save_event_target_as = caretaker_leader_tar
			set_age = 709
		}
	}

	option = {
		name = ONSCREEN
		hidden_effect = {
			owner = { country_event = { id = distar.246 } }
		}
	}
	option = {
		name = NOTIME
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
		}
	}
}

country_event = {
	id = distar.246
	title = "distar.246.name"
	desc = "distar.246.desc"
	location = event_target:droppod_tar

	show_sound = event_administrative_work
	location = fromfrom
	is_triggered_only = yes
	picture = GFX_leader_recruitment_bg_renowned
	event_window_type = leader_recruit
	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:caretaker_leader_tar
		room = ethic_spaceship_room
	}

	option = {	#Accept the leader
		tag = hire_leader
		name = {
			trigger = {
				is_machine_empire = no
			}
			text = "distar.246.a"
		}
		name = {
			trigger = {
				is_machine_empire = yes
			}
			text = "distar.246.machi"
		}
		allow = {
			NOR = {
				has_policy_flag = ai_outlawed
				has_civic = civic_fanatic_purifiers
				has_civic = civic_hive_devouring_swarm
			}
		}
		hidden_effect = {
			hire_event_leader_effect = {
				LEADER = caretaker_leader_tar
			}
			event_target:droppod_tar = {
				destroy_ambient_object = this
			}
		}
		if = {
			limit = {
				is_gestalt = yes
			}
			random_owned_leader = {
				limit = {
					is_councilor_type = councilor_gestalt_growth
				}
				add_trait = leader_trait_govenor_caretaker_node
			}
		}
	}

	option = {	#Examine the leader
		name = "distar.246.b"
		trigger = {
			NOR = {
				is_machine_empire = yes
				has_policy_flag = ai_outlawed
			}
		}
		tag = dismiss_leader
		custom_tooltip = "distar.246.b.tooltip"
		tooltip = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			country_event = { id = distar.247 }
		}
	}
	option = { #Destroy the leader
		name = distar.246.d.destroy
		custom_tooltip = "distar.246.d"
		trigger = {
			has_policy_flag = ai_outlawed
		}
		tag = dismiss_leader
		tooltip = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier1influencereward
				min = @tier1influencemin
				max = @tier1influencemax
			}
		}
		hidden_effect = {
			country_event = { id = distar.248 }
		}
	}

	option = {	#Repurpose the leader (MI)
		trigger = {
			is_machine_empire = yes
		}
		tag = dismiss_leader
		name = "distar.246.machi.b"
		custom_tooltip = "distar.246.b.tooltip"
		tooltip = {
			add_resource = { minerals = 100 }
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			country_event = { id = distar.248 }
		}
	}
	option = {
		name = distar.246.f
		is_dialog_only = yes
		response_text = distar.246.f.response
	}
	option = {
		name = distar.247.e
		is_dialog_only = yes
		response_text = distar.247.e.response
	}
}

country_event = { #Examining the leader
	id = distar.247
	title = "distar.247.name"
	desc = "distar.247.desc"
	location = event_target:droppod_tar

	picture = GFX_evt_robot_encounter
	event_window_type = leader_story

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:caretaker_leader_tar
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.247.a"
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
	}
}

country_event = { #Destroying the leader
	id = distar.248
	title = "distar.248.name"
	desc = {
		trigger = { is_machine_empire = yes }
		text = "distar.248.desc.machi"
	}
	desc = {
		trigger = { is_machine_empire = no }
		text = "distar.248.desc"
	}
	location = event_target:droppod_tar

	picture = GFX_evt_exploding_ship
	event_window_type = leader_story

	is_triggered_only = yes

	picture_event_data = {
		portrait = event_target:caretaker_leader_tar
		room = ethic_spaceship_room
	}

	option = {
		name = "distar.248.machi"
		exclusive_trigger = {
			is_machine_empire = yes
		}
		add_resource = { minerals = 100 }
		add_monthly_resource_mult = {
			resource = engineering_research
			value = @tier2researchreward
			min = @tier2researchmin
			max = @tier2researchmax
		}
		hidden_effect = {
			event_target:droppod_tar = {
				destroy_ambient_object = this
			}
		}
	}

	option = {
		name = "distar.248.a"
		add_monthly_resource_mult = {
			resource = influence
			value = @tier1influencereward
			min = @tier1influencemin
			max = @tier1influencemax
		}
		hidden_effect = {
			event_target:droppod_tar = {
				destroy_ambient_object = this
			}
		}
	}
}

ship_event = { #Phaseshifting Planet
	id = distar.250
	title = "distar.250.name"
	desc = "distar.250.desc"
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_shrouded
			}
		}
		picture = GFX_evt_shrouded_planet
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_gaia
			}
		}
		picture = GFX_evt_gaia
	}
	show_sound = event_mystic_reveal_light
	location = from

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = surveyed_phaseshift_planet
		}
		from = {
			IF = {
				limit = {
					NOT = { has_modifier = phaseshifted }
				}
				add_modifier = { modifier = phaseshifted days = -1 }
			}
		}
	}

	option = {
		name = "distar.250.a"
		hidden_effect = {
			from = {
				set_name = "NAME_The_Veil"
			}
			ship_event = { id = distar.251 days = 1 }
		}
	}
}

ship_event = {
	id = distar.251
	title = "distar.251.name"
	desc = {
		trigger = {
			event_target:phaseshift_planet = {
				is_planet_class = pc_gaia #Inverted check bc pc_change in immediate actually runs after
			}
		}
		text = "distar.251.desc.shroud"
	}
	desc = {
		trigger = {
			event_target:phaseshift_planet = {
				is_planet_class = pc_shrouded #Inverted check bc pc_change in immediate actually runs after
			}
		}
		text = "distar.251.desc.gaia"
	}
	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal
	location = event_target:phaseshift_planet

	is_triggered_only = yes

	trigger = {
		exists = event_target:phaseshift_planet
	}

	immediate = {
		event_target:phaseshift_planet = {
			IF = {
				limit = { is_planet_class = pc_shrouded }
				change_pc = pc_gaia
				clear_deposits = yes
				add_deposit = d_active_volcano
				add_deposit = d_mountain_range
				add_deposit = d_tempestous_mountain
				add_deposit = d_underwater_vent
				add_deposit = d_buzzing_plains
				add_deposit = d_submerged_ore_veins
				add_deposit = d_submerged_ore_veins
				add_deposit = d_lush_jungle
				add_deposit = d_natural_farmland
				add_deposit = d_natural_farmland
				add_deposit = d_alien_pets_deposit
				add_deposit = d_teeming_reef
			}
			ELSE_IF = {
				limit = { is_planet_class = pc_gaia }
				change_pc = pc_shrouded
				clear_deposits = yes
			}
		}
	}

	option = {
		name = INCREDIBLE
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

ship_event = { #If we own the system, and the planet is still shifting when researching the anomaly
	id = distar.302
	title = "distar.250.name"
	desc = {
		trigger = {
			owner = {
				has_special_project = PHASESHIFT_PROJECT
			}
		}
		text = "distar.302.desc"
	}
	desc = {
		trigger = {
			owner = {
				NOT = { has_special_project = PHASESHIFT_PROJECT }
			}
		}
		text = "distar.302.desc.noproj"
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_shrouded
			}
		}
		picture = GFX_evt_shrouded_planet
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_gaia
			}
		}
		picture = GFX_evt_gaia
	}
	show_sound = event_mystic_reveal_light
	location = from

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = surveyed_phaseshift_planet
		}
	}

	option = {
		name = FASCINATING
		hidden_effect = {
			from = {
				set_name = "NAME_The_Veil"
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

ship_event = { #If the planet has already been locked into a Gaia World
	id = distar.303
	title = "distar.250.name"
	desc = "distar.303.desc"
	picture = GFX_evt_gaia
	show_sound = event_mystic_reveal_light
	location = from

	is_triggered_only = yes

	immediate = {
		owner = {
			set_country_flag = surveyed_phaseshift_planet
		}
	}

	option = {
		name = INTERESTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
		hidden_effect = {
			from = {
				set_name = "NAME_The_Veil"
			}
		}
	}
}

event = { #Gamestart for Recursive Phaseshift
	id = distar.252
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:phaseshift_planet
		event_target:phaseshift_planet = {
			has_planet_flag = phaseshifting_active
		}
	}

	immediate = {
		event_target:phaseshift_planet = {
			planet_event = { id = distar.257 }
		}
	}
}

ship_event = { #A country completes the Special Project to Phase-Lock
	id = distar.253
	title = "distar.253.name"
	desc = "distar.253.desc"
	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal
	location = event_target:phaseshift_planet

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		custom_tooltip = "distar.253.a.tooltip"
		hidden_effect = {
			event_target:phaseshift_planet = {
				IF = {
					limit = { NOT = { is_planet_class = pc_gaia } }
					change_pc = pc_gaia
					clear_deposits = yes
					add_deposit = d_active_volcano
					add_deposit = d_mountain_range
					add_deposit = d_tempestous_mountain
					add_deposit = d_underwater_vent
					add_deposit = d_buzzing_plains
					add_deposit = d_submerged_ore_veins
					add_deposit = d_submerged_ore_veins
					add_deposit = d_lush_jungle
					add_deposit = d_natural_farmland
					add_deposit = d_natural_farmland
					add_deposit = d_alien_pets_deposit
					add_deposit = d_teeming_reef
				}
				remove_planet_flag = phaseshifting_active
				remove_modifier = phaseshifted
				if = {
					limit = { has_mining_station = yes }
					mining_station = { dismantle = yes }
				}
				if = {
					limit = { has_research_station = yes }
					research_station = { dismantle = yes }
				}
			}
			every_country = { #Just in case
				limit = {
					has_special_project = PHASESHIFT_PROJECT
					NOT = {
						is_same_value = root.owner
					}
				}
				abort_special_project = { type = PHASESHIFT_PROJECT }
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

ship_event = { #Special Project Gatekeeper (on_starbase_transfer, on_building_starbase_outpost)
	id = distar.254
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = solar_system
		solar_system = {
			has_star_flag = phaseshift_system
		}
		owner = {
			NOT = {
				has_special_project = PHASESHIFT_PROJECT
			}
		}
		event_target:phaseshift_planet = {
			has_planet_flag = phaseshifting_active
		}
	}

	immediate = {
		owner = {
			country_event = { id = distar.255 days = 1 }
		}
		every_country = {
			limit = {
				has_special_project = PHASESHIFT_PROJECT
				NOT = {
					is_same_value = root.owner
				}
			}
			abort_special_project = { type = PHASESHIFT_PROJECT }
		}
	}
}

country_event = { #Grants Special Project to Phase-Lock Planet
	id = distar.255
	title = "distar.255.name"
	desc = {
		trigger = {
			has_country_flag = surveyed_phaseshift_planet
		}
		text = "distar.255.desc"
	}
	desc = {
		trigger = {
			NOT = { has_country_flag = surveyed_phaseshift_planet }
		}
		text = "distar.255.desc.first"
	}
	picture = GFX_evt_surreal_visions
	show_sound = event_mystic_reveal
	location = event_target:phaseshift_planet

	is_triggered_only = yes

	trigger = {
		NOT = { #Don't grant temporary wartime occupiers the Special Project
			is_at_war_with = from
		}
	}

	option = {
		name = "distar.255.a"
		event_target:phaseshift_planet = {
			enable_special_project = {
				name = "PHASESHIFT_PROJECT"
				location = this
				owner = root
			}
		}
	}

	option = {
		name = "distar.255.b"
		add_monthly_resource_mult = {
			resource = influence
			value = @tier2influencereward
			min = @tier2influencemin
			max = @tier2influencemax
		}
	}
}

ship_event = { #on_survey Gatekeeper
	id = distar.256
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:phaseshift_planet
		from = {
			is_same_value = event_target:phaseshift_planet
			has_planet_flag = phaseshifting_active
		}
	}

	immediate = {
		if = { #If this is the first time the planet is being surveyed, add anomaly
			limit = {
				from = {
					NOT = { has_planet_flag = phaseshift_planet_surveyed }
				}
			}
			from = {
				add_anomaly = {
					category = DISTAR_PHASE_CAT
				}
				set_planet_flag = phaseshift_planet_surveyed
			}
		}
		else = { #else run notif event instead
			ship_event = { id = distar.258 days = 1 }
		}
	}
}

ship_event = {
	id = distar.258
	title = "distar.256.name"
	desc = "distar.256.desc"
	picture = GFX_evt_shrouded_planet
	show_sound = event_mystic_reveal_light
	location = event_target:phaseshift_planet

	is_triggered_only = yes

	trigger = {
		owner = {
			NOT = {
				has_country_flag = surveyed_phaseshift_planet
			}
		}
	}

	immediate = {
		owner = {
			set_country_flag = surveyed_phaseshift_planet
		}
		from = {
			IF = {
				limit = {
					NOT = { has_modifier = phaseshifted }
				}
				add_modifier = { modifier = phaseshifted days = -1 }
			}
		}
	}

	option = {
		name = INCREDIBLE
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

planet_event = { #Recursive Phaseshift
	id = distar.257
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		has_planet_flag = phaseshifting_active
	}

	immediate = {
		IF = {
			limit = { is_planet_class = pc_gaia }
			change_pc = pc_shrouded
			clear_deposits = yes
			IF = {
				limit = {
					NOT = { has_modifier = phaseshifted }
				}
				add_modifier = { modifier = phaseshifted days = -1 }
			}
		}
		ELSE_IF = {
			limit = { is_planet_class = pc_shrouded }
			change_pc = pc_gaia
			clear_deposits = yes
			add_deposit = d_active_volcano
			add_deposit = d_mountain_range
			add_deposit = d_tempestous_mountain
			add_deposit = d_underwater_vent
			add_deposit = d_buzzing_plains
			add_deposit = d_submerged_ore_veins
			add_deposit = d_submerged_ore_veins
			add_deposit = d_lush_jungle
			add_deposit = d_natural_farmland
			add_deposit = d_natural_farmland
			add_deposit = d_alien_pets_deposit
			add_deposit = d_teeming_reef

			IF = {
				limit = {
					NOT = { has_modifier = phaseshifted }
				}
				add_modifier = { modifier = phaseshifted days = -1 }
			}
		}
		ELSE_IF = {
			limit = { is_planet_class = pc_broken }
			remove_planet_flag = phaseshifting_active
		}
		ELSE = {
			change_pc = pc_shrouded
			clear_deposits = yes
			IF = {
				limit = {
					NOT = { has_modifier = phaseshifted }
				}
				add_modifier = { modifier = phaseshifted days = -1 }
			}
		}
		planet_event = { id = distar.257 days = 90 }
	}
}

#Funlent Blue is Mushroom Dudes
planet_event = { #on_spawn
	id = distar.260
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		set_planet_flag = funlent_planet
		add_deposit = d_city_ruins
		#Create the funlent species
		create_species = {
			name = random
			class = PRE_FUN
			portrait = fun11
			namelist = "FUN4"
			homeworld = root
			sapient = no
			traits = {
				trait = trait_presapient_docile_livestock
			}
			effect = {
				save_global_event_target_as = livestock_species
			}
		}
		while = {
			count = 5
			create_pop = {
				species = event_target:livestock_species
			}
		}
	}
}

ship_event = {
	id = distar.261
	title = "distar.261.name"
	desc = "distar.261.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	option = {
		name = "distar.234.phobe"
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = INTERESTING
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_authoritarian
					has_civic = civic_slaver_guilds
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = TASTY
		exclusive_trigger = {
			owner = {
				has_civic = civic_hive_devouring_swarm
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.servi"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_servitor
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.assim"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_assimilator
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}

	option = {
		name = "distar.261.a.exter"
		exclusive_trigger = {
			owner = {
				has_civic = civic_machine_terminator
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}

	option = {
		name = SCUM
		exclusive_trigger = {
			owner = {
				has_civic = civic_fanatic_purifiers
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

planet_event = {
	id = distar.262
	title = "distar.262.name"
	desc = "distar.262.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_alien_nature
	location = root

	is_triggered_only = yes

	trigger = {
		has_planet_flag = funlent_planet
		any_owned_pop = {
			is_same_species = event_target:livestock_species
		}
		owner = {
			NOT = {
				is_machine_empire = yes
			}
		}
	}

	option = {
		name = "distar.262.a"
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier2influencereward
				min = @tier2influencemin
				max = @tier2influencemax
			}
		}
	}

	option = {
		allow = { owner = { resource_stockpile_compare = { resource = energy value >= 300 } } }
		name = "distar.262.b"
		custom_tooltip = "distar.262.b.tooltip.2"
		owner = { add_resource = { energy = -300 } }
		add_deposit = d_processing_pens
		hidden_effect = {
			while = {
				limit = {
					any_owned_pop = {
						is_same_species = event_target:livestock_species
					}
				}
				random_owned_pop = {
					limit = {
						is_same_species = event_target:livestock_species
					}
					kill_pop = yes
				}
			}
		}
	}
}

#Sonified Signal
ship_event = {
	id = distar.265
	title = "distar.265.name"
	desc = "distar.265.desc"
	picture = GFX_evt_satellite_in_orbit
	show_sound = event_alien_signal
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = CURIOUS
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			hidden_effect = {
				pop_lcluster_event = yes
				set_country_flag = lcluster_clue_sonic
			}
		}
	}
	option = {
		exclusive_trigger = {
			owner = {
				has_civic = civic_fanatic_purifiers
			}
		}
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier1researchreward
				min = @tier1researchmin
				max = @tier1researchmax
			}
			hidden_effect = {
				pop_lcluster_event = yes
				set_country_flag = lcluster_clue_sonic
			}
		}
	}
}

#Puzzle Box
ship_event = {
	id = distar.270
	title = "distar.270.name"
	desc = "distar.270.desc"
	picture = GFX_evt_ship_in_orbit_2
	show_sound = event_default
	location = from

	is_triggered_only = yes

	specimen = sonic_reflective_prism

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = "discovery.270.a"
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
		}
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
	}
}

#Peaceful Nanite Village
ship_event = {
	id = distar.275
	title = "distar.275.name"
	desc = {
		trigger = {
			owner = {
				num_communications > 0
			}
		}
		text = "distar.275.desc.comms"
	}
	desc = {
		trigger = {
			owner = {
				num_communications < 1
			}
		}
		text = "distar.275.desc.nocomms"
	}
	picture = GFX_evt_dead_city
	show_sound = event_default
	location = from

	is_triggered_only = yes

	immediate = {
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = INCREDIBLE
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_resource = { nanites = 200 }
			generate_lcluster_clue = yes
		}
	}

	option = {
		name = DISCONCERTING
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
	}
}

#Nanosands
ship_event = {
	id = distar.280
	title = "distar.280.name"
	desc = "distar.280.desc"
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_desert
			}
		}
		picture = GFX_evt_desert
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_gaia
			}
		}
		picture = GFX_evt_gaia
	}
	picture = {
		trigger = {
			from = {
				is_planet_class = pc_barren
			}
		}
		picture = GFX_evt_warm_barren
	}
	show_sound = event_default
	location = from

	is_triggered_only = yes

	immediate = {
		from = {
			if = {
				limit = { is_planet_class = pc_barren }
				clear_deposits = yes
			}
		}
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = ASTOUNDING
		from = {
			IF = {
				limit = { habitable_planet = yes }
				add_deposit = d_nanosands
			}
			ELSE = {
				add_deposit = d_minerals_4
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			add_resource = { nanites = 200 }
			generate_lcluster_clue = yes
		}
	}

	option = {
		exclusive_trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe
				}
			}
		}
		name = DISCONCERTING
		from = {
			IF = {
				limit = { habitable_planet = yes }
				add_deposit = d_nanosands
			}
			ELSE = {
				add_deposit = d_minerals_4
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
	}
}

#Gatebuilder Medical Facility
ship_event = {
	id = distar.285
	title = "distar.285.name"
	desc = "distar.285.desc"
	picture = GFX_evt_gas_giant
	show_sound = event_scanner
	location = from

	is_triggered_only = yes

	immediate = {
		from = { clear_deposits = yes }
		owner = { country_event = { id = story.5 days = 30 } }
	}

	option = {
		name = INCREDIBLE
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			generate_lcluster_clue = yes
		}
		from = {
			add_deposit = d_exotic_gases_2
		}
	}
}
