##############################
# Colony Events
##############################

namespace = colony_mod

planet_event = { #Irradiated
	id = colony_mod.1
	title = "colony_mod.1.name"
	desc = {
		trigger = { owner = { is_machine_empire = no } }
		text = "colony_mod.1.desc"
	}
	desc = {
		trigger = { owner = { is_machine_empire = yes } }
		text = "colony_mod.1.desc_mach"
	}
	picture = GFX_evt_alien_city
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "irradiated_planet"
		NOT = { has_planet_flag = irradiated_colony_flag }
		num_pops > 0
	}

	immediate = {
		set_planet_flag = irradiated_colony_flag
	}

	is_triggered_only = yes

	option = {
		name = colony_mod.1.a
		custom_tooltip = irradiated_planet_tooltip
		hidden_effect = {
			random_list = {
				20 = { planet_event = { id = colony_mod.6 days = 40 random = 20 } }
				20 = { planet_event = { id = colony_mod.7 days = 40 random = 20 } }
				20 = { planet_event = { id = colony_mod.8 days = 40 random = 20 } }
				40 = { planet_event = { id = colony_mod.9 days = 40 random = 20 } }
			}
		}
	}
}

planet_event = {
	id = colony_mod.6
	title = "colony_mod.6.name"
	desc = "colony_mod.6.desc"
	picture = GFX_evt_atmospheric_entry
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony_mod.6.a #physics
		add_deposit = d_ancient_bombardment_craters
	}
}

planet_event = {
	id = colony_mod.7
	title = "colony_mod.7.name"
	desc = "colony_mod.7.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony_mod.7.a #eng
		add_deposit = d_ancient_battlefield
	}
}

planet_event = {
	id = colony_mod.8
	title = "colony_mod.8.name"
	desc = {
		text = "colony_mod.8.desc"
		trigger = {
			owner = {
				NOR = {
					has_government = gov_machine_terminator
					has_civic = civic_fanatic_purifiers
				}
			}
		}
	}
	desc = {
		text = "colony_mod.8.desc_mach"
		trigger = {
			owner = {
				OR = {
					has_civic = civic_fanatic_purifiers
					has_government = gov_machine_terminator
				}
			}
		}
	}
	picture = GFX_evt_nuclear_explosion
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony_mod.8.a #soc
		add_deposit = d_irradiated_ruins
	}
}

planet_event = {
	id = colony_mod.9
	title = "colony_mod.9.name"
	desc = "colony_mod.9.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony_mod.9.a #modifier
		add_modifier = {
			modifier = "planet_uncertain_past"
			days = -1
		}
	}
}

planet_event = { #titanic life
	id = colony_mod.2
	title = "colony_mod.2.name"
	desc = "colony_mod.2.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT
	trackable = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "titanic_life"
		NOT = { has_planet_flag = titanic_life_colony_flag }
		num_pops > 0
	}

	immediate = {
		set_planet_flag = titanic_life_colony_flag
	}

	is_triggered_only = yes

	option = {
		name = colony_mod.2.a# yes
		# study them, may have bad outcome, such as a hostile unit spawning
		enable_special_project = {
			name = "titanic_life_study_normal"
			location = this
			owner = root
		}
	}

	option = {
		name = colony_mod.2.b# no
		#no effect, don't bother them
	}

	option = {
		name = colony_mod.2.c
		trigger = {
			owner = { OR = { has_ethic = ethic_xenophile has_ethic = ethic_fanatic_xenophile } #nice, for xenophiles
			}
		}
		# study them, bad outcome less likely but takes longer.
		# Remove blockers in success result
		enable_special_project = {
			name = "titanic_life_study_nice"
			location = this
			owner = root
		}
		hidden_effect = {
			set_planet_flag = nice_titan_study
		}
	}

	option = {
		name = colony_mod.2.d
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_xenophobe
					has_ethic = ethic_fanatic_xenophobe
					is_hive_empire = yes
				} #mean, for xenophobe
			}
		}
		# study them, takes less time but you will likely get a bad effect too
		# huge food output increase
		enable_special_project = {
			name = "titanic_life_study_mean"
			location = this
			owner = root
		}
		add_modifier = {
			modifier = "eat_the_titans"
			days = -1
		}
	}

}

planet_event = {
	id = colony_mod.101
	title = "colony_mod.101.name"
	desc = "colony_mod.101.desc"
	picture = GFX_evt_alien_cavemen
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		trigger = {
			NOT = {
				has_planet_flag = nice_titan_study
			}
		}
		hidden_effect = {
			owner = { set_country_flag = titanic_life_soldiers } #Owner flag not actually needed, but could have techs or other things tie into it
			set_planet_flag = titanic_life_can_build
		}
		custom_tooltip = titanic_recruit_tooltip
	}

	option = {
		name = EXCELLENT
		trigger = {
			has_planet_flag = nice_titan_study
		}
		hidden_effect = {
			owner = { set_country_flag = titanic_life_soldiers } #Owner flag not actually needed, but could have techs or other things tie into it
			set_planet_flag = titanic_life_can_build
			every_deposit = {
				limit = { is_deposit_type = d_titanic_life_blocker }
				clear_blocker = yes
			}
		}
		custom_tooltip = titanic_recruit_phile_tooltip
	}

}

planet_event = {
	id = colony_mod.102
	title = "colony_mod.102.name"
	desc = "colony_mod.102.desc"
	picture = GFX_evt_ground_combat
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	immediate = {
		create_country = {
			name = "NAME_Titanic_Life"
			type = faction
			effect = {
				establish_communications_no_message = root.owner
			}
		}
		create_species = {
			name = "NAME_Titans"
			class = random_non_machine
			portrait = random
			traits = random
		}
		create_army = {
			name = "NAME_Enraged_Guardian"
			owner = last_created_country
			species = last_created_species
			type = "titanic_guardian_army"
		}
		create_army = {
			name = "NAME_Enraged_Titan"
			owner = last_created_country
			species = last_created_species
			type = "titanic_guardian_army"
		}
		create_army = {
			name = "NAME_Enraged_Titan"
			owner = last_created_country
			species = last_created_species
			type = "titanic_guardian_army"
		}
	}

	option = {
		name = TERRIBLE
		custom_tooltip = titanic_uprising_tooltip
	}

}

planet_event = {
	id = colony_mod.3 #unstable tectonics
	title = "colony_mod.3.name"
	desc = "colony_mod.3.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "unstable_tectonics"
		NOT = { has_modifier = "recent_quake" }
		num_pops > 0
	}

	is_triggered_only = yes

	option = {
		name = colony_mod.3.a
		add_modifier = {
			modifier = "recent_quake"
			days = 365
		}
		custom_tooltip = quake_report_tooltip
		hidden_effect = {
			random_list = {
				33 = { planet_event = { id = colony_mod.21 days = 10 random = 5 } }
				33 = { planet_event = { id = colony_mod.22 days = 10 random = 5 } }
				33 = { planet_event = { id = colony_mod.23 days = 10 random = 5 } }
			}
		}
	}
}

planet_event = {
	id = colony_mod.21
	title = "colony_mod.21.name"
	desc = "colony_mod.21.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = WORRYING
		add_deposit = d_deep_sinkhole
	}
}

planet_event = {
	id = colony_mod.22
	title = "colony_mod.21.name"
	desc = "colony_mod.22.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = REMARKABLE
		OWNER = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
	}

}

planet_event = {
	id = colony_mod.23
	title = "colony_mod.21.name"
	desc = "colony_mod.23.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = GOOD
	#no effect
	}

}

planet_event = {
	id = colony_mod.4 #asteroid belt
	title = "colony_mod.4.name"
	desc = "colony_mod.4.desc"
	picture = GFX_evt_asteroid_approaching_planet
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "asteroid_belt"
		NOT = { has_modifier = "recent_comet" }
		num_pops > 0
	}

	is_triggered_only = yes

	option = {
		name = colony_mod.4.a
		add_modifier = {
			modifier = "recent_comet"
			days = 1800
		}
	}

}

planet_event = {
	id = colony_mod.5
	title = "colony_mod.5.name"
	desc = "colony_mod.5.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_air_raid_siren
	location = ROOT
	trackable = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		owner = { is_gestalt = no }
		has_modifier = "atmospheric_hallucinogen"
		NOT = { has_planet_flag = atmospheric_hallucinogen_colony_flag }
		num_pops > 0
	}

	immediate = {
		set_planet_flag = atmospheric_hallucinogen_colony_flag
	}

	is_triggered_only = yes

	option = {
		name = colony_mod.5.a
		enable_special_project = {
			name = "hallucinogen_removal"
			location = this
			owner = root
		}
	}

	option = {
		name = colony_mod.5.b
		owner = {
			add_resource = { unity = -200 }
		}
	}

}

planet_event = {
	id = colony_mod.10 #success
	title = "colony_mod.10.name"
	desc = "colony_mod.10.desc"
	picture = GFX_evt_atmospheric_entry
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = GOOD
		remove_modifier = "atmospheric_hallucinogen"
	}

}

planet_event = {
	id = colony_mod.11 #failure
	title = "colony_mod.11.name"
	desc = "colony_mod.11.desc"
	picture = GFX_evt_atmospheric_entry
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = MARVELOUS
		hidden_effect = {
			remove_modifier = "atmospheric_hallucinogen"
			add_modifier = {
				modifier = "atmospheric_hallucinogen_good"
				days = -1
			}
		}
		custom_tooltip = hallucinogen_update_tooltip
	}

}

#planet_event = {
#	id = colony_mod.12 #asteroid_impacts
#	title = "colony_mod.12.name"
#	desc = {
#		text = "colony_mod.12.desc"
#		trigger = { NOT = { owner = { is_gestalt = yes } } }
#	}
#	desc = {
#		text = colony_mod.12.desc_gestalt
#		trigger = { owner = { is_gestalt = yes } }
#	}
#	picture = GFX_evt_asteroid_approaching_planet
#	show_sound = event_air_raid_siren
#	location = ROOT
#	trackable = yes
#
#	pre_triggers = {
#		has_owner = yes
#		is_homeworld = no
#		original_owner = yes
#		is_ai = no
#		has_ground_combat = no
#		is_capital = no
#	}
#
#	trigger = {
#		NOT = { has_planet_flag = asteroid_defences_colony_flag }
#		has_modifier = "asteroid_impacts"
#		NOT = { has_modifier = "recent_impact" }
#		num_pops > 1
#	}
#
#	is_triggered_only = yes
#
#	option = {
#		name = colony_mod.12.a #eh
#		if = {
#			limit = { NOT = { owner = { is_gestalt = yes } } }
#			add_modifier = {
#				modifier = "recent_impact"
#				days = 1800
#			}
#		}
#		add_planet_devastation = 20
#	}
#	option = {
#		name = colony_mod.12.b #help
#		enable_special_project = {
#			name = "impact_defence_system"
#			location = this
#			owner = root
#		}
#		if = {
#			limit = { NOT = { owner = { is_gestalt = yes } } }
#			add_modifier = {
#				modifier = "recent_impact"
#				days = 1800
#			}
#		}
#		add_planet_devastation = 20
#	}
#}

#planet_event = {
#	id = colony_mod.13 #impact_defence_system
#	title = "colony_mod.13.name"
#	desc = "colony_mod.13.desc"
#	picture = GFX_evt_atmospheric_entry
#	show_sound = event_air_raid_siren
#	location = ROOT
#
#	is_triggered_only = yes
#
#	option = {
#		name = SPLENDID
#		hidden_effect = {
#			set_planet_flag = asteroid_defences_colony_flag
#		}
#	}
#
#}

#planet_event = {
#	id = colony_mod.14 #asteroid_impacts - good
#	title = "colony_mod.14.name"
#	desc = "colony_mod.14.desc"
#	picture = GFX_evt_asteroid_approaching_planet
#	show_sound = event_air_raid_siren
#	location = ROOT
#	trackable = yes
#
#	pre_triggers = {
#		has_owner = yes
#		is_homeworld = no
#		original_owner = yes
#		is_ai = no
#		has_ground_combat = no
#		is_capital = no
#	}
#
#	trigger = {
#		NOT = { has_planet_flag = asteroid_defences_colony_flag }
#		has_modifier = "asteroid_impacts"
#		num_pops > 1
#		NOR = {
#			has_modifier = "recent_impact"
#			has_deposit = d_impact_crater
#		}
#	}
#
#	is_triggered_only = yes
#
#	option = {
#		name = colony_mod.14.b #help
#		enable_special_project = {
#			name = "impact_defence_system"
#			location = this
#			owner = root
#		}
#		add_modifier = {
#			modifier = "recent_impact"
#			days = 1800
#		}
#		custom_tooltip = good_impact_tooltip
#		hidden_effect = {
#			add_deposit = d_impact_crater
#		}
#	}
#	option = {
#		name = colony_mod.14.a
#		add_modifier = {
#			modifier = "recent_impact"
#			days = 1800
#		}
#		custom_tooltip = good_impact_tooltip
#		hidden_effect = {
#			add_deposit = d_impact_crater
#		}
#	}
#}

planet_event = { #strong magnetic field good
	id = colony_mod.16
	title = "colony_mod.16.name"
	desc = "colony_mod.16.desc"
	picture = GFX_evt_alien_city
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "strong_magnetic_field"
		NOT = { has_modifier = "magnetic_research_boost" }
		NOT = { has_modifier = "magnetic_disruption" }
		NOT = { has_planet_flag = magnetic_mystery_solved }
		num_pops > 0
	}

	immediate = {
		OWNER = {
			change_variable = { #check_variable
				which = "magnetic_planet_research"
				value = 1
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = FASCINATING
		#Idea to revisit: research bonus/increase flag - after a number, say 5, of these events a new special project is enabled to make the effect permanent
		add_modifier = {
			modifier = "magnetic_research_boost"
			days = 1800
		}
		OWNER = {
			if = {
				limit = {
					check_variable = {which = magnetic_planet_research value = 3}
				}
				enable_special_project = {
					name = "MAGNETIC_PLANET_RESEARCH_PROJECT"
					location = root
					owner = this
				}
			}
		}
	}
}

planet_event = { #strong magnetic field bad
	id = colony_mod.17
	title = "colony_mod.17.name"
	desc = "colony_mod.17.desc"
	picture = GFX_evt_alien_city
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		owner = { is_ai = no }
		has_modifier = "strong_magnetic_field"
		NOT = { has_modifier = "magnetic_research_boost" }
		NOT = { has_modifier = "magnetic_disruption" }
		NOT = { has_planet_flag = magnetic_mystery_solved }
		num_pops > 0
	}

	immediate = {
		OWNER = {
			change_variable = { #check_variable
				which = "magnetic_planet_research"
				value = 1
			}
		}
	}

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
		#research penalty/unhappiness
		add_modifier = {
			modifier = "magnetic_disruption"
			days = 1800
		}
		OWNER = {
			if = {
				limit = {
					check_variable = {which = magnetic_planet_research value = 3}
				}
				enable_special_project = {
					name = "MAGNETIC_PLANET_RESEARCH_PROJECT"
					location = root
					owner = this
				}
			}
		}
	}
}

planet_event = {
	id = colony_mod.18
	title = "colony_mod.18.name"
	desc = "colony_mod.18.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony_mod.18.a #modifier
		set_planet_flag = magnetic_mystery_solved
		add_modifier = {
			modifier = "magnetic_research_boost"
			days = -1
		}
	}
}

#Setup event to add Titanic life blockers to planets with the modifier
#Bit of a hack as it is not possible in system initializers
#Slight spam as it will happen along with the "First discovery" event the first time you survey a Titanic life planet, but can't be helped easily
event = {
	id = colony_mod.100
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_galaxy_planet = {
			limit = {
				has_modifier = titanic_life
			}
			add_deposit = d_titanic_life_blocker
		}
	}
}

#Gatekeeper - Colony Events
planet_event = {
	id = colony_mod.161
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				has_modifier = strong_magnetic_field
				NOT = { has_planet_flag = magnetic_mystery_solved }
			}
			has_modifier = asteroid_impacts
			has_modifier = irradiated_planet
			has_modifier = titanic_life
			has_modifier = unstable_tectonics
			has_modifier = asteroid_belt
			has_modifier = atmospheric_hallucinogen
		}
	}

	immediate = {
		if = {
			limit = {
				has_modifier = strong_magnetic_field
				has_modifier = "strong_magnetic_field"
				NOT = { has_modifier = "magnetic_research_boost" }
				NOT = { has_modifier = "magnetic_disruption" }
				has_ground_combat = no
				num_pops > 0
			}
			random_list = {
				50 = { planet_event = { id = colony_mod.16 days = 30 random = 90 } }
				50 = { planet_event = { id = colony_mod.17 days = 30 random = 90 } }
			}
			break = yes
		}
		#if = {
		#	limit = {
		#		has_modifier = asteroid_impacts
		#		NOT = { has_planet_flag = asteroid_defences_colony_flag }
		#		num_pops > 1
		#		NOT = { has_modifier = "recent_impact" }
		#	}
		#	random_list = {
		#		50 = { planet_event = { id = colony_mod.12 days = 30 random = 90 } }
		#		50 = { planet_event = { id = colony_mod.14 days = 30 random = 90 } }
		#	}
		#	break = yes
		#}

		if = {
			limit = {
				has_modifier = irradiated_planet
				NOT = { has_planet_flag = irradiated_colony_flag }
			}
			planet_event = { id = colony_mod.1 days = 30 random = 90 }
			break = yes
		}

		if = {
			limit = {
				has_modifier = titanic_life
				NOR = {
					has_planet_flag = titanic_life_colony_flag
					owner = { is_gestalt = yes }
				}
			}
			planet_event = { id = colony_mod.2 days = 30 random = 90 }
			break = yes
		}

		if = {
			limit = {
				has_modifier = unstable_tectonics
				NOT = { has_modifier = recent_quake }
			}
			planet_event = { id = colony_mod.3 days = 30 random = 90 }
			break = yes
		}

		if = {
			limit = {
				has_modifier = "asteroid_belt"
				NOR = {
					has_modifier = "recent_comet"
					owner = { is_gestalt = yes }
				}
			}
			planet_event = { id = colony_mod.4 days = 30 random = 90 }
			break = yes
		}

		if = {
			limit = {
				has_modifier = atmospheric_hallucinogen
				NOR = {
					has_planet_flag = atmospheric_hallucinogen_colony_flag
					owner = { is_gestalt = yes }
				}
			}
			planet_event = { id = colony_mod.5 days = 30 random = 90 }
			break = yes
		}
	}
}

planet_event = { # Rogue moon
	id = colony.3001
	title = "colony.3001.name"
	desc = "colony.3001.desc"
	picture = GFX_evt_asteroid_approaching_planet
	location = ROOT
	trackable = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		is_capital = no
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			is_ai = no
			NOT = { has_country_flag = roguemoon_country }
		}
		num_pops > 0
		NOR = {
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
			has_planet_flag = colony_event
		}
		has_moon = yes
		any_moon = {
			habitable_planet = no
			NOT = { is_planet_class = pc_habitat }
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = roguemoon_event
		set_planet_flag = colony_event
		owner = { set_country_flag = roguemoon_country }
		random_moon = {
			limit = {
				habitable_planet = no
			}
			save_event_target_as = roguemoon
		}
	}

	option = {
		name = CURIOUS
		enable_special_project = {
			name = "ROGUEMOON_PROJECT"
			location = this
			owner = root
		}
	}
}

planet_event = { #rogue moonbase
	id = colony.3002
	title = "colony.3002.name"
	desc = "colony.3002.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	is_triggered_only = yes

	option = {
		name = ASTOUNDING
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_mine_dark_matter
				}
				add_tech_progress = {
					tech = tech_mine_dark_matter
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_mine_dark_matter
				add_tech_progress = {
					tech = tech_mine_dark_matter
					progress = 0.25
				}
			}
		}
		event_target:roguemoon = {
			add_deposit = d_dark_matter_deposit_1
		}
	}
}

planet_event = { #dimensional moon
	id = colony.3003
	title = "colony.3003.name"
	desc = "colony.3003.desc"
	picture = GFX_evt_alien_ruins
	location = ROOT

	is_triggered_only = yes

	option = {
		name = FASCINATING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_jump_drive_1
				}
				add_tech_progress = {
					tech = tech_jump_drive_1
					progress = 0.15
				}
			}
			else = {
				add_research_option = tech_jump_drive_1
				add_tech_progress = {
					tech = tech_jump_drive_1
					progress = 0.1
				}
			}
		}
	}
}

planet_event = { #Dimensional portal
	id = colony.3005
	title = "colony.3005.name"
	desc = "colony.3005.desc"
	picture = GFX_evt_wormhole
	location = ROOT
	situation = from #only does something if from is actually a situation
	trackable = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
		is_homeworld = no
		is_capital = no
		has_ground_combat = no
		is_occupied_flag = no
	}

	trigger = {

		owner = {
			is_ai = no
			NOT = { has_country_flag = dportal_country }
		}
		num_pops > 0
		NOR = {
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
			has_planet_flag = colony_event
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = dportal_event
		set_planet_flag = colony_event
		owner = { set_country_flag = dportal_country }

	}

	option = {
		name = INTRIGUING
		enable_special_project = {
			name = "DPORTAL_PROJECT"
			location = this
			owner = root
		}
		if = {
			limit = {
				owner = {
					is_gestalt = yes
				}
			}
			add_deposit = d_portal_research_zone_gestalt
		}
		else = {
			add_deposit = d_portal_research_zone
		}
	}
}

planet_event = { #hell
	id = colony.3006
	title = "colony.3006.name"
	desc = {
		text = colony.3006.knight.desc
		trigger = {
			owner = { has_origin = origin_toxic_knights }
		}
	}
	desc = {
		text = colony.3006.spir.desc
		trigger = {
			owner = {
				is_spiritualist = yes
				NOT = { has_origin = origin_toxic_knights }
			}
		}
	}
	desc = {
		text = colony.3006.desc
		trigger = {
			owner = {
				is_spiritualist = no
				NOT = { has_origin = origin_toxic_knights }
			}
		}
	}
	picture = GFX_evt_space_funeral
	location = ROOT

	is_triggered_only = yes

	immediate = {
		set_planet_flag = dportal_hell
	}

	option = {
		trigger = {
		owner = {
				is_spiritualist = no
			}
		}
		name = colony.3006.science
		enable_special_project = {
			name = "DPORTAL_PROJECT_SCIENCE"
			location = this
			owner = root
		}
	}

	option = {
		name = colony.3006.psi.prayer
		trigger = {
			owner = {
				is_spiritualist = yes
				has_technology = tech_psionic_theory
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_PSI_PRAYER"
			location = this
			owner = root
		}
	}
	option = {
		name = colony.3006.prayer
		trigger = {
			owner = {
				is_spiritualist = yes
				NOT = {	has_technology = tech_psionic_theory }
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_PRAYER"
			location = this
			owner = root
		}
	}

	option = {
		name = colony.3006.rocks
		trigger = {
			owner = {
				is_spiritualist = no
				has_civic = civic_feudal_realm
			}
		}
		enable_special_project = {
			name = "DPORTAL_PROJECT_ROCKS"
			location = this
			owner = root
		}
	}

	option = {
		name = colony.3006.knights
		trigger = {
			owner = {
				has_origin = origin_toxic_knights
			}
		}
		hidden_effect = {
			owner = {
				create_leader = {
					class = general
					species = owner_main_species
					name = random
					traits = {
						trait = leader_trait_chosen
						trait = leader_trait_butcher
					}
				}
				last_created_leader = {
					exile_leader_as = doomslayer_knight
					save_event_target_as = doomslayer_knight
					set_immortal = yes
					save_global_event_target_as = doomslayer_knight@prev
				}
			}
			reroll_random = yes
			random_list = {
				15 = { }
				25 = { planet_event = { id = colony.3050 days = 3600 random = 900 } }
				20 = { planet_event = { id = colony.3060 days = 3600 random = 900 } }
				40 = { planet_event = { id = colony.3055 days = 3600 random = 900 } }
			}
		}
	}

	option = {
		name = colony.3006.keep
		add_deposit = d_portal_research_zone
		custom_tooltip = portal_zone_tooltip
	}
}

planet_event = { #science
	id = colony.3010
	title = "colony.3010.name"
	desc = "colony.3010.desc"
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_power_plant_4
				}
				add_tech_progress = {
					tech = tech_power_plant_4
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_power_plant_3
				}
				add_research_option = tech_power_plant_4
				add_tech_progress = {
					tech = tech_power_plant_4
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_tech_option = tech_power_plant_3
				}
				add_tech_progress = {
					tech = tech_power_plant_3
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_power_plant_3
				add_tech_progress = {
					tech = tech_power_plant_3
					progress = 0.25
				}
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #prayer
	id = colony.3011
	title = "colony.3010.name"
	desc = {
		text = colony.3011.psi.desc
		trigger = {
			owner = {
				has_technology = tech_psionic_theory
			}
		}
	}
	desc = {
		text = colony.3011.desc
		trigger = {
			owner = {
				NOT = { has_technology = tech_psionic_theory }
			}
		}
	}
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					NOT = { has_tech_option = tech_psionic_theory }
				}
				add_research_option = tech_psionic_theory
				add_tech_progress = {
					tech = tech_psionic_theory
					progress = 0.8
				}
			}

			add_research_option = tech_psionic_barrier
			add_tech_progress = {
				tech = tech_psionic_barrier
				progress = 0.5
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #rocks
	id = colony.3012
	title = "colony.3010.name"
	desc = "colony.3012.desc"
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_mining_3
				}
				add_tech_progress = {
					tech = tech_mining_3
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_mining_2
				}
				add_research_option = tech_mining_3
				add_tech_progress = {
					tech = tech_mining_3
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_tech_option = tech_mining_2
				}
				add_tech_progress = {
					tech = tech_mining_2
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_mining_2
				add_tech_progress = {
					tech = tech_mining_2
					progress = 0.25
				}
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}
}

planet_event = { #energy
	id = colony.3007
	title = "colony.3007.name"
	desc = "colony.3007.desc"
	picture = GFX_evt_star_white
	location = ROOT

	is_triggered_only = yes

	immediate = {
		set_planet_flag = dportal_energy
	}

	option = {
		name = FASCINATING
		set_planet_flag = dportal_energy
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
			if = {
				limit = {
					has_tech_option = tech_plasma_3
				}
				add_tech_progress = {
					tech = tech_plasma_3
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_2
				}
				add_research_option = tech_plasma_3
				add_tech_progress = {
					tech = tech_plasma_3
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_tech_option = tech_plasma_2
				}
				add_tech_progress = {
					tech = tech_plasma_2
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_plasma_1
				}
				add_research_option = tech_plasma_2
				add_tech_progress = {
					tech = tech_plasma_2
					progress = 0.25
				}
			}
			else_if = {
				limit = {
					has_tech_option = tech_plasma_1
				}
				add_tech_progress = {
					tech = tech_plasma_1
					progress = 0.5
				}
			}
			else = {
				add_research_option = tech_plasma_1
				add_tech_progress = {
					tech = tech_plasma_1
					progress = 0.25
				}
			}
		}
		custom_tooltip = portal_energy_tooltip
	}
}

planet_event = { #null void
	id = colony.3008
	title = "colony.3008.name"
	desc = "colony.3008.desc"
	picture = GFX_evt_shrouded_planet
	location = ROOT

	is_triggered_only = yes

	immediate = {
		set_planet_flag = dportal_void
	}

	option = {
		name = FASCINATING

		owner = {
			add_research_option = null_void_beam
				add_tech_progress = {
					tech = null_void_beam
					progress = 0.5
				}
		}
		custom_tooltip = portal_void_tooltip
		hidden_effect = {
			planet_event = { id = colony.3040 days = 1825 random = 1825 }
		}
	}
}

planet_event = { #Probe the Void
	id = colony.3040
	title = "colony.3040.name"
	desc = "colony.3040.desc"
	picture = GFX_evt_wormhole
	location = ROOT
	trackable = yes

	pre_triggers  = {
		has_owner = yes
		original_owner = yes
	}

	is_triggered_only = yes

	option = {
		name = INTRIGUING
		enable_special_project = {
			name = "NULLVOID_PROJECT"
			location = this
			owner = root
		}
	}
}

planet_event = { #increase production
	id = colony.3041
	title = "colony.3041.name"
	desc = "colony.3041.desc"
	picture = GFX_evt_shrouded_planet
	location = ROOT
	trackable = yes

	pre_triggers  = {
		has_owner = yes
		original_owner = yes
	}

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		custom_tooltip = portal_void_tooltip2
		set_planet_flag = dportal_void2
	}
}

planet_event = { #mirror
	id = colony.3009
	title = "colony.3009.name"
	desc = "colony.3009.desc"
	picture = GFX_evt_galactic_senate

	is_triggered_only = yes

	option = {
		name = colony.3009.a.robot
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3020 }
		}
	}
	option = {
		name = colony.3009.a
		hidden_effect = {
			planet_event = { id = colony.3020 }
		}
	}

}

planet_event = { #message 1
	id = colony.3020
	title = "colony.3020.name"
	desc = {
		text = colony.3020.desc
		trigger = {
			owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3020.desc.robot
		trigger = {
			owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.3020.a
		hidden_effect = {
			planet_event = { id = colony.3021 }
		}
	}
	option = {
		name = colony.3020.a.robot
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3021 }
		}
	}
}

planet_event = { #message 2
	id = colony.3021
	title = "colony.3020.name"
	desc = {
		text = colony.3021.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3021.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.3021.a #talk more
		trigger = { owner = { is_machine_empire = no } }
		hidden_effect = {
			planet_event = { id = colony.3022 }
		}
	}

	option = {
		name = colony.3021.b #just trade
		trigger = { owner = { is_machine_empire = no } }
		response_text = mirror_trade_reply
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
			}
		}
	}
	option = {
		name = colony.3021.a.robot #talk more
		trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3022 }
		}
	}

	option = {
		name = colony.3021.b.robot #just trade
		trigger = { owner = { is_machine_empire = yes } }
		response_text = mirror_trade_reply.robot
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
			}
		}
	}
}

planet_event = { #message 3
	id = colony.3022
	title = "colony.3020.name"
	desc = {
		text = colony.3022.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3022.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.3022.a
		hidden_effect = {
			planet_event = { id = colony.3023 }
		}
	}
	option = {
		name = colony.3022.a.robot
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3023 }
		}
	}

}

planet_event = { #message 4
	id = colony.3023
	title = "colony.3020.name"
	desc = {
		text = colony.3023.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3023.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.3023.a
		hidden_effect = {
			planet_event = { id = colony.3024 }
		}
	}
	option = {
		name = colony.3023.a.robot
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			planet_event = { id = colony.3024 }
		}
	}
}

planet_event = { #message 5
	id = colony.3024
	title = "colony.3020.name"
	desc = {
		text = colony.3024.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3024.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}

	is_triggered_only = yes

	diplomatic = yes

	picture_event_data = {
		portrait = root.owner.leader
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.3024.a #trade
		response_text = mirror_trade_reply2
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
			}
		}
	}
	option = {
		name = colony.3024.a.robot #trade
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		response_text = mirror_trade_reply2.robot
		set_planet_flag = dportal_trader
		hidden_effect = {
			add_modifier = {
				modifier = "dportal_trade_normal"
				days = -1
			}
			owner = {
				set_country_flag = dportal_trader
			}
		}
	}
}

event = {
	id = colony.3029
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_playable_country = {
			has_country_flag = dportal_trader
		}
	}

	immediate = {
		random_playable_country = {
			limit = { has_country_flag = dportal_trader }
			country_event = { id = colony.3030 }
		}
	}
}

country_event = { #Mirror portal followup events
	id = colony.3030

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_country_flag = dportal_trader
		any_owned_planet = {
			has_planet_flag = dportal_trader
		}
		NOT = { has_country_flag = dportal_empire_crisis_flag }
	}

	immediate = {
		random_owned_planet = {
			limit = {
				has_planet_flag = dportal_trader
			}
			save_event_target_as = dportal_trade_planet
		}
		event_target:dportal_trade_planet = {
			if = {
				limit = {
					has_modifier = dportal_trade_normal
				}
				random_list = {
					60 = { } #no effect
					10 = { planet_event = { id = colony.3031 }} #trade goes up
					10 = { planet_event = { id = colony.3032 }} #trade goes down
				}
			}
			else_if = {
				limit = {
					has_modifier = dportal_trade_low
				}
				random_list = {
					20 = { } #no effect
					20 = { planet_event = { id = colony.3031 }} #trade goes up
					10 = { planet_event = { id = colony.3032 }} #trade goes down
				}
			}
			else_if = {
				limit = {
					has_modifier = dportal_trade_high
				}
				random_list = {
					30 = {} #no effect
					10 = { planet_event = { id = colony.3031 }} #trade goes up
					20 = { planet_event = { id = colony.3032 }} #trade goes down
				}
			}

		}

	}

}

planet_event = { #trade up
	id = colony.3031
	title = "colony.3031.name"
	desc = "colony.3031.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = EXCELLENT
		if = {
			limit = {
				NOT = { has_modifier = dportal_trade_high }
			}
			if = {
				limit = {
					owner = { is_gestalt = no }
				}
				custom_tooltip = dportal_trade_increases_tooltip
			}
			else = {
				custom_tooltip = dportal_trade_increases_gestalt_tooltip
			}
		}
		if = {
			limit = {
				has_modifier = dportal_trade_low
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_high"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			owner = {
				add_monthly_resource_mult = {
					resource = consumer_goods
					value = 6
					min = 100
				}
				add_monthly_resource_mult = {
					resource = volatile_motes
					value = 3
					min = 50
				}
				add_monthly_resource_mult = {
					resource = exotic_gases
					value = 3
					min = 50
				}
				add_monthly_resource_mult = {
					resource = rare_crystals
					value = 3
					min = 50
				}
			}
		}
	}
}

planet_event = { #trade down
	id = colony.3032
	title = "colony.3032.name"
	desc = "colony.3032.desc"
	picture = GFX_evt_wormhole
	location = ROOT

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = colony.3032.a.robot
		exclusive_trigger = { owner = { is_machine_empire = yes } }
		if = {
			limit = {
				NAND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_crisis
							value < 5
						}
					}
				}
			}
			custom_tooltip = dportal_trade_reduces_gestalt_tooltip
		}
		if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			hidden_effect = {
				remove_modifier = dportal_trade_high
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_low"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_low
				owner = {
					check_variable = {
						which = dportal_empire_crisis
						value < 5
					}
				}
			}
			owner = {
				hidden_effect = {
					change_variable = {
						which = dportal_empire_crisis
						value = 1
					}
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_low
				owner = {
					check_variable = {
							which = dportal_empire_crisis
							value >= 5
					}
				}
			}
			add_modifier = {
				modifier = "dportal_trade_crisis"
				days = -1
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				planet_event = { id = colony.3033 days = 1825 random = 1825 }
				owner = { set_country_flag = dportal_empire_crisis_flag }
			}
		}
	}
	option = {
		name = colony.3032.a
		if = {
			limit = {
				NAND = {
					has_modifier = dportal_trade_low
					owner = {
						check_variable = {
							which = dportal_empire_crisis
							value < 5
						}
					}
				}
			}
			if = {
				limit = {
					owner = { is_gestalt = no }
				}
				custom_tooltip = dportal_trade_reduces_tooltip
			}
			else = {
				custom_tooltip = dportal_trade_reduces_gestalt_tooltip
			}
		}
		if = {
			limit = {
				has_modifier = dportal_trade_high
			}
			hidden_effect = {
				remove_modifier = dportal_trade_high
				add_modifier = {
					modifier = "dportal_trade_normal"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_normal
			}
			hidden_effect = {
				remove_modifier = dportal_trade_normal
				add_modifier = {
					modifier = "dportal_trade_low"
					days = -1
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_low
				owner = {
					check_variable = {
							which = dportal_empire_crisis
							value < 5
					}
				}
			}
			owner = {
				hidden_effect = {
					change_variable = {
						which = dportal_empire_crisis
						value = 1
					}
				}
			}
		}
		else_if = {
			limit = {
				has_modifier = dportal_trade_low
				owner = {
					check_variable = {
							which = dportal_empire_crisis
							value >= 5
					}
				}
			}
			add_modifier = {
				modifier = "dportal_trade_crisis"
				days = -1
			}
			hidden_effect = {
				remove_modifier = dportal_trade_low
				planet_event = { id = colony.3033 days = 1825 random = 1825 }
				owner = { set_country_flag = dportal_empire_crisis_flag }
			}
		}
	}
}

planet_event = { #the end of dportal_empire
	id = colony.3033
	title = "colony.3033.name"
	desc = {
		text = colony.3033.desc
		trigger = {
			 owner = { is_machine_empire = no }
		}
	}
	desc = {
		text = colony.3033.desc.robot
		trigger = {
			 owner = { is_machine_empire = yes }
		}
	}
	picture = GFX_evt_wormhole
	location = ROOT
	diplomatic = yes

	picture_event_data = {
		room = no_video_feed_room
	}

	is_triggered_only = yes

	immediate = {

	}

	option = {
		name = colony.3033.a
		trigger = { owner = { is_machine_empire = no } }
		is_dialog_only = yes
		response_text = colony.3033.reply
	}
	option = {
		name = colony.3033.b
		trigger = { owner = { is_machine_empire = no } }
		is_dialog_only = yes
		response_text = colony.3033.reply
	}
	option = {
		name = colony.3033.c
		trigger = { owner = { is_machine_empire = no } }
		is_dialog_only = yes
		response_text = colony.3033.reply
	}

	option = {
		name = colony.3033.d
		trigger = { owner = { is_machine_empire = no } }
		hidden_effect = {
			remove_modifier = dportal_trade_crisis
		}
	}
	option = {
		name = colony.3033.a.robot
		trigger = { owner = { is_machine_empire = yes } }
		is_dialog_only = yes
		response_text = colony.3033.reply
	}
	option = {
		name = colony.3033.d.robot
		trigger = { owner = { is_machine_empire = yes } }
		hidden_effect = {
			remove_modifier = dportal_trade_crisis
		}
	}
}

#Knight Doom Slayer

planet_event = { #Corrupted Knight
	id = colony.3050
	title = "colony.3050.name"
	desc = "colony.3050.desc"
	picture = GFX_evt_open_revolt
	location = ROOT

	is_triggered_only = yes

	fire_only_once = yes

	option = {
		name = colony.3050.a
		custom_tooltip = portal_closed_tooltip
		custom_tooltip = demonic_armies_tooltip
		hidden_effect = {
			set_planet_flag = dportal_closed
			save_global_event_target_as = demonic_incursion_planet
			create_country = {
				name = "NAME_Demonic_Creatures"
				type = faction
				effect = {
					establish_communications_no_message = root.owner
					save_global_event_target_as = demonic_incursion_armies
				}
			}
			create_army = {
				name = "NAME_Deformed_Creatures"
				owner = last_created_country
				type = "mutant_army"
			}
			create_army = {
				name = "NAME_Twisted_Beasts"
				owner = last_created_country
				type = "mutant_army"
			}
			create_army = {
				name = "NAME_Mutated_Horrors"
				owner = last_created_country
				type = "mutant_army"
				leader = doomslayer_knight
			}
		}
	}
}

# This = country, planet owner
# From = country, attack leader
# FromFrom = planet
country_event = {
	id = colony.3051
	title = "colony.3051.name"
	desc = "colony.3051.desc"
	picture = GFX_evt_open_revolt
	location = ROOT

	is_triggered_only = yes

	trigger = {
		exists = event_target:demonic_incursion_armies
		from = { is_same_empire = event_target:demonic_incursion_armies }
	}

	immediate = {

		# Exile the Corrupted Knight
		event_target:doomslayer_knight@root = {
			exile_leader_as = doomslayer_knight
			save_event_target_as = doomslayer_knight
		}

		# Create the demonic incursion species and country
		create_demon_species_effect = yes
		create_country = {
			name = "NAME_Demon_Incursion"
			adjective = "NAME_Demon_Refugees"
			authority = auth_dictatorial
			ignore_initial_colony_error = yes
			civics = {
				civic = civic_fanatic_purifiers
				civic = civic_scavengers
			}
			species = last_created_species
			ethos = {
				ethic = ethic_fanatic_xenophobe
				ethic = ethic_militarist
			}
			flag = {
				icon = {
					category = "toxoid"
					file = "toxoid_03.dds"
				}
				background = {
					category = "backgrounds"
					file = "flag_BG_24.dds"
				}
				colors = {
					"shadow_purple"
					"black"
					"null"
					"null"
				}
			}
			type = default
			effect = {
				save_global_event_target_as = demonic_incursion_country
				species = {
					save_global_event_target_as = demonic_incursion_species
				}
				establish_communications_no_message = root

				# Corrupted Knight becomes their leader
				set_leader = doomslayer_knight
				event_target:doomslayer_knight@root  = {
					set_skill = 5
					add_trait = trait_ruler_warlike
					remove_trait = leader_trait_butcher
				}

				set_origin = origin_demonic_incursion
				force_add_civic = civic_psionic_sovereign

				##Copy technology
				copy_techs_from = {
					target = root
					except = {
						# Horizon Signal
						tech_akx_worm_1
						tech_akx_worm_2
						tech_akx_worm_3
					}
				}

				##Add resources
				add_resource = { minerals = 10000 }
				add_resource = { energy = 10000 }
				add_resource = { food = 3000 }
				add_resource = { consumer_goods = 3000 }
				add_resource = { alloys = 7000 }
				add_resource = { influence = 1000 }
				add_resource = { unity = 27000 }

				##Create fleets
				set_variable = {
					which = num_demon_fleets
					value = trigger:max_naval_capacity
				}

				divide_variable = {
					which = num_demon_fleets
					value = 90
				}

				ceiling_variable = num_demon_fleets

				while = {
					count = num_demon_fleets
					add_resource = { energy = 1000 } # Give some energy to pay for ship upkeep
					create_fleet = {
						effect = {
							set_owner = event_target:demonic_incursion_country
							create_ship = {
								name = random
								design = "NAME_Ancestral_Glory"
								graphical_culture = "pirate_01"
							}
							while = {
								count = 24
								create_ship = {
									name = random
									design = "NAME_Outrider"
									graphical_culture = "pirate_01"
								}
							}
							while = {
								count = 12
								create_ship = {
									name = random
									design = "NAME_Lancer"
									graphical_culture = "pirate_01"
								}
							}
							while = {
								count = 6
								create_ship = {
									name = random
									design = "NAME_Void_Champion"
									graphical_culture = "pirate_01"
								}
							}
							set_location = {
								target = event_target:demonic_incursion_planet
								distance = 10
								angle = random
							}
						}
					}
				}
			}
		}

		fromfrom = {
			set_owner = event_target:demonic_incursion_country
			set_capital = yes
			while = {
				count = 28
				create_pop = {
					species = event_target:demonic_incursion_species
				}
			}

			# Reformat the planet
			remove_all_districts = yes
			remove_all_buildings = yes
			generate_start_buildings_and_districts = yes
			remove_building = building_commercial_zone
			add_building = building_holo_theatres

			event_target:demonic_incursion_armies = {
				every_owned_army = {
					remove_army = yes
				}
			}

			# Flip control of the solar system
			solar_system = {
				if = {
					limit = { exists = starbase }
					starbase = {
						if = {
							limit = {
								is_owned_by = root
							}
							set_owner = event_target:demonic_incursion_country
							if = {
								limit = { has_starbase_size = starbase_outpost }
								set_starbase_size = starbase_starport
								set_starbase_module = {
									slot = 1
									module = shipyard
								}
								set_starbase_module = {
									slot = 2
									module = shipyard
								}
							}
							else_if = {
								limit = {
									NOT = { has_starbase_module = shipyard }
								}
								set_starbase_module = {
									slot = 1
									module = shipyard
								}
								set_starbase_module = {
									slot = 2
									module = shipyard
								}
							}
						}
					}
				}
				else = {
					create_starbase = {
						size = starbase_starport
						module = shipyard
						module = shipyard
						owner = event_target:demonic_incursion_country
					}
				}
				add_claims = {
					who = root
					show_notification = no
				}
				every_system_planet = {
					limit = {
						is_colony = yes
						NOT = { is_same_value = event_target:demonic_incursion_planet }
						is_owned_by = root
					}
					set_owner = event_target:demonic_incursion_country
				}
				every_fleet_in_system = {
					limit = { is_owned_by = root }
					set_mia = mia_return_home
				}
			}
		}
	}

	option = {
		name = colony.3051.a
		custom_tooltip = demonic_incursion_tooltip
	}

	option = {
		name = colony.3051.b
		custom_tooltip = demonic_takeover_tooltip
		hidden_effect = {
			event_target:demonic_incursion_country = { set_player = root }
		}
	}

	after = {
		hidden_effect = {
			fromfrom = {
				remove_deposit = d_portal_research_zone
			}
		}
	}
}

planet_event = { #Demonic Refugees
	id = colony.3055
	title = "colony.3055.name"
	desc = "colony.3055.desc"
	picture = GFX_evt_cover_blown
	location = ROOT

	is_triggered_only = yes

	option = { #Kill the demons!
		name = colony.3055.a
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 12
				min = @tier3unitymin
				max = @tier3unitymax
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { set_planet_flag = dportal_closed }
	}

	option = { #Welcome the refugees
		name = colony.3055.b
		custom_tooltip = portal_closed_tooltip
		custom_tooltip = demon_refugees_tooltip
		hidden_effect = {
			set_planet_flag = dportal_closed
			owner = {
				create_demon_species_effect = yes
			}
			while = {
				count = 4
				create_pop = {
					species = last_created_species
				}
			}
		}
	}
}

planet_event = { #Quest Complete!
	id = colony.3060
	title = "colony.3060.name"
	desc = "colony.3060.desc"
	picture = GFX_evt_zro_3
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony.3060.a
		hidden_effect = { set_planet_flag = dportal_closed }
		owner = {
			add_modifier = {
				modifier = doomslayer_quest_complete
				days = -1
			}
		}
	}
}


##############################
#
# Colony Events
# by Joachim
#
##############################

planet_event = { # The Lonely Bot welcomes new colonists on the planet
	id = colony.5000
	title = colony.5000.name
	desc = colony.5000.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit
	}

	option = {
		name = colony.5000.a
		add_modifier = {
			modifier = the_lonely_bot_welcome
			years = 10
		}
		hidden_effect = {
			planet_event = {
				id = colony.5005
				days = 3600
				random = 1800
			}
		}
	}
}

planet_event = { # The Lonely Bot's factory is starting to fall apart - Project start event
	id = colony.5005
	title = colony.5005.name
	desc = colony.5005.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit
	}

	option = {
		name = colony.5005.a
		enable_special_project = {
			name = "LONELY_BOT_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

planet_event = { # Failure to restore the Lonely Bot's factory
	id = colony.5006
	title = colony.5006.name
	desc = colony.5006.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit
	}

	option = {
		name = colony.5006.a
		remove_deposit = d_hab_lonely_bot_deposit
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = 3
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
	}
}

planet_event = { # Successfully restores the Lonely Bot's factory
	id = colony.5010
	title = colony.5010.name
	desc = colony.5010.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit
	}

	immediate = {
		hidden_effect = {
			remove_deposit = d_hab_lonely_bot_deposit
			add_deposit = d_hab_lonely_bot_deposit_2
		}
	}

	option = {
		name = colony.5010.a
		custom_tooltip = colony.5010.tt
		owner = {
			add_monthly_resource_mult = {
				resource = alloys
				value = 5
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.5015
				days = 3600
				random = 7200
			}
		}
	}
}

planet_event = { # The missing Lonely Bot - Project start event
	id = colony.5015
	title = colony.5015.name
	desc = colony.5015.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit_2
	}

	option = {
		name = colony.5015.a
		enable_special_project = {
			name = "LONELY_BOT_MISSING_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

planet_event = { # Choosing between Lonely Bot and instant resources
	id = colony.5020
	title = colony.5020.name
	desc = colony.5020.desc
	picture = GFX_evt_alien_ruins

	location = ROOT

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		original_owner = yes
	}

	trigger = {
		owner = { is_ai = no }
		has_deposit = d_hab_lonely_bot_deposit_2
	}

	option = {
		name = colony.5020.a
		hidden_effect = {
			remove_deposit = d_hab_lonely_bot_deposit_2
			add_deposit = d_hab_lonely_bot_deposit_3
		}
		custom_tooltip = colony.5020.tt
	}

	option = {
		name = colony.5020.b
		if = {
			limit = {
				has_deposit = d_hab_lonely_bot_deposit_2
			}
			remove_deposit = d_hab_lonely_bot_deposit_2
		}
		owner = {
			if = {
				limit = {
					NOT = { has_technology = tech_administrative_ai }
					can_research_technology = tech_administrative_ai
				}
				add_research_option = tech_administrative_ai
				add_tech_progress = {
					tech = tech_administrative_ai
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_administrative_ai
					NOT = { has_technology = tech_self_aware_logic }
					can_research_technology = tech_self_aware_logic
				}
				add_research_option = tech_self_aware_logic
				add_tech_progress = {
					tech = tech_self_aware_logic
					progress = 0.5
				}
			}
			else_if = {
				limit = {
					has_technology = tech_self_aware_logic
					NOT = { has_technology = tech_sapient_ai }
					can_research_technology = tech_sapient_ai
				}
				add_research_option = tech_sapient_ai
				add_tech_progress = {
					tech = tech_sapient_ai
					progress = 0.5
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = engineering_research
					value = @tier2researchreward
					min = @tier2researchmin
					max = @tier2researchmax
				}
			}
		}
	}
}


############################
#
# Colony Events
# Written by Douglas Furen
#
############################

### FERAL OVERLOAD
planet_event = {
	id = colony.8001
	title = "colony.8001.name"
	desc = "colony.8001.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_planetary_riot
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			is_ai = no
			NOR = {
				is_gestalt = yes
				has_country_flag = feral_overload_flag
			}
		}
		NOT = { has_planet_flag = colony_event }
		OR = {
			is_planet_class = pc_arid
			is_planet_class = pc_alpine
			is_planet_class = pc_tundra
			is_planet_class = pc_continental
			is_planet_class = pc_ocean
			is_planet_class = pc_tropical

		}
		num_pops > 0
	}

	immediate = {
		owner = {
			set_country_flag = feral_overload_flag
		}
		set_planet_flag = colony_event
	}

	is_triggered_only = yes

	option = {
		name = colony.8001.a
		add_modifier = {
			modifier = feral_overload_00
			days = -1
		}
		hidden_effect = {
			planet_event = { id = colony.8002 days = 40 random = 20 }
		}
	}
}

planet_event = {
	id = colony.8002
	title = "colony.8002.name"
	desc = "colony.8002.desc"
	picture = GFX_evt_colony_settlement
	show_sound = event_planetary_riot
	location = ROOT

	immediate = {
		remove_modifier = feral_overload_00
	}

	is_triggered_only = yes

	option = {
		name = colony.8002.a
		add_modifier = {
 			modifier = feral_overload_01
 			days = -1
 		}
		hidden_effect = {
			planet_event = { id = colony.8003 days = 40 random = 20 }
		}
	}
}

planet_event = {
	id = colony.8003
	title = "colony.8003.name"
	desc = "colony.8003.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	immediate = {
		begin_event_chain = {
			event_chain = "feral_overload_chain"
			target = ROOT
		}
		hidden_effect = {
			if = {
				limit = {
					num_pops > 39
				}
				while = {
					count = 10
					random_owned_pop = {
						kill_pop = yes
					}
				}
			}
			else_if = {
				limit = {
					num_pops > 29
				}
				while = {
					count = 7
					random_owned_pop = {
						kill_pop = yes
					}
				}
			}
			else_if = {
				limit = {
					num_pops > 20
				}
				while = {
					count = 5
					random_owned_pop = {
						kill_pop = yes
					}
				}
			}
			else_if = {
				limit = {
					num_pops > 10
				}
				while = {
					count = 3
					random_owned_pop = {
						kill_pop = yes
					}
				}
			}
			else_if = {
				limit = {
					num_pops > 3
				}
				random_owned_pop = {
					kill_pop = yes
				}
			}
			else = {
			}
		}
		add_planet_devastation = 50
	}

	option = {
		name = colony.8003.a
		enable_special_project = {
			name = "INVESTIGATE_CAVE_SHROOM_PROJECT"
			location = this
			owner = root
		}
	}
}

### Choose how to respond to Cave Shrooms
planet_event = {
	id = colony.8004
	title = "colony.8004.name"
	desc = "colony.8004.desc"
	picture = GFX_evt_gray_goo
	show_sound = event_laboratory_sound
	location = ROOT

	is_triggered_only = yes

	option = {
		name = colony.8004.a
		enable_special_project = {
			name = "UTILIZE_CAVE_SHROOM_PROJECT"
			location = this
			owner = root
		}
	}

	option = {
		name = colony.8004.b
		enable_special_project = {
			name = "EXTERMINATE_CAVE_SHROOM_PROJECT"
			location = this
			owner = root
		}
	}
}

### Special Project: Utilize Cave Shrooms
planet_event = {
	id = colony.8005
	title = "colony.8005.name"
	desc = "colony.8005.desc"
	picture = GFX_evt_animal_wildlife
	show_sound = event_laboratory_sound
	location = ROOT

	is_triggered_only = yes

	immediate = {
		remove_modifier = feral_overload_01
	}

	after = {
		remove_planet_flag = colony_event
	}

	option = {
		name = colony.8005.a
		add_deposit = d_spore_vents
		add_modifier = {
			modifier = feral_overload_02
			days = -1
		}
		owner = { end_event_chain = feral_overload_chain }
	}
}

### Special Project: Exterminate Cave Shrooms
planet_event = {
	id = colony.8006
	title = "colony.8006.name"
	desc = "colony.8006.desc"
	picture = GFX_evt_archaeologists_escaping
	show_sound = event_laboratory_sound
	location = ROOT

	is_triggered_only = yes

	immediate = {
		remove_modifier = feral_overload_01
	}

	after = {
		remove_planet_flag = colony_event
	}

	option = {
		name = colony.8006.a
		add_deposit = d_cave_shroom_veins
		owner = { end_event_chain = feral_overload_chain }
	}
}


############################
#
# Colony Events
# Written by Gemma Thomson
#
############################

namespace = colony_fed

planet_event = {
	id = colony_fed.100
	title = colony_fed.100.name
	desc = colony_fed.100.desc
	picture = GFX_evt_mining_operations
	show_sound = event_construction
	location = root

	is_triggered_only = yes

	trigger = {
		has_owner = yes
		is_homeworld = no
		is_capital = no
		owner = { is_ai = no }
		has_ground_combat = no
		is_occupied_flag = no
		NOR = {
			has_planet_flag = colony_event
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
		}
		NOT = { owner = { has_country_flag = bluelotus } }
		num_pops > 0
		any_owned_pop = {
			OR = {
				has_job = miner
				has_job = mining_drone
			}
		}
	}

	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = bluelotus }
	}

	option = {
		name = CURIOUS
		add_deposit = d_impossiblecorrie
		hidden_effect = {
			planet_event = {
				id = colony_fed.105
				days = 45
			}
		}
	}
}

planet_event = {
	id = colony_fed.105
	title = colony_fed.105.name
	desc = {
		trigger = {
			owner = { is_gestalt = no }
		}
		text = colony_fed.105.desc
	}
	desc = {
		trigger = {
			owner = { is_gestalt = yes }
		}
		text = colony_fed.105.gestalt.desc
	}
	picture = GFX_evt_strategic_resources
	show_sound = event_construction
	location = root

	is_triggered_only = yes

	option = { #Gestalt embrace option
		name = colony_fed.105.a
		trigger = {
			owner = { is_gestalt = yes }
		}
		add_deposit = d_bluelotus
		hidden_effect = {
			planet_event = {
				id = colony_fed.110
				days = 40
			}
		}
	}

	option = { #Embrace option
		name = colony_fed.105.b
		trigger = {
			owner = { is_gestalt = no }
		}
		owner = { add_resource = { energy = -420 } }
		add_deposit = d_bluelotus
		hidden_effect = {
			planet_event = {
				id = colony_fed.110
				days = 55
			}
		}
	}

	option = { #Cease
		name = colony_fed.105.c
		trigger = {
			owner = { is_gestalt = no }
		}
		hidden_effect = {
			planet_event = {
				id = colony_fed.106
				days = 40
			}
		}
	}

	option = { #Gestalt purge
		name = colony_fed.105.d
		trigger = {
			owner = { is_gestalt = yes }
		}
		random_owned_pop = {
			limit = { has_job = alloy_drone }
			kill_pop = yes
		}
		hidden_effect = {
			planet_event = {
				id = colony_fed.107
				days = 50
			}
		}
	}
}

#The facility is disrupted, leaving only a small amount of alloys
planet_event = {
	id = colony_fed.106
	title = colony_fed.106.name
	desc = colony_fed.106.desc
	picture = GFX_evt_gray_goo
	show_sound = event_structural_collapse
	location = root

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
		remove_deposit = d_bluelotus #Also removes job
		owner = {
			# add_resource = { alloys = 150 }
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier1materialreward
				min = @tier1materialmin
				max = @tier1materialmax
			}
		}
	}
}

#The rogue drone is purged, ending the project
planet_event = {
	id = colony_fed.107
	title = colony_fed.107.name
	desc = colony_fed.107.desc
	picture = GFX_evt_gray_goo
	show_sound = event_structural_collapse
	location = root

	is_triggered_only = yes

	option = {
		name = GOOD
		remove_deposit = d_bluelotus #Also removes job
		owner = {
			add_resource = { alloys = 150 }
		}
	}
}

#A special project is created in order to scale-up the lab's production
planet_event = {
	id = colony_fed.110
	title = colony_fed.110.name
	desc = {
		trigger = {
			owner = { is_gestalt = no }
		}
		text = colony_fed.110.desc
	}
	desc = {
		trigger = {
			owner = { is_gestalt = yes }
		}
		text = colony_fed.110.gestalt.desc
	}
	picture = GFX_evt_strategic_resources
	show_sound = event_default
	location = root

	is_triggered_only = yes

	option = {
		name = OK
		enable_special_project = {
			name = "BLUELOTUS_SCALE_PROJECT"
			location = this
			owner = root.owner
		}
	}
}

#The special project fails, causing a small collapse
planet_event = {
	id = colony_fed.111
	title = colony_fed.111.name
	desc = colony_fed.111.desc
	picture = GFX_evt_debris
	show_sound = event_structural_collapse
	location = root

	is_triggered_only = yes

	option = {
		name = colony_fed.111.a
		add_deposit = d_ruin_bluelotus
	}
}

#The lab is reformed, and starts improving alloy production empire-wide
planet_event = {
	id = colony_fed.115
	title = colony_fed.115.name
	desc = colony_fed.115.desc
	picture = GFX_evt_strategic_resources
	show_sound = event_laboratory_sound
	location = root

	is_triggered_only = yes

	option = {
		name = colony_fed.115.a
		remove_deposit = d_bluelotus
		add_deposit = d_bluelotus2
		hidden_effect = {
			planet_event = {
				id = colony_fed.120
				days = 220
				random = 60
			}
		}
	}
	option = {
		name = colony_fed.115.b
		remove_deposit = d_bluelotus
		add_deposit = d_bluelotus2
		hidden_effect = {
			planet_event = {
				id = colony_fed.120
				days = 420
				random = 60
			}
		}
	}
}

#The lab converts itself and its surroundings into a vast alloy deposit
planet_event = {
	id = colony_fed.120
	title = colony_fed.120.name
	desc = colony_fed.120.desc
	picture = GFX_evt_gray_goo
	show_sound = event_super_explosion
	location = root

	is_triggered_only = yes

	immediate = {
		random_owned_pop = {
			limit = { has_job = bluelotus_technician }
			kill_pop = yes
		}
	}

	option = {
		name = UNFORTUNATE
		remove_deposit = d_bluelotus2
		remove_deposit = d_impossiblecorrie
		add_deposit = d_crater_bluelotus
	}
}

### Nemma by Victor Haeggman

#Nemma World
planet_event = {
	id = colony.9000
	title = "colony.9000.name"
	desc = "colony.9000.desc"
	picture = GFX_evt_continental
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		num_pops > 0
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_ocean
		}
		NOR = {
			any_country = { has_country_flag = turtle_world_spawned }
			has_planet_flag = colony_event
		}
	}

	immediate = {
		set_planet_flag = turtle_world_colony
		set_planet_flag = colony_event
		owner = { set_country_flag = turtle_world_spawned }
	}

	option = {
		name = {
			trigger = {
				owner = { NOT = { species_portrait = rep14 } }
			}
			text = "colony.9000.a"
		}
		name = {
			trigger = {
				owner = { species_portrait = rep14 }
			}
			text = "colony.9000.a.turtle"
		}

		add_modifier = {
			modifier = "turtle_world_modifier"
			days = -1
		}
		hidden_effect = {
			planet_event = {
				id = colony.9005 days = 700 random = 30
			}
		}
	}
}

planet_event = {
	id = colony.9005
	title = "colony.9005.name"
	desc = {
		trigger = { owner = { is_gestalt = no } }
		text = "colony.9005.desc"
	}
	desc = {
		trigger = { owner = { is_gestalt = yes } }
		text = "colony.9005.desc.gestalt"
	}
	picture = GFX_evt_unspeakable_horror
	show_sound = event_space_amoeba
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {#Yes investigate the Nemmas
		name = colony.9005.a
		enable_special_project = {
			name = "study_turtle_world_project"
			location = this
			owner = root
		}
	}
	option = {#Leave the Nemmas alone
		name = {
			trigger = { owner = { is_gestalt = no } }
			text = "colony.9005.b"
		}
		name = {
			trigger = { owner = { is_gestalt = yes } }
			text = "colony.9005.b.gestalt"
		}
		remove_modifier = "turtle_world_modifier"
		add_modifier = {
			modifier = "turtle_world_modifier_alone"
			days = -1
		}
	}
}

planet_event = {
	id = colony.9010
	title = "colony.9010.name"
	desc = "colony.9010.desc"
	picture = GFX_evt_board_meeting
	show_sound = event_administrative_work
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = colony.9010.a
		trigger = {
			owner = {
				NOR = {
					is_xenophobe = yes
					is_homicidal = yes
					AND = {
						is_machine_empire = yes
						NOT = { has_civic = civic_machine_servitor }
					}
				}

			}
		}
		enable_special_project = {
			name = "breed_turtle_world_project"
			location = this
			owner = root
		}
	}

	option = {
		name = colony.9010.b
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
					has_civic = civic_hive_empath
					AND = {
						is_machine_empire = yes
						NOT = { has_civic = civic_machine_assimilator }
					}
				}
			}
		}
		enable_special_project = {
			name = "enslave_turtle_world_project"
			location = this
			owner = root
		}
	}
	option = {
		name = colony.9010.c
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_xenophile
					has_civic = civic_hive_empath
					has_civic = civic_machine_servitor
				}
			}
		}
		enable_special_project = {
			name = "mine_turtle_world_project"
			location = this
			owner = root
		}
	}
	option = {
		name = colony.9010.d
		trigger = {
			owner = { is_homicidal = yes }
		}
		enable_special_project = {
			name = "kill_turtle_world_project"
			location = this
			owner = root
		}
	}
}

#Commence the Nemma breeding!
planet_event = {
	id = colony.9015
	title = "colony.9015.name"
	desc = "colony.9015.desc"
	picture = GFX_evt_alien_planet
	show_sound = event_default
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	immediate = {
		set_variable = {
			which = turtle_amount
			value = 0
		}
	}

	option = {
		name = colony.9015.a
		hidden_effect = {
			planet_event = {
				id = colony.9020 days = 3600 random = 100
			}
		}
	}
}

#Successful breeding!
planet_event = {
	id = colony.9020
	title = "colony.9020.name"
	desc = {
		trigger = {
			check_variable = {
				which = turtle_amount
				value = 5
			}
		}
		text = "colony.9020.desc.full"
	}
	desc = {
		trigger = {
			check_variable = {
				which = turtle_amount
				value < 5
			}
		}
		text = "colony.9020.desc"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	immediate = {
		add_deposit = d_house_turtle
		change_variable = {
			which = turtle_amount
			value = 1
		}
	}

	option = {
		name = colony.9020.a
		trigger = {
			check_variable = {
				which = turtle_amount
				value < 6
			}
		}
		hidden_effect = {
			random_list = {
				2 = {
					planet_event = {
						id = colony.9020 days = 3600 random = 100
					}
				}

				1 = {
					planet_event = {
						id = colony.9025 days = 3600 random = 100
					}
					modifier = {
						factor = turtle_amount
						is_variable_set = turtle_amount
					}
				}
			}
		}
	}
	option = {
		name = {
			trigger = { owner = { is_gestalt = no } }
			text = "colony.9020.b"
		}
		name = {
			trigger = { owner = { is_gestalt = yes } }
			text = "colony.9020.b.gestalt"
		}
		trigger = {
			check_variable = {
				which = turtle_amount
				value = 6
			}
		}

	}
}

#Failed breeding!
planet_event = {
	id = colony.9025
	title = "colony.9025.name"
	desc = "colony.9025.desc"
	picture = GFX_evt_clocks
	show_sound = event_laboratory_sound
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = colony.9025.a
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		hidden_effect = {
			random_list = {
				3 = {
					planet_event = {
						id = colony.9020 days = 3600 random = 100
					}
					change_variable = {
						which = turtle_amount
						value = 1
					}
				}
				1 = {
					planet_event = {
						id = colony.9025 days = 3600 random = 100
					}
					modifier = {
						factor = turtle_amount
						is_variable_set = turtle_amount
					}
				}
			}
		}
	}
}

#Commence the Nemma enslavement!
planet_event = {
	id = colony.9030
	title = "colony.9030.name"
	desc = "colony.9030.desc"
	picture = GFX_evt_genetic_modification
	show_sound = event_laboratory_sound
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = colony.9030.a
		add_modifier = {
			modifier = "turtle_world_slaves_modifier"
			days = -1
		}
		hidden_effect = {
			remove_modifier = "turtle_world_modifier"
			if = {
				limit = {
					owner = {
						NOR = {
							is_gestalt = yes
							has_ethic = ethic_authoritarian
							has_ethic = ethic_fanatic_authoritarian
						}
					}
				}
				planet_event = {
					id = colony.9035 days = 1000 random = 50
				}
			}
		}
	}
}

#Free the Nemma!
planet_event = {
	id = colony.9035
	title = "colony.9035.name"
	desc = "colony.9035.desc"
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = colony.9035.a
		remove_modifier = turtle_world_slaves_modifier
		add_modifier = {
			modifier = "turtle_world_modifier"
			days = -1
		}
		hidden_effect = {
			planet_event = {
				id = colony.9015 days = 2000 random = 100
			}
		}
	}
	option = {
		name = colony.9035.b
		add_modifier = {
			modifier = "embraced_turtle_slavery_modifier"
			days = -1
		}
	}
}

#Commence the Nemma mining!
planet_event = {
	id = colony.9040
	title = "colony.9040.name"
	desc = "colony.9040.desc"
	picture = GFX_evt_drilling_for_gas
	show_sound = event_construction
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = EXCELLENT
		add_deposit = d_turtle_miner
	}
}

#Commence the eating of the dead Nemma!
planet_event = {
	id = colony.9045
	title = "colony.9045.name"
	desc = "colony.9045.desc"
	picture = GFX_evt_ocean
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	immediate = {
		owner = {
			add_resource = { minerals = 3000 }
			add_resource = { food = 3000 }
		}
	}

	option = {
		exclusive_trigger = {
			owner = { has_civic = civic_hive_devouring_swarm }
		}
		name = PREY
	}
	option = {
		exclusive_trigger = {
			owner = { has_civic = civic_machine_terminator }
		}
		name = E_DOW_PROPOSE_03
	}
	option = {
		name = colony.9045.a
		remove_modifier = "turtle_world_modifier"
		add_deposit = d_turtle_corpse
	}
}

############################
#
# Colony Events: "Insidious Ophidians"
#
# Designed by Brian Campbell
#
############################

planet_event = {
	id = colony.8099
	title = colony.8099.name
	desc = colony.8099.desc
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		has_ground_combat = no
		is_capital = no
	}

	trigger = {
		habitable_planet = yes
		owner = {
			is_ai = no
			NOR = {
				is_gestalt = yes
				has_country_flag = snake_infestation_fired
			}
		}
		NOR = {
			has_planet_flag = colony_event
			has_planet_flag = snake_infestation_fired
		}
		num_pops > 0
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = snake_infestation_fired
		set_planet_flag = colony_event
		owner = { set_country_flag = snake_infestation_fired }
	}

	option = {
		name = colony.8099.a
		hidden_effect = {
			planet_event = { id = colony.9100 days = 200 random = 200 }
		}
	}
}

planet_event = {
	id = colony.9100
	title = colony.9100.name
	desc = colony.9100.desc
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = colony.9100.a
		enable_special_project = {
			name = SNEK_SCIENCE_PROJECT
			location = this
			owner = root.owner
		}
	}

	option = {
		name = colony.9100.b
		enable_special_project = {
			name = SNEK_WAR_PROJECT
			location = this
			owner = root.owner
		}
	}
}

planet_event = {
	id = colony.9101
	title = "PROJECT_COMPLETE"
	desc = "colony.9101.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = UNDERSTOOD
		add_modifier = {
			modifier = energy_poor
			months = 120
		}
		hidden_effect = {
			planet_event = { id = colony.9103 days = 200 random = 200 }
		}
	}
}

planet_event = {
	id = colony.9102
	title = "PROJECT_COMPLETE"
	desc = "colony.9102.desc"
	picture = GFX_evt_alien_planet
	show_sound = event_alien_nature
	location = ROOT

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = UNDERSTOOD
		add_modifier = {
			modifier = snake_infestation
			days = 200
		}
		hidden_effect = {
			planet_event = { id = colony.9103 days = 200 random = 200 }
		}
	}
}

planet_event = {
	id = colony.9103
	title = colony.9103.name
	desc = {
		trigger = { has_planet_flag = snake_peace }
		text = "colony.9103.desc.science"
	}
	desc = {
		trigger = { has_planet_flag = snake_war }
		text = "colony.9103.desc.soldier"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_air_raid_siren
	location = ROOT

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = colony.9103.a
		add_modifier = {
			modifier = energy_poor
			days = 200
		}
		hidden_effect = {
			planet_event = { id = colony.9104 days = 200 random = 200 }
		}
	}

	option = {
		name = colony.9103.b
		if = {
			limit = {
				has_modifier = snake_infestation
			}
			remove_modifier = snake_infestation
		}
		add_modifier = {
			modifier = snake_infestation
			days = 200
		}
		hidden_effect = {
			planet_event = { id = colony.9104 days = 200 random = 200 }
		}
	}
}

planet_event = {
	id = colony.9104
	title = colony.9104.name
	desc = {
		trigger = { has_planet_flag = snake_peace }
		text = "colony.9104.desc.science"
	}
	desc = {
		trigger = { has_planet_flag = snake_war }
		text = "colony.9104.desc.soldier"
    }
	picture = GFX_evt_alien_nature
	show_sound = event_swarm
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	trigger = {
		original_owner = yes
		num_pops > 0
	}

	option = {
		name = colony.9104.a
		add_modifier = {
			modifier = "mining_equipment_offline"
			days = 240
		}
		hidden_effect = {
			planet_event = { id = colony.9106 days = 200 random = 200 }
		}
	}

	option = {
		name = colony.9104.b
		if = {
			limit = {
				has_modifier = snake_infestation
			}
			remove_modifier = snake_infestation
		}
		add_modifier = {
			modifier = snake_infestation
			days = 200
		}
		hidden_effect = {
			planet_event = { id = colony.9106 days = 200 random = 200 }
		}
	}
}

planet_event = {
	id = colony.9106
	title = colony.9106.name
	desc = {
		trigger = { has_planet_flag = snake_war }
		text = "colony.9106.desc"
	}
	desc = colony.9106.desc
    desc = {
		trigger = { has_planet_flag = snake_peace }
		text = "colony.9106.desc.science"
	}
	picture = GFX_evt_alien_nature
	show_sound = event_swarm
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	trigger = {
    	original_owner = yes
    }

	option = {
		name = colony.9106.a
		# custom_tooltip = colony.9016.a.tooltip
		owner = {
			add_monthly_resource_mult = {
			resource = minerals
			value = @tier1materialreward
			min = @tier1materialmin
			max = @tier1materialmax
		}
	}
	hidden_effect = {
		planet_event = {
			id = colony.9107
			days = 200
			random = 200
			}
		}
	}
}

planet_event = {
	id = colony.9107
	title = colony.9107.name
	desc = colony.9107.desc
	picture = GFX_evt_alien_nature
	show_sound = event_swarm
	location = ROOT
	trackable = yes

	trigger = {
    	original_owner = yes
	}

	is_triggered_only = yes

    immediate = {
    }

	option = {
		name = colony.9107.a
		custom_tooltip = colony.9107.a.tooltip
		hidden_effect = {
			planet_event = { id = colony.9108 days = 40	random = 20 }
		}
	}

	option = {
		name = colony.9107.b
		custom_tooltip = colony.9107.b.tooltip
		hidden_effect = {
			planet_event = { id = colony.9109 days = 40	random = 20	}
		}
	}
}

planet_event = {
	id = colony.9108
	title = colony.9108.name
	desc = colony.9108.desc
	picture = GFX_evt_alien_nature
	show_sound = event_swarm
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = colony.9108.a
		if = {
			limit = {
				has_modifier = "mining_equipment_offline"
			}
			remove_modifier = "mining_equipment_offline"
		}
		if = {
			limit = {
				has_modifier = snake_infestation
			}
			remove_modifier = snake_infestation
		}
	}
}

planet_event = {
	id = colony.9109
	title = colony.9109.name
	desc = colony.9109.desc
	picture = GFX_evt_alien_nature
	show_sound = event_swarm
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	trigger = {
		original_owner = yes
	}

	option = {
		name = colony.9109.a
		if = {
			limit = {
				has_modifier = energy_poor
			}
			remove_modifier = energy_poor
		}
		if = {
			limit = {
				has_modifier = snake_infestation
			}
			remove_modifier = snake_infestation
		}
	}
}

### Greed is Bad by Hadrien Buytaers

#We found more minerals
planet_event = {
	id = colony.9050
	title = "colony.9050.name"
	desc = "colony.9050.desc"
	picture = GFX_evt_mining_operations
	show_sound = event_scanner
	location = ROOT
	trackable = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		habitable_planet = yes
		NOR = {
			has_global_flag = crystal_colony
			has_planet_flag = colony_event
			has_modifier = mineral_rich
			has_modifier = ultra_rich
			has_modifier = mineral_poor
		}
	}

	is_triggered_only = yes

	immediate = {
		set_global_flag = crystal_colony
		set_planet_flag = colony_event
	}
	#Opt: Start digging
	option = {
		name = colony.9050.a
		add_deposit = d_ore_rich_caverns
	}
	#Opt: Probe for more
	option = {
		name = colony.9050.b
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1000 }
			}
		}
		owner = {
			add_resource = { energy = -1000 }
		}
		hidden_effect = {
			planet_event = {
				id = colony.9055 days = 90 random = 20
			}
		}
	}
}

#Deep Veins
planet_event = {
	id = colony.9055
	title = "colony.9055.name"
	desc = "colony.9055.desc"
	picture = GFX_evt_mining_operations
	show_sound = event_scanner
	location = ROOT

	is_triggered_only = yes
	#Opt: Start Digging
	option = {
		name = colony.9055.a
		add_modifier = {
			modifier = mineral_rich
			days = -1
		}
	}
	#Opt: More? (non subterranean)
	option = {
		name = colony.9055.b
		trigger = {
			owner = {
				NOT = { has_origin = origin_subterranean }
			}
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1500 }
			}
		}
		owner = {
			add_resource = { energy = -1500 }
		}
		hidden_effect = {
			planet_event = {
				id = colony.9060 days = 120 random = 20
			}
		}
	}
	#Opt: Keep probing (subterranean)
	option = {
		name = colony.9055.b
		trigger = {
			owner = {
				has_origin = origin_subterranean
			}
		}
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 1500 }
			}
		}
		owner = {
			add_resource = { energy = -1500 }
		}
		hidden_effect = {
			planet_event = {
				id = colony.9065 days = 90 random = 20
			}
		}
	}
}

#Too Deep For Us
planet_event = {
	id = colony.9060
	title = "colony.9060.name"
	desc = "colony.9060.desc"
	picture = GFX_evt_mining_operations
	show_sound = event_drilling
	location = ROOT

	is_triggered_only = yes
	#Opt: Start Digging
	option = {
		name = colony.9060.a
		add_deposit = d_ore_rich_caverns
		add_modifier = {
			modifier = ultra_rich
			days = -1
		}
	}
}

#More Ore
planet_event = {
	id = colony.9065
	title = "colony.9065.name"
	desc = "colony.9065.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_drilling
	location = ROOT

	is_triggered_only = yes
	#Opt: Start Digging
	option = {
		name = colony.9065.a
		add_deposit = d_ore_rich_caverns
		add_modifier = {
			modifier = mineral_rich
			days = -1
		}
	}
	#Opt: More?!
	option = {
		name = colony.9065.b
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 2000 }
			}
		}
		owner = {
			add_resource = { energy = -2000 }
		}
		hidden_effect = {
			planet_event = {
				id = colony.9070 days = 90 random = 20
			}
		}
	}
}

#Fiery Crystals
planet_event = {
	id = colony.9070
	title = "colony.9070.name"
	desc = "colony.9070.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_drilling
	location = ROOT

	is_triggered_only = yes
	#Opt: Start Digging
	option = {
		name = colony.9070.a
		add_deposit = d_crystalline_caverns
		add_modifier = {
			modifier = ultra_rich
			days = -1
		}
		hidden_effect = {
			planet_event = {
				id = colony.9085 days = 3000 random = 600
			}
		}
	}
	#Opt: MORE?!
	option = {
		name = colony.9070.b
		allow = {
			owner = {
				resource_stockpile_compare = { resource = energy value >= 2500 }
			}
		}
		owner = {
			add_resource = { energy = -2500 }
		}
		hidden_effect = {
			planet_event = {
				id = colony.9075 days = 90 random = 20
			}
		}
	}
}

#TOO MANY CRYSTALS
planet_event = {
	id = colony.9075
	title = "colony.9075.name"
	desc = {
		trigger = {
			owner = { has_modifier = pacified_crystals }
		}
		text = colony.9075.desc.a
	}
	desc = "colony.9075.desc.b"
	picture = GFX_evt_crystal_kraken
	show_sound = evn_ove_crystal_kraken
	location = ROOT

	is_triggered_only = yes
	#Opt: We dug too deep
	option = {
		name = BATTLESTATIONS
		add_deposit = d_ore_rich_caverns
		add_deposit = d_crystalline_caverns
		add_deposit = d_crystalline_caverns
		add_modifier = {
			modifier = ultra_rich
			days = -1
		}
		#Spawn Crystal Kraken
		hidden_effect = {
			root = {
				save_global_event_target_as = crystal_kraken_planet
			}
			create_country = {
				name = "NAME_Crystal_Kraken"
				type = faction
				flag = {
					icon = {
						category = "special"
						file = "unknown.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"light_orange"
						"light_orange"
						"null"
						"null"
					}
				}
				effect = {
					establish_communications_no_message = root.owner
					save_global_event_target_as = crystal_kraken
				}
			}
		}
		create_army = {
			name = "NAME_Crystal_Kraken"
			owner = event_target:crystal_kraken
			type = "crystal_kraken_army"
		}
	}
}

#Crystal Kraken Defeat trigger
country_event = {
	id = colony.9080
	location = ROOT

	hide_window = yes

	is_triggered_only = yes

	trigger = {
		From = { army_type = crystal_kraken_army }
	}

	immediate = {
		fromfrom = {
			country_event = {
				id = colony.9081 days = 1
			}
			if = {
				limit = {
					has_origin = origin_subterranean
				}
				set_country_flag = underlord_achievement
			}
		}
	}
}

#Crystal Kraken Defeated
country_event = {
	id = colony.9081
	title = "colony.9080.name"
	desc = "colony.9080.desc"
	picture = GFX_evt_victorious_army
	show_sound = event_celebration
	location = ROOT

	is_triggered_only = yes

	#Opt: Victory!
	option = {
		name = colony.9080.a
		event_target:crystal_kraken_planet = {
			add_deposit = d_crystal_kraken_body
			hidden_effect = {
				remove_modifier = "crystal_kraken"
				every_owned_pop = {
					remove_pop_flag = event_purge
				}
			}
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 120
				min = 240
				max = 99999
			}
		}
	}
}

# This = country
# From = army
#Crystal Kraken destroyed by other means
country_event = {
	id = colony.9082
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		from = { army_type = crystal_kraken_army }
	}

	immediate = {
		from.planet = {
			add_deposit = d_crystal_kraken_body_bombed
			hidden_effect = {
				remove_modifier = "crystal_kraken"
				every_owned_pop = {
					remove_pop_flag = event_purge
				}
			}
		}
	}
}

#Too Deep?
planet_event = {
	id = colony.9085
	title = "colony.9085.name"
	desc = "colony.9085.desc"
	picture = GFX_evt_in_the_dark
	show_sound = event_drilling
	location = ROOT

	is_triggered_only = yes
	#Opt: It's fine
	option = {
		name = colony.9085.a
		hidden_effect = {
			planet_event = {
				id = colony.9090 days = 1000 random = 200
			}
		}
	}
	#Opt: Restrict Digging Operations
	option = {
		name = colony.9085.b
		remove_modifier = ultra_rich
		remove_deposit = d_crystalline_caverns
	}
}

#RELEASE THE CRYSTAL KRAKEN
planet_event = {
	id = colony.9090
	title = "colony.9075.name"
	desc = {
		trigger = {
			owner = { has_modifier = pacified_crystals }
		}
		text = colony.9075.desc.a
	}
	desc = "colony.9075.desc.b"
	picture = GFX_evt_crystal_kraken
	show_sound = evn_ove_crystal_kraken
	location = ROOT

	is_triggered_only = yes
	#Opt: We did dig too deep
	option = {
		name = BATTLESTATIONS
		#Spawn Crystal Kraken
		hidden_effect = {
			create_country = {
				name = "NAME_Crystal_Kraken"
				type = faction
				flag = {
					icon = {
						category = "special"
						file = "unknown.dds"
					}
					background = {
						category = "backgrounds"
						file = "00_solid.dds"
					}
					colors = {
						"light_orange"
						"light_orange"
						"null"
						"null"
					}
				}
				effect = {
					establish_communications_no_message = root.owner
					save_global_event_target_as = crystal_kraken
				}
			}
		}
		create_army = {
			name = "NAME_Crystal_Kraken"
			owner = event_target:crystal_kraken
			type = "crystal_kraken_army"
		}
	}
}

#Kraken destroys colony
planet_event = {
	id = colony.9095
	location = ROOT

	hide_window = yes

	is_triggered_only = yes

	trigger = {
		exists = event_target:crystal_kraken
		FromFrom = { is_same_empire = event_target:crystal_kraken }
	}

	immediate = {
		while = {
			limit = {
				num_pops > 1
			}
			random_owned_pop = {
				kill_pop = yes
			}
		}
		add_modifier = {
			modifier = "crystal_kraken"
			days = -1
		}
		FromFrom = {
			set_policy = {
				policy = purge
				option = purge_not_allowed
			}
			set_policy = {
				policy = population_controls
				option = population_controls_not_allowed
			}
		}
	}
}

############################
#
#
#
# Colony Event: "Ancient Manufactorium"
#
#
#
############################

planet_event = { # starting event - finding the ancient vaults
	id = colony.9200
	title = "colony.9200.name"
	desc = "colony.9200.desc"
	picture = GFX_evt_discovered_hidden_door
	show_sound = event_wind_ruins
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		habitable_planet = yes
		NOR = {
			owner = { has_country_flag = ancient_manufactorium }
			has_planet_flag = colony_event
			is_planet_class = pc_habitat
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_shattered_ring_habitable
		}
	}

	is_triggered_only = yes

	immediate = {
		set_planet_flag = colony_event
		owner = { set_country_flag = ancient_manufactorium }
	}

	option = { # find your way into the vault
		name = colony.9200.a
		custom_tooltip = colony.9200.a.desc
		hidden_effect = {
			planet_event = {
				id = colony.9201
				days = 30
				random = 30
			}
		}
	}
}

planet_event = { # entry result
	id = colony.9201
	title = "colony.9201.name"
	desc = "colony.9201.desc"
	picture = GFX_evt_hidden_door
	show_sound = event_wind_ruins
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9201.a
		custom_tooltip = colony.9201.a.desc
		add_deposit = d_ancient_manufactorium_vaultexploration
		hidden_effect = {
			planet_event = {
				id = colony.9210
				days = 180
				random = 360
			}
		}
	}
	option = { # opt out
		name = colony.9201.b
		custom_tooltip = colony.9201.b.desc
		remove_deposit = d_ancient_manufactorium_vaultexploration
		hidden_effect = {
			planet_event = {
				id = colony.9202
				days = 60
				random = 60
			}
		}
	}
}

planet_event = { # opting out - explosion, add crater
	id = colony.9202
	title = "colony.9202.name"
	desc = "colony.9202.desc"
	picture = GFX_evt_nuclear_explosion
	show_sound = event_ship_explosion
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # add weak deposit - end the chain
		name = colony.9202.a
		add_deposit = d_ancient_manufactorium_crater
	}
}

planet_event = { # first problem - pop death potential
	id = colony.9210
	title = "colony.9210.name"
	desc = "colony.9210.desc"
	picture = GFX_evt_engineering_bay
	show_sound = event_screams
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual
		name = colony.9210.a
		custom_tooltip = colony.9210.a.desc
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9211
				days = 180
				random = 360
			}
		}
	}
	option = { # egalitarian
		name = colony.9210.b
		custom_tooltip = colony.9210.b.desc
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
				}
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9212
				days = 120
				random = 180
			}
		}
	}
	option = { # authoritarian
		name = colony.9210.c
		custom_tooltip = colony.9210.c.desc
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_authoritarian
					has_ethic = ethic_fanatic_authoritarian
				}
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9213
				days = 120
				random = 180
			}
		}
	}
	option = { # gestalt - pop dies
		name = colony.9210.d
		custom_tooltip = colony.9210.d.desc
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9214
				days = 100
				random = 100
			}
		}
	}
}

planet_event = { # first problem - casual result - pop died, bad modifier
	id = colony.9211
	title = "colony.9211.name"
	desc = "colony.9211.desc"
	picture = GFX_evt_emergency_workers
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9211.a
		random_owned_pop = {
			kill_pop = yes
		}
		owner = {
			add_modifier = {
				modifier = media_coverage_negative_medium
				days = 360
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9220
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # first problem - egalitarian result - pop rescued, bad modifier
	id = colony.9212
	title = "colony.9212.name"
	desc = "colony.9212.desc"
	picture = GFX_evt_emergency_workers
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9212.a
		owner = {
			add_modifier = {
				modifier = media_coverage_negative_low
				days = 360
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9220
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # first problem - authoritarian result - pop died, no modifier
	id = colony.9213
	title = "colony.9213.name"
	desc = "colony.9213.desc"
	picture = GFX_evt_emergency_workers
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9213.a
		random_owned_pop = {
			kill_pop = yes
		}
		hidden_effect = {
			planet_event = {
				id = colony.9220
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # first problem - gestalt result - pop died, no modifier
	id = colony.9214
	title = "colony.9214.name"
	desc = "colony.9214.desc"
	picture = GFX_evt_emergency_workers
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9214.a
		random_owned_pop = {
			kill_pop = yes
		}
		hidden_effect = {
			planet_event = {
				id = colony.9220
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # first opportunity - might add unity to the pop job
	id = colony.9220
	title = "colony.9220.name"
	desc = "colony.9220.desc"
	picture = GFX_evt_ancient_records
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual - opportunity wasted
		name = colony.9220.a
		custom_tooltip = colony.9220.a.desc
		hidden_effect = {
			planet_event = {
				id = colony.9230
				days = 360
				random = 360
			}
		}
	}
	option = { # masterful crafters + unity output
		name = colony.9220.b
		custom_tooltip = colony.9220.b.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_corporate_crafters
					has_civic = civic_crafters
				}
			}
		}
		set_planet_flag = manufactorium_crafters
		hidden_effect = {
			planet_event = {
				id = colony.9230
				days = 360
				random = 360
			}
		}
	}
	option = { # subterranean + unity output
		name = colony.9220.c
		custom_tooltip = colony.9220.c.desc
		trigger = {
			owner = {
				has_origin = origin_subterranean
			}
		}
		set_planet_flag = manufactorium_subterranean
		hidden_effect = {
			planet_event = {
				id = colony.9230
				days = 360
				random = 360
			}
		}
	}
	option = { # subterranean AND masterful crafters + unity output
		name = colony.9220.d
		custom_tooltip = colony.9220.d.desc
		trigger = {
			owner = {
				OR = {
					AND = {
						has_civic = civic_crafters
						has_origin = origin_subterranean
					}
					AND = {
						has_civic = civic_corporate_crafters
						has_origin = origin_subterranean
					}
				}
			}
		}
		set_planet_flag = manufactorium_dwarven_craft
		hidden_effect = {
			planet_event = {
				id = colony.9230
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # second problem - earthquake - more upkeep or less production in the end of the chain
	id = colony.9230
	title = "colony.9230.name"
	desc = "colony.9230.desc"
	picture = GFX_evt_collapsing_roof
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual1 - more upkeep
		name = colony.9230.a
		set_planet_flag = manufactorium_earthquake_upkeep
		hidden_effect = {
			planet_event = {
				id = colony.9231
				days = 36
				random = 36
			}
		}
	}
	option = { # casual2 - produce less
		name = colony.9230.b
		set_planet_flag = manufactorium_earthquake_production
		hidden_effect = {
			planet_event = {
				id = colony.9232
				days = 36
				random = 36
			}
		}
	}
	option = { # managed to maintain everything intactc - bad thing averted
		name = colony.9230.c
		trigger = {
			owner = {
				OR = {
					has_civic = civic_functional_architecture
					has_civic = civic_machine_builder
				}
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9233
				days = 36
				random = 36
			}
		}
	}
	option = { # managed to maintain everything intactc - bad thing averted
		name = colony.9230.d
		trigger = {
			owner = {
				has_civic = civic_hive_divided_attention
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9234
				days = 36
				random = 36
			}
		}
	}
}

planet_event = { # second problem - eatherquake - more upkeep
	id = colony.9231
	title = "colony.9231.name"
	desc = "colony.9231.desc"
	picture = GFX_evt_collapsing_roof
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9231.a
		hidden_effect = {
			planet_event = {
				id = colony.9240
				days = 720
				random = 360
			}
		}
	}
}

planet_event = { # second problem - eatherquake - less produce
	id = colony.9232
	title = "colony.9232.name"
	desc = "colony.9232.desc"
	picture = GFX_evt_collapsing_roof
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9232.a
		hidden_effect = {
			planet_event = {
				id = colony.9240
				days = 720
				random = 360
			}
		}
	}
}

planet_event = { # second problem - eatherquake (building civics) - bad outcome averted
	id = colony.9233
	title = "colony.9233.name"
	desc = "colony.9233.desc"
	picture = GFX_evt_collapsing_roof
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9233.a
		hidden_effect = {
			planet_event = {
				id = colony.9240
				days = 720
				random = 360
			}
		}
	}
}

planet_event = { # second problem - eatherquake (divided attention civic) - bad outcome averted
	id = colony.9234
	title = "colony.9234.name"
	desc = "colony.9234.desc"
	picture = GFX_evt_collapsing_roof
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9234.a
		hidden_effect = {
			planet_event = {
				id = colony.9240
				days = 720
				random = 360
			}
		}
	}
}

planet_event = { # third problem - guardians - potential pop death or less produce
	id = colony.9240
	title = "colony.9240.name"
	desc = "colony.9240.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual1 - pop death
		name = colony.9240.a
		custom_tooltip = colony.9240.a.desc
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9241
				days = 60
				random = 60
			}
		}
	}
	option = { # casual2 - less produce
		name = colony.9240.b
		custom_tooltip = colony.9240.b.desc
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		set_planet_flag = manufactorium_guardians_produce
		hidden_effect = {
			planet_event = {
				id = colony.9242
				days = 30
				random = 30
			}
		}
	}
	option = { # spiritualist ethic - managed to avert the bad situation
		name = colony.9240.c
		custom_tooltip = colony.9240.c.desc
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_spiritualist
				}
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9243
				days = 180
				random = 360
			}
		}
	}
	option = { # meritocracy civic - managed to avert the bad situation
		name = colony.9240.d
		custom_tooltip = colony.9240.d.desc
		trigger = {
			owner = {
				has_civic = civic_meritocracy
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9244
				days = 180
				random = 360
			}
		}
	}
	option = { #gestalt - managed to avert the bad situation
		name = colony.9240.e
		custom_tooltip = colony.9240.e.desc
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9245
				days = 60
				random = 60
			}
		}
	}
}

planet_event = { # third problem - casual 1 pop death
	id = colony.9241
	title = "colony.9241.name"
	desc = "colony.9241.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = CURSES
		random_owned_pop = {
			kill_pop = yes
		}
		hidden_effect = {
			planet_event = {
				id = colony.9250
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # third problem - casual 1 lowered production
	id = colony.9242
	title = "colony.9242.name"
	desc = "colony.9242.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = CURSES
		hidden_effect = {
			planet_event = {
				id = colony.9250
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # third problem - spiritualist averted
	id = colony.9243
	title = "colony.9243.name"
	desc = "colony.9243.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9243.a
		hidden_effect = {
			planet_event = {
				id = colony.9250
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # third problem - meritocracy averted
	id = colony.9244
	title = "colony.9244.name"
	desc = "colony.9244.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9244.a
		hidden_effect = {
			planet_event = {
				id = colony.9250
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # third problem - gestalt averted
	id = colony.9245
	title = "colony.9245.name"
	desc = "colony.9245.desc"
	picture = GFX_evt_generator_powerup
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9245.a
		hidden_effect = {
			planet_event = {
				id = colony.9250
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # second opportunity - project starting
	id = colony.9250
	title = "colony.9250.name"
	desc = "colony.9250.desc"
	picture = GFX_evt_black_market
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual - opportunity wasted - start the project
		name = colony.9250.a
		custom_tooltip = colony.9250.a.desc
		enable_special_project = {
			name = ANCIENT_MANUFACTORIUM_PROJECT
			location = this
			owner = root.owner
		}
	}
	option = { # technocracy +1 engineering research job output - start the project
		name = colony.9250.b
		custom_tooltip = colony.9250.b.desc
		trigger = {
			owner = {
				has_civic = civic_technocracy
			}
		}
		set_planet_flag = manufactorium_engineering
		enable_special_project = {
			name = ANCIENT_MANUFACTORIUM_PROJECT
			location = this
			owner = root.owner
		}
	}
	option = { # philosopher king +1 society research job output - start the project
		name = colony.9250.c
		custom_tooltip = colony.9250.c.desc
		trigger = {
			owner = {
				has_civic = civic_philosopher_king
			}
		}
		set_planet_flag = manufactorium_society
		enable_special_project = {
			name = ANCIENT_MANUFACTORIUM_PROJECT
			location = this
			owner = root.owner
		}
	}
	option = { # natural neural network +1 society research job output - start the project
		name = colony.9250.d
		custom_tooltip = colony.9250.d.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_hive_natural_neural_network
					has_civic = civic_hive_empath
				}
			}
		}
		set_planet_flag = manufactorium_society
		enable_special_project = {
			name = ANCIENT_MANUFACTORIUM_PROJECT
			location = this
			owner = root.owner
		}
	}
	option = { # introspective +1 engineering research job output - start the project
		name = colony.9250.e
		custom_tooltip = colony.9250.e.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_machine_introspective
					has_civic = civic_machine_predictive_analysis
				}
			}
		}
		set_planet_flag = manufactorium_engineering
		enable_special_project = {
			name = ANCIENT_MANUFACTORIUM_PROJECT
			location = this
			owner = root.owner
		}
	}
	option = { # oputing out - no special project, instead gain scrapyard - ending the chain
		name = colony.9250.f
		custom_tooltip = colony.9250.f.desc
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_scrapyard
	}
}

planet_event = { # special project finished
	id = colony.9251
	title = "colony.9251.name"
	desc = "colony.9251.desc"
	picture = GFX_evt_black_market
	show_sound = event_construction
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # proceed
		name = colony.9251.a
		hidden_effect = {
			planet_event = {
				id = colony.9260
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # fourth problem - working conditions - bad modifier to pop happiness or lowered production
	id = colony.9260
	title = "colony.9260.name"
	desc = "colony.9260.desc"
	picture = GFX_evt_board_meeting
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual1 - bad outcome, lowered happiness
		name = colony.9260.a
		custom_tooltip = colony.9260.a.desc
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		set_planet_flag = manufactorium_work_hapipiness
		hidden_effect = {
			planet_event = {
				id = colony.9270
				days = 360
				random = 360
			}
		}
	}
	option = { # casual2 - bad outcome, lowered production
		name = colony.9260.b
		custom_tooltip = colony.9260.b.desc
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		set_planet_flag = manufactorium_work_production
		hidden_effect = {
			planet_event = {
				id = colony.9270
				days = 360
				random = 360
			}
		}
	}
	option = { # slaver guilds - bad outcome averted
		name = colony.9260.c
		custom_tooltip = colony.9260.c.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_slaver_guilds
					has_civic = civic_indentured_assets
				}
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9270
				days = 360
				random = 360
			}
		}
	}
	option = { # shared burdens - bad outcome averted
		name = colony.9260.d
		custom_tooltip = colony.9260.d.desc
		trigger = {
			owner = {
				has_civic = civic_shared_burden
			}
		}
		hidden_effect = {
			planet_event = {
				id = colony.9270
				days = 360
				random = 360
			}
		}
	}
	option = { # gestalt - bad outcome only - increased amenities usage
		name = colony.9260.e
		custom_tooltip = colony.9260.e.desc
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
		set_planet_flag = manufactorium_work_gestalt
		hidden_effect = {
			planet_event = {
				id = colony.9270
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # third opportunity - green care - can lower the upkeep or increase production
	id = colony.9270
	title = "colony.9270.name"
	desc = "colony.9270.desc"
	picture = GFX_evt_decryption
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual - opportunity random
		name = colony.9270.a
		custom_tooltip = colony.9270.a.desc
		hidden_effect = {
			random_list = {
				34 = {
					set_planet_flag = manufactorium_random_good
				}
				66 = {
				}
			}
			planet_event = {
				id = colony.9280
				days = 360
				random = 360
			}
		}
	}
	option = { # Environmentalist - lowered upkeep
		name = colony.9270.b
		custom_tooltip = colony.9270.b.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_environmentalist
					has_civic = civic_machine_zero_waste_protocols
					has_civic = civic_hive_ascetic
				}
			}
		}
		set_planet_flag = manufactorium_environmentalists
		hidden_effect = {
			planet_event = {
				id = colony.9280
				days = 360
				random = 360
			}
		}
	}
	option = { # Barbaric Despoilers - increased production
		name = colony.9270.c
		custom_tooltip = colony.9270.c.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_barbaric_despoilers
					has_civic = civic_fanatic_purifiers
					has_civic = civic_machine_terminator
					has_civic = civic_hive_devouring_swarm
				}
			}
		}
		set_planet_flag = manufactorium_despoilers
		hidden_effect = {
			planet_event = {
				id = colony.9280
				days = 360
				random = 360
			}
		}
	}
}

planet_event = { # fourth opportunity/problem - can increase production by increasing upkeep
	id = colony.9280
	title = "colony.9280.name"
	desc = "colony.9280.desc"
	picture = GFX_evt_sapient_AI
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # dont use the opportunity
		name = colony.9280.a
		custom_tooltip = colony.9280.a.desc
		hidden_effect = {
			planet_event = {
				id = colony.9290
				days = 60
				random = 60
			}
		}
	}
	option = { # use the opportunity - upkeep + production
		name = colony.9280.b
		custom_tooltip = colony.9280.b.desc
		hidden_effect = {
			random_list = {
				34 = {
					set_planet_flag = manufactorium_took_opportunity
				}
				26 = {
					set_planet_flag = manufactorium_took_opportunity_bad
				}
				40 = {
				}
			}
			planet_event = {
				id = colony.9290
				days = 180
				random = 360
			}
		}
	}
	option = { # Catalytic Processing - increase production, add food upkeep (better than casual 1:2 ratio)
		name = colony.9280.c
		custom_tooltip = colony.9280.c.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_catalytic_processing
					has_civic = civic_hive_catalytic_processing
					has_civic = civic_machine_catalytic_processing
					has_civic = civic_corporate_catalytic_processing
					has_origin = origin_tree_of_life
				}
			}
		}
		set_planet_flag = manufactorium_catalytic
		hidden_effect = {
			planet_event = {
				id = colony.9290
				days = 180
				random = 360
			}
		}
	}
	option = { # remnants origin - upgrades casual option from taking the opportunity
		name = colony.9280.d
		custom_tooltip = colony.9280.d.desc
		trigger = {
			owner = {
				has_origin = origin_remnants
			}
		}
		set_planet_flag = manufactorium_remnants
		hidden_effect = {
			planet_event = {
				id = colony.9290
				days = 180
				random = 360
			}
		}
	}
}

planet_event = { # Ending - grand opening and the last opportunity
	id = colony.9290
	title = "colony.9290.name"
	desc = "colony.9290.desc"
	picture = GFX_evt_announcement
	show_sound = event_celebration
	location = ROOT

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		original_owner = yes
		is_occupied_flag = no
	}

	is_triggered_only = yes

	immediate = {
	}

	option = { # casual - timed happiness boost
		name = colony.9290.a
		trigger = {
			owner = {
				is_gestalt = no
			}
		}
		owner = {
			add_modifier = {
				modifier = media_coverage_positive_medium
				days = 720
			}
		}
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_working
	}
	option = { # memorialists civic - adding 1 death/drone chronicler job
		name = colony.9290.b
		custom_tooltip = colony.9290.b.desc
		trigger = {
			owner = {
				OR = {
					has_civic = civic_memorialist
					has_civic = civic_machine_memorialist
					has_civic = civic_hive_memorialist
				}
			}
		}
		set_planet_flag = manufactorium_memorialists
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_working
	}
	option = { # aristocratic elite - adding 1 noble job
		name = colony.9290.c
		custom_tooltip = colony.9290.c.desc
		trigger = {
			owner = {
				has_civic = civic_aristocratic_elite
			}
		}
		set_planet_flag = manufactorium_aristocrats
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_working
	}
	option = { # free traders - adding 1 executive job
		name = colony.9290.d
		custom_tooltip = colony.9290.d.desc
		trigger = {
			owner = {
				is_megacorp = yes
			}
		}
		set_planet_flag = manufactorium_traders
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_working
	}
	option = { # casual - gestalt, nothing
		name = colony.9290.e
		trigger = {
			owner = {
				is_gestalt = yes
			}
		}
		remove_deposit = d_ancient_manufactorium_vaultexploration
		add_deposit = d_ancient_manufactorium_working
	}
}

### Metallic Puddles
planet_event = {
	id = colony.9295
	title = "colony.9295.name"
	desc = "colony.9295.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes

	pre_triggers = {
		has_owner = yes
		is_homeworld = no
		original_owner = yes
		is_ai = no
		has_ground_combat = no
		is_capital = no
		is_occupied_flag = no
	}

	trigger = {
		owner = {
			NOT = { has_authority = auth_machine_intelligence }
		}
		num_pops > 0
		OR = {
			is_planet_class = pc_continental
			is_planet_class = pc_tropical
			is_planet_class = pc_savannah
		}
		NOR = {
			has_global_flag = metallic_puddles_global
			has_planet_flag = colony_event
		}
	}

	is_triggered_only = yes

	immediate = {
		set_global_flag = metallic_puddles_global
		set_planet_flag = colony_event	
	}

	option = {
		name = colony.9295.a
		hidden_effect = {
			planet_event = { id = colony.9296 days = 35 random = 40 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
	}
	option = {
		name = colony.9295.b
		hidden_effect = {
			planet_event = { id = colony.9299 days = 35 random = 40 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
	}
}

### Silver Slime
planet_event = {
	id = colony.9296
	title = "colony.9296.name"
	desc = "colony.9296.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes
	is_triggered_only = yes

	option = {
		name = colony.9296.a
		hidden_effect = {
			planet_event = { id = colony.9297 days = 35 random = 40 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
		}
	}
}

### Disappearing Puddles
planet_event = {
	id = colony.9297
	title = "colony.9297.name"
	desc = "colony.9297.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature 
	location = ROOT
	trackable = yes
	is_triggered_only = yes

	option = {
		name = colony.9297.a
		hidden_effect = {
			planet_event = { id = colony.9298 days = 35 random = 40 }
		}
	}
}

### Return of the Silver Slime
planet_event = {
	id = colony.9298
	title = "colony.9298.name"
	desc = "colony.9298.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes
	is_triggered_only = yes

	option = {
		name = colony.9298.a
		hidden_effect = {
			planet_event = { id = colony.9300 days = 35 random = 40 }
		}
		owner = {
			add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

### Elusive Viscosity
planet_event = {
	id = colony.9299
	title = "colony.9299.name"
	desc = "colony.9299.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes
	is_triggered_only = yes

	option = {
		name = colony.9299.a
		hidden_effect = {
			planet_event = { id = colony.9300 days = 35 random = 40 }
		}
	}
}

### Elementary, Dear Leader!
planet_event = {
	id = colony.9300
	title = "colony.9300.name"
	desc = "colony.9300.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes
	is_triggered_only = yes

	option = {
		name = colony.9300.a
		enable_special_project = {
			name = "FASCINATING_METEOROLOGY_PROJECT"
			location = this
			owner = root
		}
	}
}

### Invaluable Insight
planet_event = {
	id = colony.9301
	title = "colony.9301.name"
	desc = "colony.9301.desc"
	picture = GFX_evt_alien_nature
	show_sound = event_alien_nature
	location = ROOT
	trackable = yes

	is_triggered_only = yes

	option = {
		name = colony.9301.a
		owner = {
			add_monthly_resource_mult = {
				resource = food
				value = @tier2materialreward
				min = @tier2materialmin
				max = @tier2materialmax
			}
		}
		if = {
			limit = {
				owner = { 
					is_gestalt = yes 
				}
			}
			add_deposit = d_metallic_puddles_gestalt
		}
		else = { add_deposit = d_metallic_puddles }
	}
}

################################
#
# Negative Mass
# by Victor Haeggman
#
################################

# Prologue
planet_event = {
	id = colony.9800
	title = "colony.9800.name"
	desc = "colony.9800.desc"
	picture = GFX_evt_news_room
	location = ROOT

	is_triggered_only = yes

	immediate = {
		set_global_flag = b_world_intrudes
	}

	option = {
		name = DISCONCERTING
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
		}
		custom_tooltip = portal_closed_tooltip
		hidden_effect = { 
			set_planet_flag = dportal_closed
			owner = {
				country_event = { id = colony.9805 days = 900 random = 100 }
			}
		}
	}
}

country_event = {
	id = colony.9805
	title = "colony.9805.name"
	desc = colony.9805.desc
	is_triggered_only = yes

	picture = GFX_evt_physics_research
	show_sound = event_laboratory_sound

	option = {
		name = colony.9805.a
		hidden_effect = { 
			country_event = { id = colony.9810 days = 200 random = 30 }
		}
	}
	option = {
		name = colony.9805.b
		hidden_effect = { 
			country_event = { id = colony.9810 days = 150 random = 30 }
		}
	}
}

#Negative Mass start
country_event = {
	id = colony.9810
	title = "colony.9810.name"
	desc = { 
		trigger = { is_machine_empire = yes }
		text = "colony.9810.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9810.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9810.desc"
	}

	is_triggered_only = yes
	picture = GFX_evt_announcement
	show_sound = event_mystic_reveal

	immediate = {
		if = {
			limit = {
				any_owned_leader = {
					is_researching_area = physics
				}
			}
			random_owned_leader = {
				limit = {
					is_researching_area = physics
				}
				save_event_target_as = target_physicist
			}
			clone_leader = {
				target = event_target:target_physicist
				effect = {
					save_global_event_target_as = cloned_physicist
					exile_leader_as = cloned_physicist
				}
			}
		}
		else = {
			random_owned_leader = {
				limit = {
					NOR = {
						is_researching_area = engineering
						is_researching_area = society
					}
					leader_class = scientist
				}
				save_event_target_as = target_physicist
			}
			clone_leader = {
				target = event_target:target_physicist
				effect = {
					save_global_event_target_as = cloned_physicist
					exile_leader_as = cloned_physicist
				}
			}
		}
	}

	option = {
		name = FASCINATING
		add_modifier = { modifier =  harvesting_negative_mass days = -1 }
		hidden_effect = {
			country_event = { id = colony.9815 days = 360 random = 360 }
		}
	}
}

#Gateway appears
country_event = {
	id = colony.9815
	title = "colony.9815.name"
	desc = {
		trigger = { is_machine_empire = yes }
		text = "colony.9815.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9815.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9815.desc"
	}
	is_triggered_only = yes
	picture = GFX_evt_wormhole
	show_sound = event_red_alert

	immediate = {
		create_ambient_object = {
			type = "extradimensional_2"
			location = capital_scope.star
			use_3d_location = yes
			entity_offset = { min = 80 max = 80 }
			entity_offset_angle = { min = 180 max = 180 }
			entity_offset_height = { min = 0 max = 0 }
			entity_scale_to_size = yes
			scale = 0.001
		}
	
		last_created_ambient_object = {	
			save_global_event_target_as = b_world_portal
			set_ambient_object_flag = b_world_portal 
		}	
	}
	option = {
		name = BATTLESTATIONS
		create_country = {
			name = NAME_Portal_Invaders
			type = faction
			effect = {
				establish_communications_no_message = root
				save_global_event_target_as = b_world_country	
				create_fleet = {
					name = "NAME_Familiar_Fleet"
					effect = {
						set_owner = prev
						set_fleet_flag = B_world_fleet
						create_ship = {
							name = random
							design = "NAME_B_World_Corvette"
							graphical_culture = root
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = root
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = root
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = root
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = root
						}	
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = root
						}																			
						set_location = {
							target = event_target:b_world_portal
							distance = 100
							angle = 260
						}
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 999
					}
				}
				set_relation_flag = {
					who = root
					flag = B_world_relation
				}
				set_faction_hostility = { set_hostile = yes }
			}
		}
	}
}

#An old code
country_event = {
	id = colony.9820
	title = "colony.9820.name"
	desc = { 
		trigger = { is_machine_empire = yes }
		text = "colony.9820.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9820.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9820.desc"
	}
	is_triggered_only = yes
	show_sound = event_sensor_ping
	picture = GFX_evt_exploding_ship
	auto_opens = yes
	trackable = yes
	location = fromfrom
	fire_only_once = yes

	trigger = {
		exists = from
		FROM = {
			has_relation_flag = {
				who = ROOT
				flag = B_world_relation
			}
		}
	}
	option = {
		trigger = { is_machine_empire = no }
		name = ONSCREEN
		hidden_effect = {
			country_event = { id = colony.9821 }
		}
	}
	option = {
		trigger = { is_machine_empire = yes }
		name = colony.9820.a.robot
		hidden_effect = {
			country_event = { id = colony.9821 }
		}		
	}
}

#First communication
country_event = {
	id = colony.9821
	title = colony.9821.name
	desc = { 
		trigger = { is_machine_empire = yes }
		text = "colony.9821.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9821.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9821.desc"
	}
	is_triggered_only = yes

	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:cloned_physicist
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}

	option = {
		name = colony.9821.a
		response_text = colony.9821.a.response
		trigger = { is_regular_empire = yes }
		is_dialog_only = yes
	}
	option = {
		name = colony.9821.a.robot
		response_text = colony.9821.a.response.robot
		trigger = { is_machine_empire = yes }
		is_dialog_only = yes
	}
	option = {
		name = colony.9821.a
		response_text = colony.9821.a.response.hive
		trigger = { is_hive_empire = yes }
		is_dialog_only = yes
	}
	option = {
		name = colony.9821.b
		trigger = { is_regular_empire = yes }
		response_text = colony.9821.b.response
		is_dialog_only = yes
	}
	option = {
		name = colony.9821.b.robot
		trigger = { is_machine_empire = yes }
		response_text = colony.9821.b.response.robot
		is_dialog_only = yes
	}
	option = {
		name = colony.9821.b
		response_text = colony.9821.b.response.hive
		trigger = { is_hive_empire = yes }
		is_dialog_only = yes
	}
	option = {
		trigger = { is_machine_empire = no }
		name = colony.9821.c
		hidden_effect = {
			country_event = { id = colony.9822 }
		}
	}
	option = {
		trigger = { is_machine_empire = yes }
		name = colony.9821.c.robot
		hidden_effect = {
			country_event = { id = colony.9822 }
		}
	}
}

#Second communication
country_event = {
	id = colony.9822
	title = colony.9821.name
	desc = { 
		trigger = { is_machine_empire = yes }
		text = "colony.9822.desc.robot"
		}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9822.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9822.desc"
	}
	is_triggered_only = yes

	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:cloned_physicist
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}	
	option = {
		trigger = { is_regular_empire = yes }
		name = colony.9822.a
		hidden_effect = {
			country_event = { id = colony.9840 days = 360 random = 20 }
		}
	}
	option = {
		trigger = { is_machine_empire = yes }
		name = colony.9822.a.robot
		hidden_effect = {
			country_event = { id = colony.9840 days = 360 random = 20 }
		}
	}
	option = {
		trigger = { is_hive_empire = yes }
		name = colony.9822.a.hive
		hidden_effect = {
			country_event = { id = colony.9840 days = 360 random = 20 }
		}
	}
}

#The summit
country_event = {
	id = colony.9840
	title = "colony.9840.name"

	desc = { 
		trigger = { is_machine_empire = yes }
		text = "colony.9840.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9840.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9840.desc"
	}
	is_triggered_only = yes
	picture = GFX_evt_board_meeting
	show_sound = event_conversation
	#Study
	option = {
		name = colony.9840.a
		custom_tooltip = colony.9840.a.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier4researchreward
				min = @tier4researchmin
				max = @tier4researchmax
			}
		}
		start_situation = {
			type = situation_negative_mass
			target = home_planet
			effect = {
				set_situation_approach = approach_observe_nmass
			}
		}
	}
	#Loot them 
	option = {
		name = {
			trigger = { 
				is_xenophobe = no
				NOR = { 
					has_valid_civic = civic_hive_devouring_swarm 
				 	has_valid_civic = civic_machine_terminator
				}
			}
			text = colony.9840.b
		}
		name = {
			trigger = {
				is_xenophobe = yes
			}
			text = colony.9840.b.phobe
		}
		name = {
			trigger = {
				has_valid_civic = civic_hive_devouring_swarm
			}
			text = colony.9840.b.swarm
		}
		name = {
			trigger = {
				has_valid_civic = civic_machine_terminator
			}
			text = colony.9840.b.exterminator
		}
		custom_tooltip = colony.9840.b.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = minerals
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
			add_monthly_resource_mult = {
				resource = energy
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
			add_monthly_resource_mult = {
				resource = alloys
				value = @tier4materialreward
				min = @tier4materialmin
				max = @tier4materialmax
			}
		}
		start_situation = {
			type = situation_negative_mass
			target = home_planet
			effect = {
				set_situation_approach = approach_plunder_nmass
			}
		}
	}

	option = { #Save them
		name = {
			trigger = { is_machine_empire = yes }
			text = colony.9840.c.exterminator
		}
		name = {
			trigger = { is_hive_empire = yes }
			text = colony.9840.c.swarm
		}
		name = {
			trigger = {
				is_xenophobe = yes
			}
			text = colony.9840.c.phobe
		}
		name = {
			trigger = {
				is_xenophobe = no
				is_gestalt = no
			}
			text = colony.9840.c
		}
		custom_tooltip = colony.9840.c.tooltip
		owner = {
			add_monthly_resource_mult = {
				resource = influence
				value = @tier2influencereward
				min = @tier2influencemin
				max = @tier2influencemax
			}
		}
		start_situation = {
			type = situation_negative_mass
			target = home_planet
			effect = {
				set_situation_flag = willing_to_help
				set_situation_approach = approach_save_b_world
			}
		}
		hidden_effect = {
			capital_scope = {
				while = {
					count = 6
					create_pop = {
						species = root.species	
					}
					last_created_pop = { set_pop_flag = b_worlder }
				}
				every_owned_pop = {
					limit = {
						has_pop_flag = b_worlder
					}
					if = { 
						limit = { is_robot_pop = yes }
						modify_species = {
							species = this
							add_trait = trait_robot_notofthisworld
						}
					}
					else = {
						modify_species = {
							species = this 
							add_trait = trait_notofthisworld
						}
					}
				}
			}
		}
	}

	#Save Planet
	option = {
		name = colony.9840.d
		custom_tooltip = colony.9840.d.tooltip
		start_situation = {
			type = situation_negative_mass
			target = home_planet
			effect = {
				set_situation_flag = willing_to_help
				set_situation_approach = approach_save_b_world
			}
		}
	}	
}

#Sucessfuly bring planet into your reality
country_event = {
	id = colony.9850
	title = "colony.9850.name"
	desc = {
		trigger = { is_machine_empire = yes }
		text = "colony.9850.desc.robot"
	}
	desc = {
		trigger = { is_hive_empire = yes }
		text = "colony.9850.desc.hive"
	}
	desc = {
		trigger = { is_regular_empire = yes }
		text = "colony.9850.desc"
	}
	is_triggered_only = yes
	picture = GFX_evt_atmospheric_entry
	show_sound = event_activating_unknown_technology

	immediate = {
		set_country_flag = b_world_spawned 
		if = {
			limit = {
				has_origin = origin_ocean_paradise
			}
			home_planet = {
				solar_system = {
					spawn_planet = {
						class = pc_ocean
						location = root.home_planet
						orbit_angle_offset = 180
						size = 30
						init_effect = {
							set_name = {
								key = NAME_B_Planet
								variable_string = "[Root.GetHomeWorldName]"
							}
							save_event_target_as = b_planet
							set_owner = root
							set_controller = root
							prevent_anomaly = yes
							clear_blockers = yes
							set_planet_entity = {
								entity = "ocean_paradise_planet_01_entity"
							}
							generate_start_deposits_and_blockers = yes
							remove_all_buildings = yes
							set_planet_flag = colony_event
							generate_start_buildings_and_districts = yes
								if = {
								limit = {
									root = { is_gestalt = yes }
								}
								add_modifier = {
									modifier = ocean_paradise_hive
								}
							}
							else = {
								add_modifier = {
									modifier = ocean_paradise
								}
							}
						}
					}
					every_ambient_object = {
						limit = { has_ambient_object_flag = b_world_portal }
						destroy_ambient_object = this
					}
				}
			}
		}
		else_if = {
			limit = {
				has_origin = origin_life_seeded
			}
			home_planet = {
				solar_system = {
					spawn_planet = {
						class = pc_gaia
						location = root.home_planet
						orbit_distance_offset = 2
						orbit_angle_offset = 180
						size = 30
						init_effect = {
							set_name = {
								key = NAME_B_Planet
								variable_string = "[Root.GetHomeWorldName]"
							}
							save_event_target_as = b_planet
							set_owner = root
							set_controller = root
							prevent_anomaly = yes
							clear_blockers = yes
							generate_start_deposits_and_blockers = yes
							remove_all_buildings = yes
							set_planet_flag = colony_event
							generate_start_buildings_and_districts = yes
						}
					}
					every_ambient_object = {
						limit = { has_ambient_object_flag = b_world_portal }
						destroy_ambient_object = this
					}
				}
			}
		}
		else_if = {
			limit = {
				has_origin = origin_post_apocalyptic
			}
			home_planet = {
				solar_system = {
					spawn_planet = {
						class = pc_nuked
						location = root.home_planet
						orbit_distance_offset = 2
						orbit_angle_offset = 180
						size = 20
						init_effect = {
							set_name = {
								key = NAME_B_Planet
								variable_string = "[Root.GetHomeWorldName]"
							}
							save_event_target_as = b_planet
							set_owner = root
							set_controller = root
							prevent_anomaly = yes
							clear_blockers = yes
							generate_start_deposits_and_blockers = yes
							remove_all_buildings = yes
							set_planet_flag = colony_event
							generate_start_buildings_and_districts = yes
						}
					}
					every_ambient_object = {
						limit = { has_ambient_object_flag = b_world_portal }
						destroy_ambient_object = this
					}
				}
			}
		}
		else = {
			home_planet = {
				solar_system = {
					spawn_planet = {
						class = pc_ocean
						location = root.home_planet
						orbit_distance_offset = 2
						orbit_angle_offset = 180
						size = 18
						init_effect = {
							set_name = {
								key = NAME_B_Planet
								variable_string = "[Root.GetHomeWorldName]"
							}
							save_event_target_as = b_planet
							set_owner = root
							set_controller = root
							prevent_anomaly = yes
							clear_deposits = yes
							remove_all_buildings = yes
							generate_start_buildings_and_districts = yes
							set_planet_flag = colony_event
							if = {
								limit = {
									root = {
										is_machine_empire = no
									}
								}
								change_pc = root.owner_species
							}
							else = {
								change_pc = pc_nuked
							}
							if = {
								limit = {
									root.home_planet = {
										has_planet_flag = planet_earth
									}
								}
								generate_earth_deposits_and_blockers = yes
								set_earth_entity = yes
							}
							else = {
								generate_start_deposits_and_blockers = yes
							}
						}
					}
					every_ambient_object = {
						limit = { has_ambient_object_flag = b_world_portal }
						destroy_ambient_object = this
					}
				}
			}
		}
		event_target:b_planet = {
			while = {
				count = 18
				create_pop = {
					species = root.species	
				}
				last_created_pop = { set_pop_flag = b_worlder }
			}
			every_owned_pop = {
				limit = {
					has_pop_flag = b_worlder
				}
				if = { 
					limit = { is_robot_pop = yes }
					modify_species = {
						species = this
						add_trait = trait_robot_notofthisworld
					}
				}
				else = {
					modify_species = {
						species = this 
						add_trait = trait_notofthisworld
					}
				}
			}
			add_modifier = {
				modifier = b_world_saved
				days = 3600
			}
		}
	}
	option = {
		name = colony.9850.a
		remove_modifier = "harvesting_negative_mass"
		random_situation = {
			limit = { is_situation_type = situation_negative_mass }
			destroy_situation = this
		}
	}
}

#Fail or choose not to bring planet into your reality
country_event = {
	id = colony.9851
	title = "colony.9851.name"
	desc = "colony.9851.desc"
	is_triggered_only = yes
	picture = GFX_evt_star_white
	show_sound = event_screams
	immediate = {
		event_target:b_world_portal = {
			destroy_ambient_object = this
		}
	}
	
	option = {
		name = colony.9851.a
		remove_modifier = "harvesting_negative_mass"
		random_situation = {
			limit = { is_situation_type = situation_negative_mass }
			destroy_situation = this
		}
	}
}

situation_event = {
	id = colony.9855
	title = colony.9855.name
	desc = colony.9855.desc
	is_triggered_only = yes
	picture = GFX_evt_busy_spaceport
	show_sound = event_ghost_town
	situation = this
	trigger = {
		current_situation_approach = approach_save_b_world
		owner = { is_gestalt = no }
	}
	option = {
		name = colony.9855.a
		add_situation_progress = 20
		target = { add_modifier = { modifier = appeased_populace days = 1800 } }
	}
	option = {
		allow = {
			owner = { is_egalitarian = no }
		}
		name = colony.9855.b
		target = { add_modifier = { modifier = angered_populace days = 1800 } }
	}
	option = {
		name = colony.9855.c
		add_situation_progress = 5
	}
}

situation_event = {
	id = colony.9860
	title = colony.9860.name
	desc = colony.9860.desc
	is_triggered_only = yes
	picture = GFX_evt_ancient_artifact
	show_sound = event_administrative_work
	situation = this

	trigger = {
		current_situation_approach = approach_save_b_world
		owner = { is_gestalt = no }
	}

	option = {
		allow = {
			owner = {
				OR = {
					NOR = {
						has_valid_civic = civic_barbaric_despoilers
						has_ascension_perk = ap_nihilistic_acquisition
					}
					root.target = {
						has_modifier = multiple_stolen_great_works
					}
				}
			}
		}
		name = colony.9860.a
		owner = { add_resource = { unity = -150 } }
	}
	option = {
		name = colony.9860.b
		add_situation_progress = 20
		target = {
			if = {
				limit = { has_modifier = stolen_great_work }
				remove_modifier = stolen_great_work
				add_modifier = { modifier = multiple_stolen_great_works days = -1 }
				add_situation_progress = 25
			}
			else = {
				add_modifier = { modifier = stolen_great_work days = -1 }
			}
		}
		hidden_effect = {
			situation_event = { id = colony.9860 days = 120 }
		}
	}
}

situation_event = {
	id = colony.9865
	hide_window = yes
	is_triggered_only = yes
	situation = this

	immediate = {
		set_variable = { 
			which = situation_age
			value = 0
		}
		situation_event = { id = colony.9866 days = 360 }
	}
}

situation_event = {
	id = colony.9866
	hide_window = yes
	is_triggered_only = yes
	situation = this

	immediate = {
		change_variable = {
			which = situation_age
			value = 1
		}
		situation_event = { id = colony.9866 days = 360 }
	}
}

situation_event = {
	id = colony.9870
	title = colony.9870.name
	situation = this
	desc = {
		trigger = { current_situation_approach = approach_save_b_world }
		text = colony.9870.desc.helped
	}
	desc = {
		trigger = { NOT = { current_situation_approach = approach_save_b_world } }
		text = colony.9870.desc.ignored
	}
	is_triggered_only = yes
	picture = GFX_evt_star_white
	show_sound = event_red_alert

	trigger = {
		NOT = {
			situation_progress >= 100
		}
	}

	option = { #Redouble efforts
		trigger = {
			current_situation_approach = approach_save_b_world 
		}
		name = colony.9870.a
		custom_tooltip = colony.9870.a.tooltip
		set_situation_flag = redoubled_efforts
	}
	option = { #Everything is fine
		name = colony.9870.b
	}
	option = { #Regret
		name = colony.9870.c
		trigger = {
			NOT = { current_situation_approach = approach_save_b_world }
		}
		set_situation_flag = willing_to_help
		set_situation_approach = approach_save_b_world
		custom_tooltip = colony.9870.a.tooltip
		set_situation_flag = redoubled_efforts
	}
}

situation_event = { #Offloading Optimization
	id = colony.9875
	title = colony.9875.name
	desc = colony.9875.desc
	is_triggered_only = yes
	situation = this
	picture =  {
		trigger = {
			owner = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture =  {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		picture = GFX_evt_machine_sapience
	}
	show_sound = event_administrative_work

	trigger = {
		current_situation_approach = approach_save_b_world
		owner = { is_gestalt = yes }
	}

	option = {
		name = {
			trigger = {
				owner = { is_machine_empire = yes }
			}
			text = colony.9875.a.machine
		}
		name = {
			trigger = {
				owner = { is_hive_empire = yes }
			}
			text = colony.9875.a.hive
		}
		owner = {
			add_modifier = { modifier = offloaded_optimization days = -1 }
		}
		add_situation_progress = 20
	}
	option = {
		name = colony.9875.b
		add_situation_progress = -5
	}
}

situation_event = {#Desperate Drones
	id = colony.9880
	title = colony.9880.name
	desc = colony.9880.desc
	is_triggered_only = yes
	situation = this
	picture =  {
		trigger = {
			owner = { is_hive_empire = yes }
		}
		picture = GFX_evt_hive_mind
	}
	picture =  {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		picture = GFX_evt_machine_sapience
	}
	show_sound = event_administrative_work

	trigger = {
		current_situation_approach = approach_save_b_world
		owner = { is_gestalt = yes }
	}
	immediate = {
		owner = { set_country_flag = b_world_invasion }
		create_country = {
			name = "NAME_Dominated_Drones"
			type = faction
			effect = {
				establish_communications_no_message = root
				save_global_event_target_as = dominated_drones
				set_relation_flag = {
					who = root
					flag = B_world_relation
				}
				set_faction_hostility = { set_hostile = yes }
			}
		}
	}
	option = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		name = colony.9880.a.machine
		custom_tooltip = colony.9880.a.tt
		hidden_effect = {
			target = {
				create_army = {
					name = "NAME_controlled_army"
					species = root.owner.species
					owner = event_target:dominated_drones
					type = "robotic_army"
				}
				if = {
					limit = {
						owner = {
							has_modifier = offloaded_optimization
						}
					}
					while = {
						count = 2
						create_army = {
							name = "NAME_controlled_army"
							species = root.owner.species
							owner = event_target:dominated_drones
							type = "robotic_army"
						}
					}
				}
				random_owned_pop = {
					kill_pop = yes
				}
			}
		}
		add_situation_progress = 20
	}

	option = {
		trigger = {
			owner = { is_hive_empire = yes }
		}
	
		name = colony.9880.a.hive
		custom_tooltip = colony.9880.a.tt
		hidden_effect = {
			target = {
				create_army = {
					name = "NAME_controlled_army"
					species = root.owner.species
					owner = event_target:dominated_drones
					type = "assault_army"
				}
				if = {
					limit = {
						owner = { 
							has_modifier = offloaded_optimization
						}
					}
					while = {
						count = 2
						create_army = {
							name = "NAME_controlled_army"
							species = root.owner.species
							owner = event_target:dominated_drones
							type = "assault_army"
						}
					}
				}
				random_owned_pop = {
					kill_pop = yes
				}
			}
		}
		add_situation_progress = 20
	}

	option = {
		trigger = {
			owner = { is_hive_empire = yes }
		}
		name = colony.9880.b
		add_situation_progress = 15
		owner = { set_country_flag = calmed_b_world }
		hidden_effect = {
			target = {
				create_army = {
					name = "NAME_controlled_army"
					species = root.owner.species
					owner = event_target:dominated_drones
					type = "assault_army"
				}
				if = {
					limit = {
						owner = { 
							has_modifier = offloaded_optimization
						}
					}
					while = {
						count = 2
						create_army = {
							name = "NAME_controlled_army"
							species = root.owner.species
							owner = event_target:dominated_drones
							type = "assault_army"
						}
					}
				}
			}
		}
	}

	option = {
		trigger = {
			owner = { is_machine_empire = yes }
		}
		name = colony.9880.b
		add_situation_progress = 15
		owner = { set_country_flag = calmed_b_world }
		hidden_effect = {
			target = {
				create_army = {
					name = "NAME_controlled_army"
					species = root.owner.species
					owner = event_target:dominated_drones
					type = "robotic_army"
				}
				if = {
					limit = {
						owner = { 
							has_modifier = offloaded_optimization
						}
					}
					while = {
						count = 2
						create_army = {
							name = "NAME_controlled_army"
							species = root.owner.species
							owner = event_target:dominated_drones
							type = "robotic_army"
						}
					}
				}
			}
		}
	}


	after = {
		if = {
			limit = {
				owner = { 
					is_machine_empire = yes
					NOT = {
						has_country_flag = calmed_b_world
					}
				}
			}
			target = {
				while = {
					count = 4
					create_army = {
						species = root.owner.species
						owner = root.owner
						type = "robotic_army"
					}
				}
			}
		}
		else_if = {
			limit = {
				owner = { 
					is_hive_empire = yes
					NOT = {
						has_country_flag = calmed_b_world
					}
				}
			}
			target = {
				while = {
					count = 4
					create_army = {
						species = root.owner.species
						owner = root.owner
						type = "assault_army"
					}
				}
			}
		}
	}
}

country_event = {
	id = colony.9885
	title = colony.9821.name
	desc = {
		trigger = { is_hive_empire = yes }
		text = colony.9885.desc.hive
	}
	desc = {
		trigger = { is_machine_empire = yes }
		text = colony.9885.desc.machine
	}
	diplomatic = yes
	is_triggered_only = yes

	picture_event_data = {
		portrait = root.ruler
		planet_background = root.owner
		graphical_culture = root.owner
		city_level = root.owner
		room = root.owner
	}
	trigger = {
		has_country_flag = b_world_invasion
		from = {
			is_same_value = event_target:dominated_drones
		}
	}
	immediate = {
		remove_country_flag = b_world_invasion
	}
	option = {
		trigger = {
			is_hive_empire = yes
		}
		name = colony.9885.a.hive
		custom_tooltip = colony.9885.a.hive.tooltip
	}
	option = {
		trigger = {
			is_machine_empire = yes
		}
		name = colony.9885.a.machine
		custom_tooltip = colony.9885.a.machine.tooltip
	}
	option = {
		trigger = {
			is_hive_empire = yes
			has_country_flag = calmed_b_world
		}
		name = colony.9885.b.hive
		random_situation = {
			limit = {
				is_situation_type = situation_negative_mass
			}
			add_situation_progress = -15
		}
	}
	option = {
		trigger = {
			is_machine_empire = yes
			has_country_flag = calmed_b_world
		}
		name = colony.9885.b.machine
		random_situation = {
			limit = {
				is_situation_type = situation_negative_mass
			}
			add_situation_progress = -15
		}
	}
}

country_event = {
	id = colony.9889
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		from = {
			has_country_flag = b_world_invasion
		}
		is_same_value = event_target:dominated_drones
	}

	immediate = {
		from = {
			country_event = { 
				id = colony.9890  
				days = 0 
				scopes = {
					fromfrom = fromfrom
					from = root
				}
			}
		}
	}
}

country_event = {
	id = colony.9890
	title = colony.9890.name
	desc = colony.9890.desc
	picture = GFX_evt_victorious_army
	is_triggered_only = yes
 
	trigger = {
		has_country_flag = b_world_invasion
		from = {
			is_same_value = event_target:dominated_drones
		}
	}
	immediate = {
		remove_country_flag = b_world_invasion
		random_situation = {
			limit = {
				is_situation_type = situation_negative_mass
			}
			set_situation_flag = cant_change
			set_situation_approach = approach_save_b_world
		}
	}
 
	option = {
		name = colony.9890.a
		hidden_effect = {
			event_target:dominated_drones = {
				every_owned_army = {
					remove_army = yes
				}
			}
		}
		fromfrom = {
			set_controller = root
		}
		remove_modifier = offloaded_optimization
		random_situation = {
			limit = {
				is_situation_type = situation_negative_mass
			}
			add_situation_progress = 15
		}
	}
}

#Removes 'Sprawling Slums' blockers from popless planets

planet_event = {
	id = colony.9895
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		every_deposit = {
			limit = {
				is_deposit_type = d_decrepit_dwellings 
			}
			clear_blocker = yes
		}
	}
}
